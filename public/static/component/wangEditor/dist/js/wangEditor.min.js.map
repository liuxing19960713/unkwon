{"version":3,"sources":["public/static/component/wangEditor/dist/js/wangEditor.js"],"names":["factory","window","define","amd","cmd","require","exports","module","jQuery","$","fn","jquery","alert","_e","E","wangEditor","elem","$elem","length","nodeName","this","valueNodeName","toLowerCase","$valueContainer","$prev","prev","$parent","parent","init","prototype","$body","$document","document","$window","userAgent","navigator","getComputedStyle","w3cRange","createRange","hostname","location","websiteHost","isOnWebsite","indexOf","docsite","plugin","_plugins","push","initDefaultConfig","addEditorContainer","addTxt","addMenuContainer","menus","commandHooks","ready","readyFns","readyHeadler","fns","shift","call","updateValue","editor","$txt","txt","value","html","val","getInitValue","currentValue","updateMenuStyle","each","k","menu","updateSelected","enableMenusExcept","menuIds","_disabled","disabled","disableMenusExcept","hideDropPanelAndModal","m","dropPanel","dropList","modal","hide","emptyFn","ieRange","currentRange","cr","_rangeData","collapseRange","range","opt","collapse","getRangeText","toString","getRangeElem","dom","commonAncestorContainer","nodeType","parentNode","isRangeEmpty","startContainer","endContainer","startOffset","endOffset","saveSelection","_parentElem","selection","self","get","getSelection","getRangeAt","rangeCount","contains","restoreSelection","removeAllRanges","addRange","ex","error","restoreSelectionByElem","setRangeByElem","initSelection","$firstChild","children","first","txtElem","firstTextNode","firstChild","lastTextNode","lastChild","setStart","setEnd","textContent","text","parentElement","setEndPoint","select","insertHtml","targetElem","rangeElem","getLegalTags","after","command","e","commandName","commandValue","callback","commandFn","queryCommandSupported","execCommand","hooks","customCommand","commandForElem","elemOpt","selector","check","getSelfOrParentByName","hidePanelAndModal","preventDefault","undoRecord","insertEmptyP","wrapImgAndText","setTimeout","queryCommandValue","result","queryCommandState","_matchesSelectorForIE","$elems","matchesSelector","legalTags","config","webkitMatchesSelector","mozMatchesSelector","oMatchesSelector","_getRedoList","_redoList","_getUndoList","_undoList","_handle","data","type","redo","undo","onchange","undoList","redoList","unshift","pop","create","addMenus","renderMenus","renderMenuContainer","renderTxt","renderEditorContainer","eventMenus","eventMenuContainer","eventTxt","disable","removeAttr","enable","attr","destroy","$editorContainer","show","undestroy","$menuContainer","menuContainer","clear","find","MenuContainer","changeShadow","on","scrollTop","addClass","removeClass","render","append","height","appendMenu","groupIdx","_addGroup","_addOneMenu","$menuGroup","$currentGroup","currentGroupIdx","$menuNormal","$domNormal","$menuSelected","$domSelected","$item","Menu","id","title","commandNameSelected","commandValueSelected","initUI","uiConfig","UI","menuId","menuUI","warn","normal","test","selected","clone","slice","$menuItem","onRender","_renderTip","$tip","$tempDiv","tipWidth","titleWidth","outerWidth","currentWidth","currentMarginLeft","parseFloat","css","remove","width","margin-left","timeoutId","active","clearTimeout","bindEvent","clickEvent","dropObj","isShowing","clickEventSelected","click","updateSelectedEvent","changeSelectedState","state","_activeState","activeStyle","$dom","DropList","tpl","selectorForELemCommand","beforeEvent","afterEvent","initDOM","initHideEvent","itemContent","$list","replace","currentTarget","thisList","menuDom","trigger","target","scroll","_render","rendered","_position","$menuDom","menuPosition","offsetParent","position","menuTop","top","menuLeft","left","menuHeight","menuWidth","listWidth","txtWidth","marginLeft","valWithTxt","_isMenufixed","offset","outerHeight","DropPanel","$content","$panel","$triangle","thisPanle","panelWidth","marginLeft2","focusFirstInput","$input","focus","placeholderForIE8","Modal","initDom","$modal","$close","zindex","marginTop","sTop","margin-top","Txt","contentEmptyHandle","bindEnterForDiv","bindEnterForText","bindTabEvent","bindPasteFilter","bindFormatText","bindHtml","$p","keyCode","trim","txtHtml","divHandler","$keydownDivElem","$pElem","$targetElem","handle","childNodesClone","childNodes","index","item","legalTagArr","resultHtml","getResult","removeAttrs","htmlForP","htmlForLi","tag","$li","attrs","attributes","attrNames","exception","key","removeAttribute","split","pasteFilter","currentNodeName","pasteHtml","$paste","docSplitHtml","clipboardData","originalEvent","ieData","pasteText","getData","match","link","RegExp","clearEmptyOrNestP","regArr","reg","formatText","$temp","matchStr","undefined","a","b","c","change","txtChangeEventNames","initHeight","valueContainerHeight","txtHeight","initMaxHeight","$wrap","maxHeight","parseInt","isNaN","fullscreen","useMaxHeight","max-height","overflow-y","min-height","wrap","saveSelectionEvent","save","saveSync","Date","now","dt","saveAync","off","updateValueEvent","doOnchange","oldValue","updateMenuStyleEvent","$children","last","i","childNode","$imgs","childrenLength","showHeightOnHover","addAndShowTip","$target","isTipInTxt","paddingTop","marginBottom","paddingBottom","removeTip","Array","lastIndexOf","valueOf","console","info","printLog","random","Math","placeholder","createElement","$container","langs","bold","underline","italic","forecolor","bgcolor","strikethrough","eraser","source","quote","fontfamily","fontsize","head","orderlist","unorderlist","alignleft","aligncenter","alignright","submit","cancel","unlink","table","emotion","img","uploadImg","linkImg","video","loading","searchlocation","dynamicMap","clearLocation","langDynamicOneLocation","insertcode","openLink","en","menuFixed","jsFilter","lang","colors","#880000","#800080","#ff0000","#ff00ff","#000080","#0000ff","#00ffff","#008080","#008000","#808000","#00ff00","#ffcc00","#808080","#c0c0c0","#000000","#ffffff","familys","fontsizes","1","2","3","4","5","6","7","emotionsShow","emotions","weibo","icon","mapAk","uploadImgUrl","uploadTimeout","uploadImgFns","customUpload","uploadParams","uploadHeaders","withCredentials","hideLinkImg","codeDefaultLang","default","extend","createMenuFns","createMenu","createMenuFn","configColors","v","join","checkElemFn","cssText","style","pElem","quoteElem","$quoteElem","listElem","$listElem","$clearElem","$code","$codeTextarea","isShowCode","txtOuterHeight","$quote","$rangeElem","currentQuote","$lastChild","isPrevEnter","currentRangeElem","$currentRangeElem","configFamilys","configSize","isOrderedList","<h1>","<h2>","<h3>","<h4>","<h5>","$div1","$div2","$div3","$textInput","$urlInput","$btnSubmit","$btnCancel","url","href","innerHTML","$linkElem","linkHtml","$oldLinks","$newLinks","uniqId","not","$a","$span","aElem","$tr","j","$table","$row","$rowspan","$col","$colspan","$currentTd","currentTdIndex","$currentTr","currentTrIndex","trIndex","$td","tdIndex","rownum","colnum","tableHtml","insertEmotionImgs","$tabContent","src","$command","$img","emotionUrls","configEmotions","$panelContent","$tabContainer","$contentContainer","log","$tab","parseJSON","Object","imgLoaded","_src","linkContentHandler","$linkContent","$urlContainer","imgHtml","tabToggle","$uploadTab","$uploadContent","$linkTab","hideUploadImg","customUploadInit","hidePanel","$linkInputContainer","$linkInput","$sizeContainer","$widthInput","$heightInput","$btnContainer","$howToCopy","$link","$div","inputKeyup","input","baiduMapAk","numberOfLocation","$searchInput","ak","mapData","markers","mapContainerId","clearLocations","map","clearOverlays","searchMap","myGeo","marker","BMap","cityName","$cityInput","locationName","centerAndZoom","Geocoder","getPoint","point","Marker","addOverlay","enableDragging","hasCallback","baiduMapCallBack","locationFun","name","setCenter","searchFn","is","currentCity","currentSearch","city","search","Map","Point","addControl","MapTypeControl","setCurrentCity","enableScrollWheelZoom","LocalCity","addEventListener","lng","lat","loadMapScript","script","body","appendChild","initMap","$inputContainer","text-align","$clearBtn","$map","border","$mapLoading","$checkLabel","$check","iframe","isDynamic","center","getCenter","centerLng","centerLat","zoom","getZoom","size","getSize","sizeWidth","sizeHeight","getPosition","firstTime","loadHljs","hljs","updateMenu","$textarea","listLanguages","$langSelect","className","$textareaContainer","margin","padding","codeTpl","doHightlight","langClass","block","$block","highlightBlock","ctrlKey","scrollTopWhenFullScreen","zIndex","zIndexConfig","isSelected","$wrapper","isFullScreen","prepend","onload","resultText","xhr","originalName","uploadImgOriginalName","onerror","ontimeout","FileReader","FormData","convertBase64UrlToBlob","urlData","filetype","bytes","atob","ab","ArrayBuffer","ia","Uint8Array","charCodeAt","Blob","insertImg","event","updateProgress","lengthComputable","percentComplete","loaded","total","showUploadProgress","xhrUploadImg","timeoutCallback","abort","timeoutfn","hideUploadProgress","fileName","filename","base64","fileType","loadfn","errorfn","params","headers","fileExt","XMLHttpRequest","formData","responseText","upload","onprogress","open","setRequestHeader","send","isRender","$progress","hideProgress","progress","time","$uploadIcon","upfile","UploadFile","uploadUrl","timeout","fileAccept","selectFiles","multiple","_hasRender","acceptTpl","multipleTpl","files","file","clearInput","uploadFileName","uploadImgFileName","reader","readAsDataURL","hideModal","iframeId","$iframe","$btn","$form","bindLoadEvent","onloadFn","iframeWindow","fileFullName","fileOriginalName","_hasBindLoad","contentWindow","attachEvent","findPasteImgAndUpload","flag","$imgsBeforePaste","pasteEvent","items","getAsFile","dragEvent","dataTransfer","isRendered","$toolbar","$delete","$zoomSmall","$zoomBig","cb","$currentTable","tablePosition","tableTop","tableLeft","tableHeight","tableWidth","txtTop","$currentTxt","stopPropagation","imgLink","$currentImg","currentLink","inLink","unwrap","bindToolbarEvent","bindDragEvent","$alignLeft","$alignCenter","$alignRight","$unLink","$linkBtnCancel","$linkBtnSubmit","$dragPoint","parents","mousemove","diffX","diffY","pageX","_x","pageY","_y","currentDragMarginLeft","dragMarginLeft","currentDragMarginTop","dragMarginTop","currentImgWidth","imgWidth","currentImggHeight","imgHeight","isOnDrag","imgPosition","imgTop","imgLeft","isEmotion","imgSrc","$triggerLink","setPosition","$currentLink","topResult","isShow","showTimeoutId","hideTimeoutId","showTimeoutIdByToolbar","hasClass","bodyMarginTop","editorTop","editorHeight","menuCssPosition","menuCssTop","p","indent","lineHeight","1.0","1.5","1.8","2.0","2.5","3.0","btnId","containerId","customUploadBtnId","customUploadContainerId"],"mappings":"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","file":"wangEditor.min.js","sourcesContent":["(function (factory) {\n    if (typeof window.define === 'function') {\n        if (window.define.amd) {\n            // AMD模式\n            window.define('wangEditor', [\"jquery\"], factory);\n        } else if (window.define.cmd) {\n            // CMD模式\n            window.define(function (require, exports, module) {\n                return factory;\n            });\n        } else {\n            // 全局模式\n            factory(window.jQuery);\n        }\n    } else if (typeof module === \"object\" && typeof module.exports === \"object\") {\n        // commonjs\n\n        // 引用 css —— webapck\n        require('../css/wangEditor.css');\n        module.exports = factory(\n            // 传入 jquery ，支持使用 npm 方式或者自己定义jquery的路径\n            require('jquery')\n        );\n    } else {\n        // 全局模式\n        factory(window.jQuery);\n    }\n})(function($){\n    \n    // 验证是否引用jquery\n    if (!$ || !$.fn || !$.fn.jquery) {\n        alert('在引用wangEditor.js之前，先引用jQuery，否则无法使用 wangEditor');\n        return;\n    }\n\n    // 定义扩展函数\n    var _e = function (fn) {\n        var E = window.wangEditor;\n        if (E) {\n            // 执行传入的函数\n            fn(E, $);\n        }\n    };\n// 定义构造函数\n(function (window, $) {\n    if (window.wangEditor) {\n        // 重复引用\n        alert('一个页面不能重复引用 wangEditor.js 或 wangEditor.min.js ！！！');\n        return;\n    }\n\n    // 编辑器（整体）构造函数\n    var E = function (elem) {\n        // 支持 id 和 element 两种形式\n        if (typeof elem === 'string') {\n            elem = '#' + elem;\n        }\n\n        // ---------------获取基本节点------------------\n        var $elem = $(elem);\n        if ($elem.length !== 1) {\n            return;\n        }\n        var nodeName = $elem[0].nodeName;\n        if (nodeName !== 'TEXTAREA' && nodeName !== 'DIV') {\n            // 只能是 textarea 和 div ，其他类型的元素不行\n            return;   \n        }\n        this.valueNodeName = nodeName.toLowerCase();\n        this.$valueContainer = $elem;\n\n        // 记录 elem 的 prev 和 parent（最后渲染 editor 要用到）\n        this.$prev = $elem.prev();\n        this.$parent = $elem.parent();\n\n        // ------------------初始化------------------\n        this.init();\n    };\n\n    E.fn = E.prototype;\n\n    E.$body = $('body');\n    E.$document = $(document);\n    E.$window = $(window);\n    E.userAgent = navigator.userAgent;\n    E.getComputedStyle = window.getComputedStyle;\n    E.w3cRange = typeof document.createRange === 'function';\n    E.hostname = location.hostname.toLowerCase();\n    E.websiteHost = 'wangeditor.github.io|www.wangeditor.com|wangeditor.coding.me';\n    E.isOnWebsite = E.websiteHost.indexOf(E.hostname) >= 0;\n    E.docsite = 'http://www.kancloud.cn/wangfupeng/wangeditor2/113961';\n\n    // 暴露给全局对象\n    window.wangEditor = E;\n\n    // 注册 plugin 事件，用于用户自定义插件\n    // 用户在引用 wangEditor.js 之后，还可以通过 E.plugin() 注入自定义函数，\n    // 该函数将会在 editor.create() 方法的最后一步执行\n    E.plugin = function (fn) {\n        if (!E._plugins) {\n            E._plugins = [];\n        }\n\n        if (typeof fn === 'function') {\n            E._plugins.push(fn);\n        }\n    };\n\n})(window, $);\n// editor 绑定事件\n_e(function (E, $) {\n\n    E.fn.init = function () {\n\n        // 初始化 editor 默认配置\n        this.initDefaultConfig();\n\n        // 增加container\n        this.addEditorContainer();\n\n        // 增加编辑区域\n        this.addTxt();\n\n        // 增加menuContainer\n        this.addMenuContainer();\n\n        // 初始化菜单集合\n        this.menus = {};\n\n        // 初始化commandHooks\n        this.commandHooks();\n\n    };\n\n});\n// editor api\n_e(function (E, $) {\n\n    // 预定义 ready 事件\n    E.fn.ready = function (fn) {\n\n        if (!this.readyFns) {\n            this.readyFns = [];\n        }\n\n        this.readyFns.push(fn);\n    };\n\n    // 处理ready事件\n    E.fn.readyHeadler = function () {\n        var fns = this.readyFns;\n\n        while (fns.length) {\n            fns.shift().call(this);\n        }\n    };\n\n    // 更新内容到 $valueContainer\n    E.fn.updateValue = function () {\n        var editor = this;\n        var $valueContainer = editor.$valueContainer;\n        var $txt = editor.txt.$txt;\n\n        if ($valueContainer === $txt) {\n            // 传入生成编辑器的div，即是编辑区域\n            return;\n        }\n\n        var value = $txt.html();\n        $valueContainer.val(value);\n    };\n\n    // 获取初始化的内容\n    E.fn.getInitValue = function () {\n        var editor = this;\n        var $valueContainer = editor.$valueContainer;\n        var currentValue = '';\n        var nodeName = editor.valueNodeName;\n        if (nodeName === 'div') {\n            currentValue = $valueContainer.html();\n        } else if (nodeName === 'textarea') {\n            currentValue = $valueContainer.val();\n        }\n\n        return currentValue;\n    };\n\n    // 触发菜单updatestyle\n    E.fn.updateMenuStyle = function () {\n        var menus = this.menus;\n\n        $.each(menus, function (k, menu) {\n            menu.updateSelected();\n        });\n    };\n\n    // 除了传入的 menuIds，其他全部启用\n    E.fn.enableMenusExcept = function (menuIds) {\n        if (this._disabled) {\n            // 编辑器处于禁用状态，则不执行改操作\n            return;\n        }\n        // menuIds参数：支持数组和字符串\n        menuIds = menuIds || [];\n        if (typeof menuIds === 'string') {\n            menuIds = [menuIds];\n        }\n\n        $.each(this.menus, function (k, menu) {\n            if (menuIds.indexOf(k) >= 0) {\n                return;\n            }\n            menu.disabled(false);\n        });\n    };\n\n    // 除了传入的 menuIds，其他全部禁用\n    E.fn.disableMenusExcept = function (menuIds) {\n        if (this._disabled) {\n            // 编辑器处于禁用状态，则不执行改操作\n            return;\n        }\n        // menuIds参数：支持数组和字符串\n        menuIds = menuIds || [];\n        if (typeof menuIds === 'string') {\n            menuIds = [menuIds];\n        }\n\n        $.each(this.menus, function (k, menu) {\n            if (menuIds.indexOf(k) >= 0) {\n                return;\n            }\n            menu.disabled(true);\n        });\n    };\n\n    // 隐藏所有 dropPanel droplist modal\n    E.fn.hideDropPanelAndModal = function () {\n        var menus = this.menus;\n\n        $.each(menus, function (k, menu) {\n            var m = menu.dropPanel || menu.dropList || menu.modal;\n            if (m && m.hide) {\n                m.hide();\n            }\n        });\n    };\n\n});\n// selection range API\n_e(function (E, $) {\n\n    // 用到 w3c range 的函数，如果检测到浏览器不支持 w3c range，则赋值为空函数\n    var ieRange = !E.w3cRange;\n    function emptyFn() {}\n\n    // 设置或读取当前的range\n    E.fn.currentRange = function (cr){\n        if (cr) {\n            this._rangeData = cr;\n        } else {\n            return this._rangeData;\n        }\n    };\n\n    // 将当前选区折叠\n    E.fn.collapseRange = function (range, opt) {\n        // opt 参数说明：'start'-折叠到开始; 'end'-折叠到结束\n        opt = opt || 'end';\n        opt = opt === 'start' ? true : false;\n\n        range = range || this.currentRange();\n        \n        if (range) {\n            // 合并，保存\n            range.collapse(opt);\n            this.currentRange(range);\n        }\n    };\n\n    // 获取选区的文字\n    E.fn.getRangeText = ieRange ? emptyFn : function (range) {\n        range = range || this.currentRange();\n        if (!range) {\n            return;\n        }\n        return range.toString();\n    };\n\n    // 获取选区对应的DOM对象\n    E.fn.getRangeElem = ieRange ? emptyFn : function (range) {\n        range = range || this.currentRange();\n        var dom = range.commonAncestorContainer;\n\n        if (dom.nodeType === 1) {\n            return dom;\n        } else {\n            return dom.parentNode;\n        }\n    };\n\n    // 选区内容是否为空？\n    E.fn.isRangeEmpty = ieRange ? emptyFn : function (range) {\n        range = range || this.currentRange();\n\n        if (range && range.startContainer) {\n            if (range.startContainer === range.endContainer) {\n                if (range.startOffset === range.endOffset) {\n                    return true;\n                }\n            }\n        }\n\n        return false;\n    };\n\n    // 保存选区数据\n    E.fn.saveSelection = ieRange ? emptyFn : function (range) {\n        var self = this,\n            _parentElem,\n            selection,\n            txt = self.txt.$txt.get(0);\n\n        if (range) {\n            _parentElem = range.commonAncestorContainer;\n        } else {\n            selection = document.getSelection();\n            if (selection.getRangeAt && selection.rangeCount) {\n                range = document.getSelection().getRangeAt(0);\n                _parentElem = range.commonAncestorContainer;\n            }\n        }\n        // 确定父元素一定要包含在编辑器区域内\n        if (_parentElem && ($.contains(txt, _parentElem) || txt === _parentElem) ) {\n            // 保存选择区域\n            self.currentRange(range);\n        }\n    };\n\n    // 恢复选中区域\n    E.fn.restoreSelection = ieRange ? emptyFn : function (range) {\n        var selection;\n\n        range = range || this.currentRange();\n\n        if (!range) {\n            return;\n        }\n\n        // 使用 try catch 来防止 IE 某些情况报错\n        try {\n            selection = document.getSelection();\n            selection.removeAllRanges();\n            selection.addRange(range);\n        } catch (ex) {\n            E.error('执行 editor.restoreSelection 时，IE可能会有异常，不影响使用');\n        }\n    };\n\n    // 根据elem恢复选区\n    E.fn.restoreSelectionByElem = ieRange ? emptyFn : function (elem, opt) {\n        // opt参数说明：'start'-折叠到开始，'end'-折叠到结束，'all'-全部选中\n        if (!elem) {\n            return;\n        }\n        opt = opt || 'end'; // 默认为折叠到结束\n\n        // 根据elem获取选区\n        this.setRangeByElem(elem);\n\n        // 根据 opt 折叠选区\n        if (opt === 'start') {\n            this.collapseRange(this.currentRange(), 'start');\n        }\n        if (opt === 'end') {\n            this.collapseRange(this.currentRange(), 'end');\n        }\n        \n        // 恢复选区\n        this.restoreSelection();\n    };\n\n    // 初始化选区\n    E.fn.initSelection = ieRange ? emptyFn : function () {\n        var editor = this;\n        if( editor.currentRange() ){\n            //如果currentRange有值，则不用再初始化\n            return;\n        }\n\n        var range;\n        var $txt = editor.txt.$txt;\n        var $firstChild = $txt.children().first();\n        \n        if ($firstChild.length) {\n            editor.restoreSelectionByElem($firstChild.get(0));\n        }\n    };\n\n    // 根据元素创建选区\n    E.fn.setRangeByElem = ieRange ? emptyFn : function (elem) {\n        var editor = this;\n        var txtElem = editor.txt.$txt.get(0);\n        if (!elem || !$.contains(txtElem, elem)) {\n            return;\n        }\n\n        // 找到elem的第一个 textNode 和 最后一个 textNode\n        var firstTextNode = elem.firstChild;\n        while (firstTextNode) {\n            if (firstTextNode.nodeType === 3) {\n                break;\n            }\n            // 继续向下\n            firstTextNode = firstTextNode.firstChild;\n        }\n        var lastTextNode = elem.lastChild;\n        while (lastTextNode) {\n            if (lastTextNode.nodeType === 3) {\n                break;\n            }\n            // 继续向下\n            lastTextNode = lastTextNode.lastChild;\n        }\n        \n        var range = document.createRange();\n        if (firstTextNode && lastTextNode) {\n            // 说明 elem 有内容，能取到子元素\n            range.setStart(firstTextNode, 0);\n            range.setEnd(lastTextNode, lastTextNode.textContent.length);\n        } else {\n            // 说明 elem 无内容\n            range.setStart(elem, 0);\n            range.setEnd(elem, 0);\n        }\n\n        // 保存选区\n        editor.saveSelection(range);\n    };\n\n});\n// selection range API - IE8及以下\n_e(function (E, $) {\n\n    if (E.w3cRange) {\n        // 说明支持 W3C 的range方法\n        return;\n    }\n\n    // -----------------IE8时，需要重写以下方法-------------------\n\n    // 获取选区的文字\n    E.fn.getRangeText = function (range) {\n        range = range || this.currentRange();\n        if (!range) {\n            return;\n        }\n        return range.text;\n    };\n\n    // 获取选区对应的DOM对象\n    E.fn.getRangeElem = function (range) {\n        range = range || this.currentRange();\n        if (!range) {\n            return;\n        }\n        var dom = range.parentElement();\n\n        if (dom.nodeType === 1) {\n            return dom;\n        } else {\n            return dom.parentNode;\n        }\n    };\n\n    // 选区内容是否为空？\n    E.fn.isRangeEmpty = function (range) {\n        range = range || this.currentRange();\n\n        if (range && range.text) {\n            return false;\n        }\n\n        return true;\n    };\n\n    // 保存选区数据\n    E.fn.saveSelection = function (range) {\n        var self = this,\n            _parentElem,\n            selection,\n            txt = self.txt.$txt.get(0);\n\n        if (range) {\n            _parentElem = range.parentElement();\n        } else {\n            range = document.selection.createRange();\n            if(typeof range.parentElement === 'undefined'){\n                //IE6、7中，insertImage后会执行此处\n                //由于找不到range.parentElement，所以干脆将_parentElem赋值为null\n                _parentElem = null;\n            }else{\n                _parentElem = range.parentElement();\n            }\n        }\n\n        // 确定父元素一定要包含在编辑器区域内\n        if (_parentElem && ($.contains(txt, _parentElem) || txt === _parentElem) ) {\n            // 保存选择区域\n            self.currentRange(range);\n        }\n    };\n\n    // 恢复选中区域\n    E.fn.restoreSelection = function (currentRange){\n        var editor = this,\n            selection,\n            range;\n\n        currentRange = currentRange || editor.currentRange();\n        if(!currentRange){\n            return;\n        }\n\n        range = document.selection.createRange();\n        try {\n            // 此处，plupload上传上传图片时，IE8-会报一个『参数无效』的错误\n            range.setEndPoint('EndToEnd', currentRange);\n        } catch (ex) {\n\n        }\n        \n        if(currentRange.text.length === 0){\n            try {\n                // IE8 插入表情会报错\n                range.collapse(false);\n            } catch (ex) {\n                \n            }\n            \n        }else{\n            range.setEndPoint('StartToStart', currentRange);\n        }\n        range.select();\n    };\n\n});\n// editor command hooks\n_e(function (E, $) {\n    \n    E.fn.commandHooks = function () {\n        var editor = this;\n        var commandHooks = {};\n        \n        // insertHtml\n        commandHooks.insertHtml = function (html) {\n            var $elem = $(html);\n            var rangeElem = editor.getRangeElem();\n            var targetElem;\n            \n            targetElem = editor.getLegalTags(rangeElem);\n            if (!targetElem) {\n                return;\n            }\n\n            $(targetElem).after($elem);\n        };\n\n        // 保存到对象\n        editor.commandHooks = commandHooks;\n    };\n\n});\n// editor command API\n_e(function (E, $) {\n\n    // 基本命令\n    E.fn.command = function (e, commandName, commandValue, callback) {\n        var editor = this;\n        var hooks;\n        \n        function commandFn() {\n            if (!commandName) {\n                return;\n            }\n            if (editor.queryCommandSupported(commandName)) {\n                // 默认命令\n                document.execCommand(commandName, false, commandValue);\n            } else {\n                // hooks 命令\n                hooks = editor.commandHooks;\n                if (commandName in hooks) {\n                    hooks[commandName](commandValue);\n                }\n            }\n        }\n\n        this.customCommand(e, commandFn, callback);\n    };\n\n    // 针对一个elem对象执行基础命令\n    E.fn.commandForElem = function (elemOpt, e, commandName, commandValue, callback) {\n        // 取得查询elem的查询条件和验证函数\n        var selector;\n        var check;\n        if (typeof elemOpt === 'string') {\n            selector = elemOpt;\n        } else {\n            selector = elemOpt.selector;\n            check = elemOpt.check;\n        }\n\n        // 查询elem\n        var rangeElem = this.getRangeElem();\n        rangeElem = this.getSelfOrParentByName(rangeElem, selector, check);\n\n        // 根据elem设置range\n        if (rangeElem) {\n            this.setRangeByElem(rangeElem);\n        }\n\n        // 然后执行基础命令\n        this.command(e, commandName, commandValue, callback);\n    };\n\n    // 自定义命令\n    E.fn.customCommand = function (e, commandFn, callback) {\n        var editor = this;\n        var range = editor.currentRange();\n\n        if (!range) {\n            // 目前没有选区，则无法执行命令\n            e && e.preventDefault();\n            return;\n        }\n        // 记录内容，以便撤销（执行命令之前就要记录）\n        editor.undoRecord();\n\n        // 恢复选区（有 range 参数）\n        this.restoreSelection(range);\n\n        // 执行命令事件\n        commandFn.call(editor);\n\n        // 保存选区（无参数，要从浏览器直接获取range信息）\n        this.saveSelection();\n        // 重新恢复选区（无参数，要取得刚刚从浏览器得到的range信息）\n        this.restoreSelection();\n\n        // 执行 callback\n        if (callback && typeof callback === 'function') {\n            callback.call(editor);\n        }\n\n        // 最后插入空行\n        editor.txt.insertEmptyP();\n\n        // 包裹暴露的img和text\n        editor.txt.wrapImgAndText();\n\n        // 更新内容\n        editor.updateValue();\n\n        // 更新菜单样式\n        editor.updateMenuStyle();\n\n        // 隐藏 dropPanel dropList modal  设置 200ms 间隔\n        function hidePanelAndModal() {\n            editor.hideDropPanelAndModal();\n        } \n        setTimeout(hidePanelAndModal, 200);\n\n        if (e) {\n            e.preventDefault();\n        }\n    };\n\n    // 封装 document.queryCommandValue 函数\n    // IE8 直接执行偶尔会报错，因此直接用 try catch 封装一下\n    E.fn.queryCommandValue = function (commandName) {\n        var result = '';\n        try {\n            result = document.queryCommandValue(commandName);\n        } catch (ex) {\n\n        }\n        return result;\n    };\n\n    // 封装 document.queryCommandState 函数\n    // IE8 直接执行偶尔会报错，因此直接用 try catch 封装一下\n    E.fn.queryCommandState = function (commandName) {\n        var result = false;\n        try {\n            result = document.queryCommandState(commandName);\n        } catch (ex) {\n\n        }\n        return result;\n    };\n\n    // 封装 document.queryCommandSupported 函数\n    E.fn.queryCommandSupported = function (commandName) {\n        var result = false;\n        try {\n            result = document.queryCommandSupported(commandName);\n        } catch (ex) {\n\n        }\n        return result;\n    };\n\n});\n// dom selector\n_e(function (E, $) {\n\n    var matchesSelector;\n\n    // matchesSelector hook\n    function _matchesSelectorForIE(selector) {\n        var elem = this;\n        var $elems = $(selector);\n        var result = false;\n\n        // 用jquery查找 selector 所有对象，如果其中有一个和传入 elem 相同，则证明 elem 符合 selector\n        $elems.each(function () {\n            if (this === elem) {\n                result = true;\n                return false;\n            }\n        });\n\n        return result;\n    }\n\n    // 从当前的elem，往上去查找合法标签 如 p head table blockquote ul ol 等\n    E.fn.getLegalTags = function (elem) {\n        var legalTags = this.config.legalTags;\n        if (!legalTags) {\n            E.error('配置项中缺少 legalTags 的配置');\n            return;\n        }\n        return this.getSelfOrParentByName(elem, legalTags);\n    };\n\n    // 根据条件，查询自身或者父元素，符合即返回\n    E.fn.getSelfOrParentByName = function (elem, selector, check) {\n\n        if (!elem || !selector) {\n            return;\n        }\n\n        if (!matchesSelector) {\n            // 定义 matchesSelector 函数\n            matchesSelector = elem.webkitMatchesSelector || \n                              elem.mozMatchesSelector ||\n                              elem.oMatchesSelector || \n                              elem.matchesSelector;\n        }\n        if (!matchesSelector) {\n            // 如果浏览器本身不支持 matchesSelector 则使用自定义的hook\n            matchesSelector = _matchesSelectorForIE;\n        }\n\n        var txt = this.txt.$txt.get(0);\n\n        while (elem && txt !== elem && $.contains(txt, elem)) {\n            if (matchesSelector.call(elem, selector)) {\n                // 符合 selector 查询条件\n\n                if (!check) {\n                    // 没有 check 验证函数，直接返回即可\n                    return elem;\n                }\n\n                if (check(elem)) {\n                    // 如果有 check 验证函数，还需 check 函数的确认\n                    return elem;\n                }\n            }\n\n            // 如果上一步没经过验证，则将跳转到父元素\n            elem = elem.parentNode;\n        }\n\n        return;\n    };\n\n});\n// undo redo\n_e(function (E, $) {\n\n    var length = 20;  // 缓存的最大长度\n    function _getRedoList(editor) {\n        if (editor._redoList == null) {\n            editor._redoList = [];\n        }\n        return editor._redoList;\n    }\n    function _getUndoList(editor) {\n        if (editor._undoList == null) {\n            editor._undoList = [];\n        }\n        return editor._undoList;\n    }\n\n    // 数据处理\n    function _handle(editor, data, type) {\n        // var range = data.range;\n        // var range2 = range.cloneRange && range.cloneRange();\n        var val = data.val;\n        var html = editor.txt.$txt.html();\n\n        if(val == null) {\n            return;\n        }\n\n        if (val === html) {\n            if (type === 'redo') { \n                editor.redo();\n                return;\n            } else if (type === 'undo') {\n                editor.undo();\n                return;\n            } else {\n                return;\n            }\n        }\n\n        // 保存数据\n        editor.txt.$txt.html(val);\n        // 更新数据到textarea（有必要的话）\n        editor.updateValue();\n\n        // onchange 事件\n        if (editor.onchange && typeof editor.onchange === 'function') {\n            editor.onchange.call(editor);\n        }\n\n        // ?????\n        // 注释：$txt 被重新赋值之后，range会被重置，cloneRange() 也不好使\n        // // 重置选区\n        // if (range2) {\n        //     editor.restoreSelection(range2);\n        // }\n    }\n\n    // 记录\n    E.fn.undoRecord = function () {\n        var editor = this;\n        var $txt = editor.txt.$txt;\n        var val = $txt.html();\n        var undoList = _getUndoList(editor);\n        var redoList = _getRedoList(editor);\n        var currentVal = undoList.length ? undoList[0] : '';\n\n        if (val === currentVal.val) {\n            return;\n        }\n\n        // 清空 redolist\n        if (redoList.length) {\n            redoList = [];\n        }\n\n        // 添加数据到 undoList\n        undoList.unshift({\n            range: editor.currentRange(),  // 将当前的range也记录下\n            val: val\n        });\n\n        // 限制 undoList 长度\n        if (undoList.length > length) {\n            undoList.pop();\n        }\n    };\n\n    // undo 操作\n    E.fn.undo = function () {\n        var editor = this;\n        var undoList = _getUndoList(editor);\n        var redoList = _getRedoList(editor);\n\n        if (!undoList.length) {\n            return;\n        }\n\n        // 取出 undolist 第一个值，加入 redolist\n        var data = undoList.shift();\n        redoList.unshift(data);\n\n        // 并修改编辑器的内容\n        _handle(this, data, 'undo');\n    };\n\n    // redo 操作\n    E.fn.redo = function () {\n        var editor = this;\n        var undoList = _getUndoList(editor);\n        var redoList = _getRedoList(editor);\n        if (!redoList.length) {\n            return;\n        }\n\n        // 取出 redolist 第一个值，加入 undolist\n        var data = redoList.shift();\n        undoList.unshift(data);\n\n        // 并修改编辑器的内容\n        _handle(this, data, 'redo');\n    };\n});\n// 暴露给用户的 API\n_e(function (E, $) {\n\n    // 创建编辑器\n    E.fn.create = function () {\n        var editor = this;\n\n        // 检查 E.$body 是否有值\n        // 如果在 body 之前引用了 js 文件，body 尚未加载，可能没有值\n        if (!E.$body || E.$body.length === 0) {\n            E.$body = $('body');\n            E.$document = $(document);\n            E.$window = $(window);\n        }\n\n        // 执行 addMenus 之前：\n        // 1. 允许用户修改 editor.UI 自定义配置UI\n        // 2. 允许用户通过修改 editor.menus 来自定义配置菜单\n        // 因此要在 create 时执行，而不是 init           \n        editor.addMenus();\n\n        // 渲染\n        editor.renderMenus();\n        editor.renderMenuContainer();\n        editor.renderTxt();\n        editor.renderEditorContainer();\n\n        // 绑定事件\n        editor.eventMenus();\n        editor.eventMenuContainer();\n        editor.eventTxt();\n\n        // 处理ready事件\n        editor.readyHeadler();\n\n        // 初始化选区\n        editor.initSelection();\n\n        // $txt 快捷方式\n        editor.$txt = editor.txt.$txt;\n\n        // 执行用户自定义事件，通过 E.ready() 添加\n        var _plugins = E._plugins;\n        if (_plugins && _plugins.length) {\n            $.each(_plugins, function (k, val) {\n                val.call(editor);\n            });\n        }\n    };\n\n    // 禁用编辑器\n    E.fn.disable = function () {\n        this.txt.$txt.removeAttr('contenteditable');\n        this.disableMenusExcept();\n\n        // 先禁用，再记录状态\n        this._disabled = true;\n    };\n    // 启用编辑器\n    E.fn.enable = function () {\n        // 先解除状态记录，再启用\n        this._disabled = false;\n        this.txt.$txt.attr('contenteditable', 'true');\n        this.enableMenusExcept();\n    };\n\n    // 销毁编辑器\n    E.fn.destroy = function () {\n        var self = this;\n        var $valueContainer = self.$valueContainer;\n        var $editorContainer = self.$editorContainer;\n        var valueNodeName = self.valueNodeName;\n\n        if (valueNodeName === 'div') {\n            // div 生成的编辑器\n            $valueContainer.removeAttr('contenteditable');\n            $editorContainer.after($valueContainer);\n            $editorContainer.hide();\n        } else {\n            // textarea 生成的编辑器\n            $valueContainer.show();\n            $editorContainer.hide();\n        }\n    };\n\n    // 撤销 销毁编辑器\n    E.fn.undestroy = function () {\n        var self = this;\n        var $valueContainer = self.$valueContainer;\n        var $editorContainer = self.$editorContainer;\n        var $menuContainer = self.menuContainer.$menuContainer;\n        var valueNodeName = self.valueNodeName;\n\n        if (valueNodeName === 'div') {\n            // div 生成的编辑器\n            $valueContainer.attr('contenteditable', 'true');\n            $menuContainer.after($valueContainer);\n            $editorContainer.show();\n        } else {\n            // textarea 生成的编辑器\n            $valueContainer.hide();\n            $editorContainer.show();\n        }\n    };\n\n    // 清空内容的快捷方式\n    E.fn.clear = function () {\n        var editor = this;\n        var $txt = editor.txt.$txt;\n        $txt.html('<p><br></p>');\n        editor.restoreSelectionByElem($txt.find('p').get(0));\n    };\n\n});\n// menuContainer 构造函数\n_e(function (E, $) {\n\n    // 定义构造函数\n    var MenuContainer = function (editor) {\n        this.editor = editor;\n        this.init();\n    };\n\n    MenuContainer.fn = MenuContainer.prototype;\n\n    // 暴露给 E 即 window.wangEditor\n    E.MenuContainer = MenuContainer;\n\n});\n// MenuContainer.fn bind fn\n_e(function (E, $) {\n\n    var MenuContainer = E.MenuContainer;\n\n    // 初始化\n    MenuContainer.fn.init = function () {\n        var self = this;\n        var $menuContainer = $('<div class=\"wangEditor-menu-container clearfix\"></div>');\n\n        self.$menuContainer = $menuContainer;\n\n        // change shadow\n        self.changeShadow();\n    };\n\n    // 编辑区域滚动时，增加shadow\n    MenuContainer.fn.changeShadow = function () {\n        var $menuContainer = this.$menuContainer;\n        var editor = this.editor;\n        var $txt = editor.txt.$txt;\n\n        $txt.on('scroll', function () {\n            if ($txt.scrollTop() > 10) {\n                $menuContainer.addClass('wangEditor-menu-shadow');\n            } else {\n                $menuContainer.removeClass('wangEditor-menu-shadow');\n            }\n        });\n    };\n\n});\n// MenuContainer.fn API\n_e(function (E, $) {\n\n    var MenuContainer = E.MenuContainer;\n\n    MenuContainer.fn.render = function () {\n        var $menuContainer = this.$menuContainer;\n        var $editorContainer = this.editor.$editorContainer;\n\n        $editorContainer.append($menuContainer);\n    };\n    \n    // 获取菜单栏的高度\n    MenuContainer.fn.height = function () {\n        var $menuContainer = this.$menuContainer;\n        return $menuContainer.height();\n    };\n\n    // 添加菜单\n    MenuContainer.fn.appendMenu = function (groupIdx, menu) {\n        // 判断是否需要新增一个菜单组\n        this._addGroup(groupIdx);\n        // 增加菜单（返回 $menuItem）\n        return this._addOneMenu(menu);\n    };\n    MenuContainer.fn._addGroup = function (groupIdx) {\n        var $menuContainer = this.$menuContainer;\n        var $menuGroup;\n        if (!this.$currentGroup || this.currentGroupIdx !== groupIdx) {\n            $menuGroup = $('<div class=\"menu-group clearfix\"></div>');\n            $menuContainer.append($menuGroup);\n\n            this.$currentGroup = $menuGroup;\n            this.currentGroupIdx = groupIdx;\n        }\n    };\n    MenuContainer.fn._addOneMenu = function (menu) {\n        var $menuNormal = menu.$domNormal;\n        var $menuSelected = menu.$domSelected;\n\n        var $menuGroup = this.$currentGroup;\n        var $item = $('<div class=\"menu-item clearfix\"></div>');\n        $menuSelected.hide();\n        $item.append($menuNormal).append($menuSelected);\n        $menuGroup.append($item);\n\n        return $item;\n    };\n\n});\n// menu 构造函数\n_e(function (E, $) {\n\n    // 定义构造函数\n    var Menu = function (opt) {\n        this.editor = opt.editor;\n        this.id = opt.id;\n        this.title = opt.title;\n        this.$domNormal = opt.$domNormal;\n        this.$domSelected = opt.$domSelected || opt.$domNormal;\n\n        // document.execCommand 的参数\n        this.commandName = opt.commandName;\n        this.commandValue = opt.commandValue;\n        this.commandNameSelected = opt.commandNameSelected || opt.commandName;\n        this.commandValueSelected = opt.commandValueSelected || opt.commandValue;\n    };\n\n    Menu.fn = Menu.prototype;\n\n    // 暴露给 E 即 window.wangEditor\n    E.Menu = Menu;\n});\n// Menu.fn 初始化绑定的事件\n_e(function (E, $) {\n\n    var Menu = E.Menu;\n\n    // 初始化UI\n    Menu.fn.initUI = function () {\n        var editor = this.editor;\n        var uiConfig = editor.UI.menus;\n        var menuId = this.id;\n        var menuUI = uiConfig[menuId];\n\n        if (this.$domNormal && this.$domSelected) {\n            // 自定义的菜单中，已经传入了 $dom 无需从配置文件中查找生成\n            return;\n        }\n\n        if (menuUI == null) {\n            E.warn('editor.UI配置中，没有菜单 \"' + menuId + '\" 的UI配置，只能取默认值');\n            \n            // 必须写成 uiConfig['default'];\n            // 写成 uiConfig.default IE8会报错\n            menuUI = uiConfig['default'];\n        }\n\n        // 正常状态\n        this.$domNormal = $(menuUI.normal);\n\n        // 选中状态\n        if (/^\\./.test(menuUI.selected)) {\n            // 增加一个样式\n            this.$domSelected = this.$domNormal.clone().addClass(menuUI.selected.slice(1));\n        } else {\n            // 一个新的dom对象\n            this.$domSelected = $(menuUI.selected);\n        }\n    };\n\n});\n// Menu.fn API\n_e(function (E, $) {\n\n    var Menu = E.Menu;\n\n    // 渲染菜单\n    Menu.fn.render = function (groupIdx) {\n        // 渲染UI\n        this.initUI();\n        \n        var editor = this.editor;\n        var menuContainer = editor.menuContainer;\n        var $menuItem = menuContainer.appendMenu(groupIdx, this);\n        var onRender = this.onRender;\n\n        // 渲染tip\n        this._renderTip($menuItem);\n\n        // 执行 onRender 函数\n        if (onRender && typeof onRender === 'function') {\n            onRender.call(this);\n        }\n    };\n    Menu.fn._renderTip = function ($menuItem) {\n        var self = this;\n        var editor = self.editor;\n        var title = self.title;\n        var $tip = $('<div class=\"menu-tip\"></div>');\n        // var $triangle = $('<i class=\"tip-triangle\"></i>'); // 小三角\n\n        // 计算 tip 宽度\n        var $tempDiv;\n        if (!self.tipWidth) {\n            // 设置一个纯透明的 p（absolute;top:-10000px;不会显示在内容区域）\n            // 内容赋值为 title ，为了计算tip宽度\n            $tempDiv = $('<p style=\"opacity:0; filter:Alpha(opacity=0); position:absolute;top:-10000px;\">' + title + '</p>');\n            // 先添加到body，计算完再 remove\n            E.$body.append($tempDiv);\n            editor.ready(function () {\n                var editor = this;\n                var titleWidth = $tempDiv.outerWidth() + 5; // 多出 5px 的冗余\n                var currentWidth = $tip.outerWidth();\n                var currentMarginLeft = parseFloat($tip.css('margin-left'), 10);\n                // 计算完，拿到数据，则弃用\n                $tempDiv.remove();\n                $tempDiv = null;\n\n                // 重新设置样式\n                $tip.css({\n                    width: titleWidth,\n                    'margin-left': currentMarginLeft + (currentWidth - titleWidth)/2\n                });\n\n                // 存储\n                self.tipWidth = titleWidth;\n            });\n        }\n\n        // $tip.append($triangle);\n        $tip.append(title);\n        $menuItem.append($tip);\n\n        function show() {\n            $tip.show();\n        }\n        function hide() {\n            $tip.hide();\n        }\n\n        var timeoutId;\n        $menuItem.find('a').on('mouseenter', function (e) {\n            if (!self.active() && !self.disabled()) {\n                timeoutId = setTimeout(show, 200);\n            }\n        }).on('mouseleave', function (e) {\n            timeoutId && clearTimeout(timeoutId);\n            hide();\n        }).on('click', hide);\n    };\n\n    // 绑定事件\n    Menu.fn.bindEvent = function () {\n        var self = this;\n\n        var $domNormal = self.$domNormal;\n        var $domSelected = self.$domSelected;\n\n        // 试图获取该菜单定义的事件（未selected），没有则自己定义\n        var clickEvent = self.clickEvent;\n        if (!clickEvent) {\n            clickEvent = function (e) {\n                // -----------dropPanel dropList modal-----------\n                var dropObj = self.dropPanel || self.dropList || self.modal;\n                if (dropObj && dropObj.show) {\n                    if (dropObj.isShowing) {\n                        dropObj.hide();\n                    } else {\n                        dropObj.show();\n                    }\n                    return;\n                }\n\n                // -----------command-----------\n                var editor = self.editor;\n                var commandName;\n                var commandValue;\n\n                var selected = self.selected;\n                if (selected) {\n                    commandName = self.commandNameSelected;\n                    commandValue = self.commandValueSelected;\n                } else {\n                    commandName = self.commandName;\n                    commandValue = self.commandValue;\n                }\n\n                if (commandName) {\n                    // 执行命令\n                    editor.command(e, commandName, commandValue);\n                } else {\n                    // 提示\n                    E.warn('菜单 \"' + self.id + '\" 未定义click事件');\n                    e.preventDefault();\n                }\n            };\n        }\n        // 获取菜单定义的selected情况下的点击事件\n        var clickEventSelected = self.clickEventSelected || clickEvent;\n\n        // 将事件绑定到菜单dom上\n        $domNormal.click(function (e) {\n            if (!self.disabled()) {\n                clickEvent.call(self, e);\n                self.updateSelected();\n            }\n            e.preventDefault();\n        });\n        $domSelected.click(function (e) {\n            if (!self.disabled()) {\n                clickEventSelected.call(self, e);\n                self.updateSelected();\n            }\n            e.preventDefault();\n        });\n    };\n\n    // 更新选中状态\n    Menu.fn.updateSelected = function () {\n        var self = this;\n        var editor = self.editor;\n\n        // 试图获取用户自定义的判断事件\n        var updateSelectedEvent = self.updateSelectedEvent;\n        if (!updateSelectedEvent) {\n            // 用户未自定义，则设置默认值\n            updateSelectedEvent = function () {\n                var self = this;\n                var editor = self.editor;\n                var commandName = self.commandName;\n                var commandValue = self.commandValue;\n\n                if (commandValue) {\n                    if (editor.queryCommandValue(commandName).toLowerCase() === commandValue.toLowerCase()) {\n                        return true;\n                    }\n                } else if (editor.queryCommandState(commandName)) {\n                    return true;\n                }\n\n                return false;\n            };\n        }\n\n        // 获取结果\n        var result = updateSelectedEvent.call(self);\n        result = !!result;\n\n        // 存储结果、显示效果\n        self.changeSelectedState(result);\n    };\n\n    // 切换选中状态、显示效果\n    Menu.fn.changeSelectedState = function (state) {\n        var self = this;\n        var selected = self.selected;\n\n        if (state != null && typeof state === 'boolean') {\n            if (selected === state) {\n                // 计算结果和当前的状态一样\n                return;\n            }\n            // 存储结果\n            self.selected = state;\n\n            // 切换菜单的显示\n            if (state) {\n                // 选中\n                self.$domNormal.hide();\n                self.$domSelected.show();\n            } else {\n                // 未选中\n                self.$domNormal.show();\n                self.$domSelected.hide();\n            }\n        } // if\n    };\n\n    // 点击菜单，显示了 dropPanel modal 时，菜单的状态 \n    Menu.fn.active = function (active) {\n        if (active == null) {\n            return this._activeState;\n        }\n        this._activeState = active;\n    };\n    Menu.fn.activeStyle = function (active) {\n        var selected = this.selected;\n        var $dom = this.$domNormal;\n        var $domSelected = this.$domSelected;\n\n        if (active) {\n            $dom.addClass('active');\n            $domSelected.addClass('active');\n        } else {\n            $dom.removeClass('active');\n            $domSelected.removeClass('active');\n        }\n\n        // 记录状态 （ menu hover 时会取状态用 ）\n        this.active(active);\n    };\n\n    // 菜单的启用和禁用\n    Menu.fn.disabled = function (opt) {\n        // 参数为空，取值\n        if (opt == null) {\n            return !!this._disabled;\n        }\n\n        if (this._disabled === opt) {\n            // 要设置的参数值和当前参数只一样，无需再次设置\n            return;\n        }\n\n        var $dom = this.$domNormal;\n        var $domSelected = this.$domSelected;\n\n        // 设置样式\n        if (opt) {\n            $dom.addClass('disable');\n            $domSelected.addClass('disable');\n        } else {\n            $dom.removeClass('disable');\n            $domSelected.removeClass('disable');\n        }\n\n        // 存储\n        this._disabled = opt;\n    };\n\n});\n// dropList 构造函数\n_e(function (E, $) {\n\n    // 定义构造函数\n    var DropList = function (editor, menu, opt) {\n        this.editor = editor;\n        this.menu = menu;\n\n        // list 的数据源，格式 {'commandValue': 'title', ...}\n        this.data = opt.data;\n        // 要为每个item自定义的模板\n        this.tpl = opt.tpl;\n        // 为了执行 editor.commandForElem 而传入的elem查询方式\n        this.selectorForELemCommand = opt.selectorForELemCommand;\n\n        // 执行事件前后的钩子\n        this.beforeEvent = opt.beforeEvent;\n        this.afterEvent = opt.afterEvent;\n\n        // 初始化\n        this.init();\n    };\n\n    DropList.fn = DropList.prototype;\n\n    // 暴露给 E 即 window.wangEditor\n    E.DropList = DropList;\n});\n// dropList fn bind\n_e(function (E, $) {\n\n    var DropList = E.DropList;\n\n    // init\n    DropList.fn.init = function () {\n        var self = this;\n\n        // 生成dom对象\n        self.initDOM();\n\n        // 绑定command事件\n        self.bindEvent();\n\n        // 声明隐藏的事件\n        self.initHideEvent();\n    };\n\n    // 初始化dom结构\n    DropList.fn.initDOM = function () {\n        var self = this;\n        var data = self.data;\n        var tpl = self.tpl || '<span>{#title}</span>';\n        var $list = $('<div class=\"wangEditor-drop-list clearfix\"></div>');\n\n        var itemContent;\n        var $item;\n        $.each(data, function (commandValue, title) {\n            itemContent = tpl.replace(/{#commandValue}/ig, commandValue).replace(/{#title}/ig, title);\n            $item = $('<a href=\"#\" commandValue=\"' + commandValue + '\"></a>');\n            $item.append(itemContent);\n            $list.append($item);\n        });\n\n        self.$list = $list;\n    };\n\n    // 绑定事件\n    DropList.fn.bindEvent = function () {\n        var self = this;\n        var editor = self.editor;\n        var menu = self.menu;\n        var commandName = menu.commandName;\n        var selectorForELemCommand = self.selectorForELemCommand;\n        var $list = self.$list;\n\n        // 执行事件前后的钩子函数\n        var beforeEvent = self.beforeEvent;\n        var afterEvent = self.afterEvent;\n\n        $list.on('click', 'a[commandValue]', function (e) {\n            // 正式命令执行之前\n            if (beforeEvent && typeof beforeEvent === 'function') {\n                beforeEvent.call(e);\n            }\n\n            // 执行命令\n            var commandValue = $(e.currentTarget).attr('commandValue');\n            if (menu.selected && editor.isRangeEmpty() && selectorForELemCommand) {\n                // 当前处于选中状态，并且选中内容为空\n                editor.commandForElem(selectorForELemCommand, e, commandName, commandValue);\n            } else {\n                // 当前未处于选中状态，或者有选中内容。则执行默认命令\n                editor.command(e, commandName, commandValue);\n            }\n\n            // 正式命令之后的钩子\n            if (afterEvent && typeof afterEvent === 'function') {\n                afterEvent.call(e);\n            }\n        });\n    };\n\n    // 点击其他地方，立即隐藏 droplist\n    DropList.fn.initHideEvent = function () {\n        var self = this;\n\n        // 获取 list elem\n        var thisList = self.$list.get(0);\n\n        E.$body.on('click', function (e) {\n            if (!self.isShowing) {\n                return;\n            }\n            var trigger = e.target;\n\n            // 获取菜单elem\n            var menu = self.menu;\n            var menuDom;\n            if (menu.selected) {\n                menuDom = menu.$domSelected.get(0);\n            } else {\n                menuDom = menu.$domNormal.get(0);\n            }\n\n            if (menuDom === trigger || $.contains(menuDom, trigger)) {\n                // 说明由本菜单点击触发的\n                return;\n            }\n\n            if (thisList === trigger || $.contains(thisList, trigger)) {\n                // 说明由本list点击触发的\n                return;\n            }\n\n            // 其他情况，隐藏 list\n            self.hide();\n        });\n\n        E.$window.scroll(function () {\n            self.hide();\n        });\n\n        E.$window.on('resize', function () {\n            self.hide();\n        });\n    };\n\n});\n// dropListfn api\n_e(function (E, $) {\n    \n    var DropList = E.DropList;\n\n    // 渲染\n    DropList.fn._render = function () {\n        var self = this;\n        var editor = self.editor;\n        var $list = self.$list;\n\n        // 渲染到页面\n        editor.$editorContainer.append($list);\n\n        // 记录状态\n        self.rendered = true;\n    };\n\n    // 定位\n    DropList.fn._position = function () {\n        var self = this;\n        var $list = self.$list;\n        var editor = self.editor;\n        var menu = self.menu;\n        var $menuContainer = editor.menuContainer.$menuContainer;\n        var $menuDom = menu.selected ? menu.$domSelected : menu.$domNormal;\n        // 注意这里的 offsetParent() 要返回 .menu-item 的 position\n        // 因为 .menu-item 是 position:relative\n        var menuPosition = $menuDom.offsetParent().position();\n\n        // 取得 menu 的位置、尺寸属性\n        var menuTop = menuPosition.top;\n        var menuLeft = menuPosition.left;\n        var menuHeight = $menuDom.offsetParent().height();\n        var menuWidth = $menuDom.offsetParent().width();\n\n        // 取得 list 的尺寸属性\n        var listWidth = $list.outerWidth();\n        // var listHeight = $list.outerHeight();\n\n        // 取得 $txt 的尺寸\n        var txtWidth = editor.txt.$txt.outerWidth();\n\n        // ------------开始计算-------------\n\n        // 初步计算 list 位置属性\n        var top = menuTop + menuHeight;\n        var left = menuLeft + menuWidth/2;\n        var marginLeft = 0 - menuWidth/2;\n\n        // 如果超出了有边界，则要左移（且和右侧有间隙）\n        var valWithTxt = (left + listWidth) - txtWidth;\n        if (valWithTxt > -10) {\n            marginLeft = marginLeft - valWithTxt - 10;\n        }\n        // 设置样式\n        $list.css({\n            top: top,\n            left: left,\n            'margin-left': marginLeft\n        });\n\n        // 如果因为向下滚动而导致菜单fixed，则再加一步处理\n        if (editor._isMenufixed) {\n            top = top + (($menuContainer.offset().top + $menuContainer.outerHeight()) - $list.offset().top);\n\n            // 重新设置top\n            $list.css({\n                top: top\n            });\n        }\n    };\n\n    // 显示\n    DropList.fn.show = function () {\n        var self = this;\n        var menu = self.menu;\n        if (!self.rendered) {\n            // 第一次show之前，先渲染\n            self._render();\n        }\n\n        if (self.isShowing) {\n            return;\n        }\n\n        var $list = self.$list;\n        $list.show();\n\n        // 定位\n        self._position();\n\n        // 记录状态\n        self.isShowing = true;\n\n        // 菜单状态\n        menu.activeStyle(true);\n    };\n\n    // 隐藏\n    DropList.fn.hide = function () {\n        var self = this;\n        var menu = self.menu;\n        if (!self.isShowing) {\n            return;\n        }\n\n        var $list = self.$list;\n        $list.hide();\n\n        // 记录状态\n        self.isShowing = false;\n\n        // 菜单状态\n        menu.activeStyle(false);\n    };\n});\n// dropPanel 构造函数\n_e(function (E, $) {\n\n    // 定义构造函数\n    var DropPanel = function (editor, menu, opt) {\n        this.editor = editor;\n        this.menu = menu;\n        this.$content = opt.$content;\n        this.width = opt.width || 200;\n        this.height = opt.height;\n        this.onRender = opt.onRender;\n\n        // init\n        this.init();\n    };\n\n    DropPanel.fn = DropPanel.prototype;\n\n    // 暴露给 E 即 window.wangEditor\n    E.DropPanel = DropPanel;\n});\n// dropPanel fn bind\n_e(function (E, $) {\n\n    var DropPanel = E.DropPanel;\n\n    // init\n    DropPanel.fn.init = function () {\n        var self = this;\n\n        // 生成dom对象\n        self.initDOM();\n\n        // 声明隐藏的事件\n        self.initHideEvent();\n    };\n\n    // init DOM\n    DropPanel.fn.initDOM = function () {\n        var self = this;\n        var $content = self.$content;\n        var width = self.width;\n        var height = self.height;\n        var $panel = $('<div class=\"wangEditor-drop-panel clearfix\"></div>');\n        var $triangle = $('<div class=\"tip-triangle\"></div>');\n\n        $panel.css({\n            width: width,\n            height: height ? height : 'auto'\n        });\n        $panel.append($triangle);\n        $panel.append($content);\n\n        // 添加对象数据\n        self.$panel = $panel;\n        self.$triangle = $triangle;\n    };\n\n    // 点击其他地方，立即隐藏 dropPanel\n    DropPanel.fn.initHideEvent = function () {\n        var self = this;\n\n        // 获取 panel elem\n        var thisPanle = self.$panel.get(0);\n\n        E.$body.on('click', function (e) {\n            if (!self.isShowing) {\n                return;\n            }\n            var trigger = e.target;\n\n            // 获取菜单elem\n            var menu = self.menu;\n            var menuDom;\n            if (menu.selected) {\n                menuDom = menu.$domSelected.get(0);\n            } else {\n                menuDom = menu.$domNormal.get(0);\n            }\n\n            if (menuDom === trigger || $.contains(menuDom, trigger)) {\n                // 说明由本菜单点击触发的\n                return;\n            }\n\n            if (thisPanle === trigger || $.contains(thisPanle, trigger)) {\n                // 说明由本panel点击触发的\n                return;\n            }\n\n            // 其他情况，隐藏 panel\n            self.hide();\n        });\n\n        E.$window.scroll(function (e) {\n            self.hide();\n        });\n\n        E.$window.on('resize', function () {\n            self.hide();\n        });\n    };\n\n});\n// dropPanel fn api\n_e(function (E, $) {\n   \n    var DropPanel = E.DropPanel;\n\n    // 渲染\n    DropPanel.fn._render = function () {\n        var self = this;\n        var onRender = self.onRender;\n        var editor = self.editor;\n        var $panel = self.$panel;\n\n        // 渲染到页面\n        editor.$editorContainer.append($panel);\n\n        // 渲染后的回调事件\n        onRender && onRender.call(self);\n\n        // 记录状态\n        self.rendered = true;\n    };\n\n    // 定位\n    DropPanel.fn._position = function () {\n        var self = this;\n        var $panel = self.$panel;\n        var $triangle = self.$triangle;\n        var editor = self.editor;\n        var $menuContainer = editor.menuContainer.$menuContainer;\n        var menu = self.menu;\n        var $menuDom = menu.selected ? menu.$domSelected : menu.$domNormal;\n        // 注意这里的 offsetParent() 要返回 .menu-item 的 position\n        // 因为 .menu-item 是 position:relative\n        var menuPosition = $menuDom.offsetParent().position();\n\n        // 取得 menu 的位置、尺寸属性\n        var menuTop = menuPosition.top;\n        var menuLeft = menuPosition.left;\n        var menuHeight = $menuDom.offsetParent().height();\n        var menuWidth = $menuDom.offsetParent().width();\n\n        // 取得 panel 的尺寸属性\n        var panelWidth = $panel.outerWidth();\n        // var panelHeight = $panel.outerHeight();\n\n        // 取得 $txt 的尺寸\n        var txtWidth = editor.txt.$txt.outerWidth();\n\n        // ------------开始计算-------------\n\n        // 初步计算 panel 位置属性\n        var top = menuTop + menuHeight;\n        var left = menuLeft + menuWidth/2;\n        var marginLeft = 0 - panelWidth/2;\n        var marginLeft2 = marginLeft;  // 下文用于和 marginLeft 比较，来设置三角形tip的位置\n\n        // 如果超出了左边界，则移动回来（要和左侧有10px间隙）\n        if ((0 - marginLeft) > (left - 10)) {\n            marginLeft = 0 - (left - 10);\n        }\n\n        // 如果超出了有边界，则要左移（且和右侧有10px间隙）\n        var valWithTxt = (left + panelWidth + marginLeft) - txtWidth;\n        if (valWithTxt > -10) {\n            marginLeft = marginLeft - valWithTxt - 10;\n        }\n\n        // 设置样式\n        $panel.css({\n            top: top,\n            left: left,\n            'margin-left': marginLeft\n        });\n\n        // 如果因为向下滚动而导致菜单fixed，则再加一步处理\n        if (editor._isMenufixed) {\n            top = top + (($menuContainer.offset().top + $menuContainer.outerHeight()) - $panel.offset().top);\n\n            // 重新设置top\n            $panel.css({\n                top: top\n            });\n        }\n\n        // 设置三角形 tip 的位置\n        $triangle.css({\n            'margin-left': marginLeft2 - marginLeft - 5\n        });\n    };\n\n    // focus 第一个 input\n    DropPanel.fn.focusFirstInput = function () {\n        var self = this;\n        var $panel = self.$panel;\n        $panel.find('input[type=text],textarea').each(function () {\n            var $input = $(this);\n            if ($input.attr('disabled') == null) {\n                $input.focus();\n                return false;\n            }\n        });\n    };\n\n    // 显示\n    DropPanel.fn.show = function () {\n        var self = this;\n        var menu = self.menu;\n        if (!self.rendered) {\n            // 第一次show之前，先渲染\n            self._render();\n        }\n\n        if (self.isShowing) {\n            return;\n        }\n\n        var $panel = self.$panel;\n        $panel.show();\n\n        // 定位\n        self._position();\n\n        // 记录状态\n        self.isShowing = true;\n\n        // 菜单状态\n        menu.activeStyle(true);\n\n        if (E.w3cRange) {\n            // 高级浏览器\n            self.focusFirstInput();\n        } else {\n            // 兼容 IE8 input placeholder\n            E.placeholderForIE8($panel);\n        }\n    };\n\n    // 隐藏\n    DropPanel.fn.hide = function () {\n        var self = this;\n        var menu = self.menu;\n        if (!self.isShowing) {\n            return;\n        }\n\n        var $panel = self.$panel;\n        $panel.hide();\n\n        // 记录状态\n        self.isShowing = false;\n\n        // 菜单状态\n        menu.activeStyle(false);\n    };\n\n});\n// modal 构造函数\n_e(function (E, $) {\n\n    // 定义构造函数\n    var Modal = function (editor, menu, opt) {\n        this.editor = editor;\n        this.menu = menu;\n        this.$content = opt.$content;\n\n        this.init();\n    };\n\n    Modal.fn = Modal.prototype;\n\n    // 暴露给 E 即 window.wangEditor\n    E.Modal = Modal;\n});\n// modal fn bind\n_e(function (E, $) {\n\n    var Modal = E.Modal;\n\n    Modal.fn.init = function () {\n        var self = this;\n\n        // 初始化dom\n        self.initDom();\n\n        // 初始化隐藏事件\n        self.initHideEvent();\n    };\n\n    // 初始化dom\n    Modal.fn.initDom = function () {\n        var self = this;\n        var $content = self.$content;\n        var $modal = $('<div class=\"wangEditor-modal\"></div>');\n        var $close = $('<div class=\"wangEditor-modal-close\"><i class=\"wangeditor-menu-img-cancel-circle\"></i></div>');\n\n        $modal.append($close);\n        $modal.append($content);\n\n        // 记录数据\n        self.$modal = $modal;\n        self.$close = $close;\n    };\n\n    // 初始化隐藏事件\n    Modal.fn.initHideEvent = function () {\n        var self = this;\n        var $close = self.$close;\n        var modal = self.$modal.get(0);\n\n        // 点击 $close 按钮，隐藏\n        $close.click(function () {\n            self.hide();\n        });\n\n        // 点击其他部分，隐藏\n        E.$body.on('click', function (e) {\n            if (!self.isShowing) {\n                return;\n            }\n            var trigger = e.target;\n\n            // 获取菜单elem\n            var menu = self.menu;\n            var menuDom;\n            if (menu) {\n                if (menu.selected) {\n                    menuDom = menu.$domSelected.get(0);\n                } else {\n                    menuDom = menu.$domNormal.get(0);\n                }\n\n                if (menuDom === trigger || $.contains(menuDom, trigger)) {\n                    // 说明由本菜单点击触发的\n                    return;\n                }\n            }\n\n            if (modal === trigger || $.contains(modal, trigger)) {\n                // 说明由本panel点击触发的\n                return;\n            }\n\n            // 其他情况，隐藏 panel\n            self.hide();\n        });\n    };\n});\n// modal fn api\n_e(function (E, $) {\n\n    var Modal = E.Modal;\n\n    // 渲染\n    Modal.fn._render = function () {\n        var self = this;\n        var editor = self.editor;\n        var $modal = self.$modal;\n\n        // $modal的z-index，在配置的z-index基础上再 +10\n        $modal.css('z-index', editor.config.zindex + 10 + '');\n\n        // 渲染到body最后面\n        E.$body.append($modal);\n\n        // 记录状态\n        self.rendered = true;\n    };\n\n    // 定位\n    Modal.fn._position = function () {\n        var self = this;\n        var $modal = self.$modal;\n        var top = $modal.offset().top;\n        var width = $modal.outerWidth();\n        var height = $modal.outerHeight();\n        var marginLeft = 0 - (width / 2);\n        var marginTop = 0 - (height / 2);\n        var sTop = E.$window.scrollTop();\n\n        // 保证modal最顶部，不超过浏览器上边框\n        if ((height / 2) > top) {\n            marginTop = 0 - top;\n        }\n\n        $modal.css({\n            'margin-left': marginLeft + 'px',\n            'margin-top': (marginTop + sTop) + 'px'\n        });\n    };\n\n    // 显示\n    Modal.fn.show = function () {\n        var self = this;\n        var menu = self.menu;\n        if (!self.rendered) {\n            // 第一次show之前，先渲染\n            self._render();\n        }\n\n        if (self.isShowing) {\n            return;\n        }\n        // 记录状态\n        self.isShowing = true;\n\n        var $modal = self.$modal;\n        $modal.show();\n\n        // 定位\n        self._position();\n\n        // 激活菜单状态\n        menu && menu.activeStyle(true);\n    };\n\n    // 隐藏\n    Modal.fn.hide = function () {\n        var self = this;\n        var menu = self.menu;\n        if (!self.isShowing) {\n            return;\n        }\n        // 记录状态\n        self.isShowing = false;\n\n        // 隐藏\n        var $modal = self.$modal;\n        $modal.hide();\n\n        // 菜单状态\n        menu && menu.activeStyle(false);\n    };\n});\n// txt 构造函数\n_e(function (E, $) {\n\n    // 定义构造函数\n    var Txt = function (editor) {\n        this.editor = editor;\n\n        // 初始化\n        this.init();\n    };\n\n    Txt.fn = Txt.prototype;\n\n    // 暴露给 E 即 window.wangEditor\n    E.Txt = Txt;\n});\n// Txt.fn bind fn\n_e(function (E, $) {\n\n    var Txt = E.Txt;\n\n    // 初始化\n    Txt.fn.init = function () {\n        var self = this;\n        var editor = self.editor;\n        var $valueContainer = editor.$valueContainer;\n        var currentValue = editor.getInitValue();\n        var $txt;\n\n        if ($valueContainer.get(0).nodeName === 'DIV') {\n            // 如果传入生成编辑器的元素就是div，则直接使用\n            $txt = $valueContainer;\n            $txt.addClass(\"wangEditor-txt\");\n            $txt.attr('contentEditable', 'true');\n        } else {\n            // 如果不是div（是textarea），则创建一个div\n            $txt = $(\n                '<div class=\"wangEditor-txt\" contentEditable=\"true\">' +\n                    currentValue +\n                '</div>'\n            );\n        }\n\n        // 试图最后插入一个空行，ready之后才行\n        editor.ready(function () {\n            self.insertEmptyP();\n        });\n\n        self.$txt = $txt;\n\n        // 删除时，如果没有内容了，就添加一个 <p><br></p>\n        self.contentEmptyHandle();\n\n        // enter时，不能使用 div 换行\n        self.bindEnterForDiv();\n\n        // enter时，用 p 包裹 text\n        self.bindEnterForText();\n\n        // tab 插入4个空格\n        self.bindTabEvent();\n\n        // 处理粘贴内容\n        self.bindPasteFilter();\n\n        // $txt.formatText() 方法\n        self.bindFormatText();\n\n        // 定义 $txt.html() 方法\n        self.bindHtml();\n    };\n\n    // 删除时，如果没有内容了，就添加一个 <p><br></p>\n    Txt.fn.contentEmptyHandle = function () {\n        var self = this;\n        var editor = self.editor;\n        var $txt = self.$txt;\n        var $p;\n\n        $txt.on('keydown', function (e) {\n            if (e.keyCode !== 8) {\n                return;\n            }\n            var txtHtml = $.trim($txt.html().toLowerCase());\n            if (txtHtml === '<p><br></p>') {\n                // 如果最后还剩余一个空行，就不再继续删除了\n                e.preventDefault();\n                return;\n            }\n        });\n\n        $txt.on('keyup', function (e) {\n            if (e.keyCode !== 8) {\n                return;\n            }\n            var txtHtml = $.trim($txt.html().toLowerCase());\n            // ff时用 txtHtml === '<br>' 判断，其他用 !txtHtml 判断\n            if (!txtHtml || txtHtml === '<br>') {\n                // 内容空了\n                $p = $('<p><br/></p>');\n                $txt.html(''); // 一定要先清空，否则在 ff 下有问题\n                $txt.append($p);\n                editor.restoreSelectionByElem($p.get(0));\n            }\n        });\n    };\n\n    // enter时，不能使用 div 换行\n    Txt.fn.bindEnterForDiv = function () {\n        var tags = E.config.legalTags; // 配置中编辑器要求的合法标签，如 p head table blockquote ul ol 等\n        var self = this;\n        var editor = self.editor;\n        var $txt = self.$txt;\n\n        var $keydownDivElem;\n        function divHandler() {\n            if (!$keydownDivElem) {\n                return;\n            }\n\n            var $pElem = $('<p>' + $keydownDivElem.html() + '</p>');\n            $keydownDivElem.after($pElem);\n            $keydownDivElem.remove();\n        }\n\n        $txt.on('keydown keyup', function (e) {\n            if (e.keyCode !== 13) {\n                return;\n            }\n            // 查找合法标签\n            var rangeElem = editor.getRangeElem();\n            var targetElem = editor.getLegalTags(rangeElem);\n            var $targetElem;\n            var $pElem;\n\n            if (!targetElem) {\n                // 没找到合法标签，就去查找 div\n                targetElem = editor.getSelfOrParentByName(rangeElem, 'div');\n                if (!targetElem) {\n                    return;\n                }\n                $targetElem = $(targetElem);\n\n                if (e.type === 'keydown') {\n                    // 异步执行（同步执行会出现问题）\n                    $keydownDivElem = $targetElem;\n                    setTimeout(divHandler, 0);\n                }\n\n                if (e.type === 'keyup') {\n                    // 将 div 的内容移动到 p 里面，并移除 div\n                    $pElem = $('<p>' + $targetElem.html() + '</p>');\n                    $targetElem.after($pElem);\n                    $targetElem.remove();\n\n                    // 如果是回车结束，将选区定位到行首\n                    editor.restoreSelectionByElem($pElem.get(0), 'start');\n                }\n            }\n        });\n    };\n\n    // enter时，用 p 包裹 text\n    Txt.fn.bindEnterForText = function () {\n        var self = this;\n        var $txt = self.$txt;\n        var handle;\n        $txt.on('keyup', function (e) {\n            if (e.keyCode !== 13) {\n                return;\n            }\n            if (!handle) {\n                handle = function() {\n                    self.wrapImgAndText();\n                };\n            }\n            setTimeout(handle);\n        });\n    };\n\n    // tab 时，插入4个空格\n    Txt.fn.bindTabEvent = function () {\n        var self = this;\n        var editor = self.editor;\n        var $txt = self.$txt;\n\n        $txt.on('keydown', function (e) {\n            if (e.keyCode !== 9) {\n                // 只监听 tab 按钮\n                return;\n            }\n            // 如果浏览器支持 insertHtml 则插入4个空格。如果不支持，就不管了\n            if (editor.queryCommandSupported('insertHtml')) {\n                editor.command(e, 'insertHtml', '&nbsp;&nbsp;&nbsp;&nbsp;');\n            }\n        });\n    };\n\n    // 处理粘贴内容\n    Txt.fn.bindPasteFilter = function () {\n        var self = this;\n        var editor = self.editor;\n        var resultHtml = '';  //存储最终的结果\n        var $txt = self.$txt;\n        var legalTags = editor.config.legalTags;\n        var legalTagArr = legalTags.split(',');\n\n        $txt.on('paste', function (e) {\n            if (!editor.config.pasteFilter) {\n                // 配置中取消了粘贴过滤\n                return;\n            }\n\n            var currentNodeName = editor.getRangeElem().nodeName;\n            if (currentNodeName === 'TD' || currentNodeName === 'TH') {\n                // 在表格的单元格中粘贴，忽略所有内容。否则会出现异常情况\n                return;\n            }\n\n            resultHtml = ''; // 先清空 resultHtml\n\n            var pasteHtml, $paste, docSplitHtml;\n            var data = e.clipboardData || e.originalEvent.clipboardData;\n            var ieData = window.clipboardData;\n\n            if (editor.config.pasteText) {\n                // 只粘贴纯文本\n\n                if (data && data.getData) {\n                    // w3c\n                    pasteHtml = data.getData('text/plain');\n                } else if (ieData && ieData.getData) {\n                    // IE\n                    pasteHtml = ieData.getData('text');\n                } else {\n                    // 其他情况\n                    return;\n                }\n\n                // 拼接为 <p> 标签\n                if (pasteHtml) {\n                    resultHtml = '<p>' + pasteHtml + '</p>';\n                }\n\n            } else {\n                // 粘贴过滤了样式的、只有标签的 html\n\n                if (data && data.getData) {\n                    // w3c\n\n                    // 获取粘贴过来的html\n                    pasteHtml = data.getData('text/html');\n\n                    // 过滤从 word excel 粘贴过来的乱码\n                    docSplitHtml = pasteHtml.split('</html>');\n                    if (docSplitHtml.length === 2) {\n                        pasteHtml = docSplitHtml[0];\n                    }\n\n                    if (pasteHtml) {\n                        // 创建dom\n                        $paste = $('<div>' + pasteHtml + '</div>');\n                        // 处理，并将结果存储到 resultHtml 『全局』变量\n                        handle($paste.get(0));\n                    } else {\n                        // 得不到html，试图获取text\n                        pasteHtml = data.getData('text/plain');\n                        if (pasteHtml) {\n                            // 替换特殊字符\n                            pasteHtml = pasteHtml.replace(/[ ]/g, '&nbsp;')\n                                                 .replace(/</g, '&lt;')\n                                                 .replace(/>/g, '&gt;')\n                                                 .replace(/\\n/g, '</p><p>');\n                            // 拼接\n                            resultHtml = '<p>' + pasteHtml + '</p>';\n\n                            // 查询链接\n                            resultHtml = resultHtml.replace(/<p>(https?:\\/\\/.*?)<\\/p>/ig, function (match, link) {\n                                return '<p><a href=\"' + link + '\" target=\"_blank\">' + link + '</p>';\n                            });\n                        }\n                    }\n                    \n                } else if (ieData && ieData.getData) {\n                    // IE 直接从剪切板中取出纯文本格式\n                    resultHtml = ieData.getData('text');\n                    if (!resultHtml) {\n                        return;\n                    }\n                    // 拼接为 <p> 标签\n                    resultHtml = '<p>' + resultHtml + '</p>';\n                    resultHtml = resultHtml.replace(new RegExp('\\n', 'g'), '</p><p>');\n                } else {\n                    // 其他情况\n                    return;\n                }\n            }\n\n            // 执行命令\n            if (resultHtml) {\n                editor.command(e, 'insertHtml', resultHtml);\n\n                // 删除内容为空的 p 和嵌套的 p\n                self.clearEmptyOrNestP();\n            }\n        });\n\n        // 处理粘贴的内容\n        function handle(elem) {\n            if (!elem || !elem.nodeType || !elem.nodeName) {\n                return;\n            }\n            var $elem;\n            var nodeName = elem.nodeName.toLowerCase();\n            var nodeType = elem.nodeType;\n            var childNodesClone;\n\n            // 只处理文本和普通node标签\n            if (nodeType !== 3 && nodeType !== 1) {\n                return;\n            }\n\n            $elem = $(elem);\n\n            // 如果是容器，则继续深度遍历\n            if (nodeName === 'div') {\n                childNodesClone = [];\n                $.each(elem.childNodes, function (index, item) {\n                    // elem.childNodes 可获取TEXT节点，而 $elem.children() 就获取不到\n                    // 先将 elem.childNodes 拷贝一份，一面在循环递归过程中 elem 发生变化\n                    childNodesClone.push(item);\n                });\n                // 遍历子元素，执行操作\n                $.each(childNodesClone, function () {\n                    handle(this);\n                });\n                return;\n            }\n            \n            if (legalTagArr.indexOf(nodeName) >= 0) {\n                // 如果是合法标签之内的，则根据元素类型，获取值\n                resultHtml += getResult(elem);\n            } else if (nodeType === 3) {\n                // 如果是文本，则直接插入 p 标签\n                resultHtml += '<p>' + elem.textContent + '</p>';\n            } else if (nodeName === 'br') {\n                // <br>保留\n                resultHtml += '<br/>';\n            }\n            else {\n                // 忽略的标签\n                if (['meta', 'style', 'script', 'object', 'form', 'iframe', 'hr'].indexOf(nodeName) >= 0) {\n                    return;\n                }\n                // 其他标签，移除属性，插入 p 标签\n                $elem = $(removeAttrs(elem));\n                // 注意，这里的 clone() 是必须的，否则会出错\n                resultHtml += $('<div>').append($elem.clone()).html();\n            }\n        }\n\n        // 获取元素的结果\n        function getResult(elem) {\n            var nodeName = elem.nodeName.toLowerCase();\n            var $elem;\n            var htmlForP = '';\n            var htmlForLi = '';\n\n            if (['blockquote'].indexOf(nodeName) >= 0) {\n\n                // 直接取出元素text即可\n                $elem = $(elem);\n                return '<' + nodeName + '>' + $elem.text() + '</' + nodeName + '>';\n\n            } else if (['p', 'h1', 'h2', 'h3', 'h4', 'h5'].indexOf(nodeName) >= 0) {\n\n                //p head 取出 text 和链接\n                elem = removeAttrs(elem);\n                $elem = $(elem);\n                htmlForP = $elem.html();\n\n                // 剔除 a img 之外的元素\n                htmlForP = htmlForP.replace(/<.*?>/ig, function (tag) {\n                    if (tag === '</a>' || tag.indexOf('<a ') === 0 || tag.indexOf('<img ') === 0) {\n                        return tag;\n                    } else {\n                        return '';\n                    }\n                });\n\n                return '<' + nodeName + '>' + htmlForP + '</' + nodeName + '>';\n\n            } else if (['ul', 'ol'].indexOf(nodeName) >= 0) {\n                \n                // ul ol元素，获取子元素（li元素）的text link img，再拼接\n                $elem = $(elem);\n                $elem.children().each(function () {\n                    var $li = $(removeAttrs(this));\n                    var html = $li.html();\n\n                    html = html.replace(/<.*?>/ig, function (tag) {\n                        if (tag === '</a>' || tag.indexOf('<a ') === 0 || tag.indexOf('<img ') === 0) {\n                            return tag;\n                        } else {\n                            return '';\n                        }\n                    });\n\n                    htmlForLi += '<li>' + html + '</li>';\n                });\n                return '<' + nodeName + '>' + htmlForLi + '</' + nodeName + '>';\n            \n            } else {\n                \n                // 其他元素，移除元素属性\n                $elem = $(removeAttrs(elem));\n                return $('<div>').append($elem).html();\n            }\n        }\n\n        // 移除一个元素（子元素）的attr\n        function removeAttrs(elem) {\n            var attrs = elem.attributes || [];\n            var attrNames = [];\n            var exception = ['href', 'target', 'src', 'alt', 'rowspan', 'colspan']; //例外情况\n\n            // 先存储下elem中所有 attr 的名称\n            $.each(attrs, function (key, attr) {\n                if (attr && attr.nodeType === 2) {\n                    attrNames.push(attr.nodeName);\n                }\n            });\n            // 再根据名称删除所有attr\n            $.each(attrNames, function (key, attr) {\n                if (exception.indexOf(attr) < 0) {\n                    // 除了 exception 规定的例外情况，删除其他属性\n                    elem.removeAttribute(attr);\n                }\n            });\n\n\n            // 递归子节点\n            var children = elem.childNodes;\n            if (children.length) {\n                $.each(children, function (key, value) {\n                    removeAttrs(value);\n                });\n            }\n\n            return elem;\n        }\n    };\n\n    // 绑定 $txt.formatText() 方法\n    Txt.fn.bindFormatText = function () {\n        var self = this;\n        var editor = self.editor;\n        var $txt = self.$txt;\n        var legalTags = E.config.legalTags;\n        var legalTagArr = legalTags.split(',');\n        var length = legalTagArr.length;\n        var regArr = [];\n\n        // 将 E.config.legalTags 配置的有效字符，生成正则表达式\n        $.each(legalTagArr, function (k, tag) {\n            var reg = '\\>\\\\s*\\<(' + tag + ')\\>';\n            regArr.push(new RegExp(reg, 'ig'));\n        });\n\n        // 增加 li \n        regArr.push(new RegExp('\\>\\\\s*\\<(li)\\>', 'ig'));\n\n        // 增加 tr\n        regArr.push(new RegExp('\\>\\\\s*\\<(tr)\\>', 'ig'));\n\n        // 增加 code\n        regArr.push(new RegExp('\\>\\\\s*\\<(code)\\>', 'ig'));\n\n        // 生成 formatText 方法\n        $txt.formatText = function () {\n            var $temp = $('<div>');\n            var html = $txt.html();\n\n            // 去除空格\n            html = html.replace(/\\s*</ig, '<');\n\n            // 段落、表格之间换行\n            $.each(regArr, function (k, reg) {\n                if (!reg.test(html)) {\n                    return;\n                }\n                html = html.replace(reg, function (matchStr, tag) {\n                    return '>\\n<' + tag + '>';\n                });\n            });\n\n            $temp.html(html);\n            return $temp.text();\n        };\n    };\n\n    // 定制 $txt.html 方法\n    Txt.fn.bindHtml = function () {\n        var self = this;\n        var editor = self.editor;\n        var $txt = self.$txt;\n        var $valueContainer = editor.$valueContainer;\n        var valueNodeName = editor.valueNodeName;\n\n        $txt.html = function (html) {\n            var result;\n\n            if (valueNodeName === 'div') {\n                // div 生成的编辑器，取值、赋值，都直接触发jquery的html方法\n                result = $.fn.html.call($txt, html);\n            }\n\n            // textarea 生成的编辑器，则需要考虑赋值时，也给textarea赋值\n\n            if (html === undefined) {\n                // 取值，直接触发jquery原生html方法\n                result = $.fn.html.call($txt);\n\n                // 替换 html 中，src和href属性中的 & 字符。\n                // 因为 .html() 或者 .innerHTML 会把所有的 & 字符都改成 &amp; 但是 src 和 href 中的要保持 &\n                result = result.replace(/(href|src)\\=\\\"(.*)\\\"/igm, function (a, b, c) {\n                    return b + '=\"' + c.replace('&amp;', '&') + '\"';\n                });\n            } else {\n                // 赋值，需要同时给 textarea 赋值\n                result = $.fn.html.call($txt, html);\n                $valueContainer.val(html);\n            }\n\n            if (html === undefined) {\n                return result;\n            } else {\n                // 手动触发 change 事件，因为 $txt 监控了 change 事件来判断是否需要执行 editor.onchange \n                $txt.change();\n            }\n        };\n    };\n});\n// Txt.fn api\n_e(function (E, $) {\n\n    var Txt = E.Txt;\n\n    var txtChangeEventNames = 'propertychange change click keyup input paste';\n\n    // 渲染\n    Txt.fn.render = function () {\n        var $txt = this.$txt;\n        var $editorContainer = this.editor.$editorContainer;\n        $editorContainer.append($txt);\n    };\n\n    // 计算高度\n    Txt.fn.initHeight = function () {\n        var editor = this.editor;\n        var $txt = this.$txt;\n        var valueContainerHeight = editor.$valueContainer.height();\n        var menuHeight = editor.menuContainer.height();\n        var txtHeight = valueContainerHeight - menuHeight;\n\n        // 限制最小为 50px\n        txtHeight = txtHeight < 50 ? 50 : txtHeight;\n\n        $txt.height(txtHeight);\n\n        // 记录原始高度\n        editor.valueContainerHeight = valueContainerHeight;\n\n        // 设置 max-height\n        this.initMaxHeight(txtHeight, menuHeight);\n    };\n\n    // 计算最大高度\n    Txt.fn.initMaxHeight = function (txtHeight, menuHeight) {\n        var editor = this.editor;\n        var $menuContainer = editor.menuContainer.$menuContainer;\n        var $txt = this.$txt;\n        var $wrap = $('<div>');\n\n        // 需要浏览器支持 max-height，否则不管\n        if (window.getComputedStyle && 'max-height'in window.getComputedStyle($txt.get(0))) {\n            // 获取 max-height 并判断是否有值\n            var maxHeight = parseInt(editor.$valueContainer.css('max-height'));\n            if (isNaN(maxHeight)) {\n                return;\n            }\n\n            // max-height 和『全屏』暂时有冲突\n            if (editor.menus.fullscreen) {\n                E.warn('max-height和『全屏』菜单一起使用时，会有一些问题尚未解决，请暂时不要两个同时使用');\n                return;\n            }\n\n            // 标记\n            editor.useMaxHeight = true;\n\n            // 设置maxheight\n            $wrap.css({\n                'max-height': (maxHeight - menuHeight) + 'px',\n                'overflow-y': 'auto'\n            });\n            $txt.css({\n                'height': 'auto',\n                'overflow-y': 'visible',\n                'min-height': txtHeight + 'px'\n            });\n\n            // 滚动式，菜单阴影\n            $wrap.on('scroll', function () {\n                if ($txt.parent().scrollTop() > 10) {\n                    $menuContainer.addClass('wangEditor-menu-shadow');\n                } else {\n                    $menuContainer.removeClass('wangEditor-menu-shadow');\n                }\n            });\n\n            // 需在编辑器区域外面再包裹一层\n            $txt.wrap($wrap);\n        }\n    };\n\n    // 保存选区\n    Txt.fn.saveSelectionEvent = function () {\n        var $txt = this.$txt;\n        var editor = this.editor;\n        var timeoutId;\n        var dt = Date.now();\n\n        function save() {\n            editor.saveSelection();\n        }\n\n        // 同步保存选区\n        function saveSync() {\n            // 100ms之内，不重复保存\n            if (Date.now() - dt < 100) {\n                return;\n            }\n\n            dt = Date.now();\n            save();\n        }\n\n        // 异步保存选区\n        function saveAync() {\n            // 节流，防止高频率重复操作\n            if (timeoutId) {\n                clearTimeout(timeoutId);\n            }\n            timeoutId = setTimeout(save, 300);\n        }\n\n        // txt change 、focus、blur 时随时保存选区\n        $txt.on(txtChangeEventNames + ' focus blur', function (e) {\n            // 先同步保存选区，为了让接下来就马上要执行 editor.getRangeElem() 的程序\n            // 能够获取到正确的 rangeElem\n            saveSync();\n\n            // 再异步保存选区，为了确定更加准确的选区，为后续的操作做准备\n            saveAync();\n        });\n\n        // 鼠标拖拽选择时，可能会拖拽到编辑器区域外面再松手，此时 $txt 就监听不到 click事件了\n        $txt.on('mousedown', function () {\n            $txt.on('mouseleave.saveSelection', function (e) {\n                // 先同步后异步，如上述注释\n                saveSync();\n                saveAync();\n\n                // 顺道吧菜单状态也更新了\n                editor.updateMenuStyle();\n            });\n        }).on('mouseup', function () {\n            $txt.off('mouseleave.saveSelection');\n        });\n        \n    };\n\n    // 随时更新 value\n    Txt.fn.updateValueEvent = function () {\n        var $txt = this.$txt;\n        var editor = this.editor;\n        var timeoutId, oldValue;\n\n        // 触发 onchange 事件\n        function doOnchange() {\n            var val = $txt.html();\n            if (oldValue === val) {\n                // 无变化\n                return;\n            }\n\n            // 触发 onchange 事件\n            if (editor.onchange && typeof editor.onchange === 'function') {\n                editor.onchange.call(editor);\n            }\n\n            // 更新内容\n            editor.updateValue();\n\n            // 记录最新内容\n            oldValue = val;\n        }\n\n        // txt change 时随时更新内容\n        $txt.on(txtChangeEventNames, function (e) {\n            // 初始化\n            if (oldValue == null) {\n                oldValue = $txt.html();\n            }\n\n            // 监控内容变化（停止操作 100ms 之后立即执行）\n            if (timeoutId) {\n                clearTimeout(timeoutId);\n            }\n            timeoutId = setTimeout(doOnchange, 100);\n        });\n    };\n\n    // 随时更新 menustyle\n    Txt.fn.updateMenuStyleEvent = function () {\n        var $txt = this.$txt;\n        var editor = this.editor;\n\n        // txt change 时随时更新内容\n        $txt.on(txtChangeEventNames, function (e) {\n            editor.updateMenuStyle();\n        });\n    };\n\n    // 最后插入试图插入 <p><br><p>\n    Txt.fn.insertEmptyP = function () {\n        var $txt = this.$txt;\n        var $children = $txt.children();\n\n        if ($children.length === 0) {\n            $txt.append($('<p><br></p>'));\n            return;\n        }\n\n        if ($.trim($children.last().html()).toLowerCase() !== '<br>') {\n            $txt.append($('<p><br></p>'));\n        }\n    };\n\n    // 将编辑器暴露出来的文字和图片，都用 p 来包裹\n    Txt.fn.wrapImgAndText = function () {\n        var $txt = this.$txt;\n        var $imgs = $txt.children('img');\n        var txt = $txt[0];\n        var childNodes = txt.childNodes;\n        var childrenLength = childNodes.length;\n        var i, childNode, p;\n\n        // 处理图片\n        $imgs.length && $imgs.each(function () {\n            $(this).wrap('<p>');\n        });\n\n        // 处理文字\n        for (i = 0; i < childrenLength; i++) {\n            childNode = childNodes[i];\n            if (childNode.nodeType === 3 && childNode.textContent && $.trim(childNode.textContent)) {\n                $(childNode).wrap('<p>');\n            }\n        }\n    };\n\n    // 清空内容为空的<p>，以及重复包裹的<p>（在windows下的chrome粘贴文字之后，会出现上述情况）\n    Txt.fn.clearEmptyOrNestP = function () {\n        var $txt = this.$txt;\n        var $pList = $txt.find('p');\n\n        $pList.each(function () {\n            var $p = $(this);\n            var $children = $p.children();\n            var childrenLength = $children.length;\n            var $firstChild;\n            var content = $.trim($p.html());\n\n            // 内容为空的p\n            if (!content) {\n                $p.remove();\n                return;\n            }\n\n            // 嵌套的p\n            if (childrenLength === 1) {\n                $firstChild = $children.first();\n                if ($firstChild.get(0) && $firstChild.get(0).nodeName === 'P') {\n                    $p.html( $firstChild.html() );\n                }\n            }\n        });\n    };\n\n    // 获取 scrollTop\n    Txt.fn.scrollTop = function (val) {\n        var self = this;\n        var editor = self.editor;\n        var $txt = self.$txt;\n\n        if (editor.useMaxHeight) {\n            return $txt.parent().scrollTop(val);\n        } else {\n            return $txt.scrollTop(val);\n        }\n    };\n\n    // 鼠标hover时候，显示p、head的高度\n    Txt.fn.showHeightOnHover = function () {\n        var editor = this.editor;\n        var $editorContainer = editor.$editorContainer;\n        var menuContainer = editor.menuContainer;\n        var $txt = this.$txt;\n        var $tip = $('<i class=\"height-tip\"><i>');\n        var isTipInTxt = false;\n\n        function addAndShowTip($target) {\n            if (!isTipInTxt) {\n                $editorContainer.append($tip);\n                isTipInTxt = true;\n            }\n\n            var txtTop = $txt.position().top;\n            var txtHeight = $txt.outerHeight();\n\n            var height = $target.height();\n            var top = $target.position().top;\n            var marginTop = parseInt($target.css('margin-top'), 10);\n            var paddingTop = parseInt($target.css('padding-top'), 10);\n            var marginBottom = parseInt($target.css('margin-bottom'), 10);\n            var paddingBottom = parseInt($target.css('padding-bottom'), 10);\n\n            // 计算初步的结果\n            var resultHeight = height + paddingTop + marginTop + paddingBottom + marginBottom;\n            var resultTop = top + menuContainer.height();\n            \n            // var spaceValue;\n\n            // // 判断是否超出下边界\n            // spaceValue = (resultTop + resultHeight) - (txtTop + txtHeight);\n            // if (spaceValue > 0) {\n            //     resultHeight = resultHeight - spaceValue;\n            // }\n\n            // // 判断是否超出了下边界\n            // spaceValue = txtTop > resultTop;\n            // if (spaceValue) {\n            //     resultHeight = resultHeight - spaceValue;\n            //     top = top + spaceValue;\n            // }\n\n            // 按照最终结果渲染\n            $tip.css({\n                height: height + paddingTop + marginTop + paddingBottom + marginBottom,\n                top: top + menuContainer.height()\n            });\n        }\n        function removeTip() {\n            if (!isTipInTxt) {\n                return;\n            }\n            $tip.remove();\n            isTipInTxt = false;\n        }\n\n        $txt.on('mouseenter', 'ul,ol,blockquote,p,h1,h2,h3,h4,h5,table,pre', function (e) {\n            addAndShowTip($(e.currentTarget));\n        }).on('mouseleave', function () {\n            removeTip();\n        });\n    };\n\n});\n// 工具函数\n_e(function (E, $) {\n\n    // IE8 [].indexOf()\n    if(!Array.prototype.indexOf){\n        //IE低版本不支持 arr.indexOf \n        Array.prototype.indexOf = function(elem){\n            var i = 0,\n                length = this.length;\n            for(; i<length; i++){\n                if(this[i] === elem){\n                    return i;\n                }\n            }\n            return -1;\n        };\n        //IE低版本不支持 arr.lastIndexOf\n        Array.prototype.lastIndexOf = function(elem){\n            var length = this.length;\n            for(length = length - 1; length >= 0; length--){\n                if(this[length] === elem){\n                    return length;\n                }\n            }\n            return -1;\n        };\n    }\n\n    // IE8 Date.now()\n    if (!Date.now) {\n        Date.now = function () {\n            return new Date().valueOf(); \n        };\n    }\n\n    // console.log && console.warn && console.error\n    var console = window.console;\n    var emptyFn = function () {};\n    $.each(['info', 'log', 'warn', 'error'], function (key, value) {\n        if (console == null) {\n            E[value] = emptyFn;\n        } else {\n            E[value] = function (info) {\n                // 通过配置来控制打印输出\n                if (E.config && E.config.printLog) {\n                    console[value]('wangEditor提示: ' + info);\n                }\n            };\n        }\n    });\n\n    // 获取随机数\n    E.random = function () {\n        return Math.random().toString().slice(2);\n    };\n\n    // 浏览器是否支持 placeholder\n    E.placeholder = 'placeholder' in document.createElement('input');\n\n    // 兼容IE8的 input placeholder\n    E.placeholderForIE8 = function ($container) {\n        if (E.placeholder) {\n            return;\n        }\n        $container.find('input[placeholder]').each(function () {\n            var $input = $(this);\n            var placeholder = $input.attr('placeholder');\n\n            if ($input.val() === '') {\n                $input.css('color', '#666');\n                $input.val(placeholder);\n\n                $input.on('focus.placeholder click.placeholder', function () {\n                    $input.val('');\n                    $input.css('color', '#333');\n                    $input.off('focus.placeholder click.placeholder');\n                });\n            }\n        });\n    };\n});\n// 语言包\n_e(function (E, $) {\n    E.langs = {};\n    \n    // 中文\n    E.langs['zh-cn'] = {\n        bold: '粗体',\n        underline: '下划线',\n        italic: '斜体',\n        forecolor: '文字颜色',\n        bgcolor: '背景色',\n        strikethrough: '删除线',\n        eraser: '清空格式',\n        source: '源码',\n        quote: '引用',\n        fontfamily: '字体',\n        fontsize: '字号',\n        head: '标题',\n        orderlist: '有序列表',\n        unorderlist: '无序列表',\n        alignleft: '左对齐',\n        aligncenter: '居中',\n        alignright: '右对齐',\n        link: '链接',\n        text: '文本',\n        submit: '提交',\n        cancel: '取消',\n        unlink: '取消链接',\n        table: '表格',\n        emotion: '表情',\n        img: '图片',\n        uploadImg: '上传图片',\n        linkImg: '网络图片',\n        video: '视频',\n        'width': '宽',\n        'height': '高',\n        location: '位置',\n        loading: '加载中',\n        searchlocation: '搜索位置',\n        dynamicMap: '动态地图',\n        clearLocation: '清除位置',\n        langDynamicOneLocation: '动态地图只能显示一个位置',\n        insertcode: '插入代码',\n        undo: '撤销',\n        redo: '重复',\n        fullscreen: '全屏',\n        openLink: '打开链接'\n    };\n\n    // 英文\n    E.langs.en = {\n        bold: 'Bold',\n        underline: 'Underline',\n        italic: 'Italic',\n        forecolor: 'Color',\n        bgcolor: 'Backcolor',\n        strikethrough: 'Strikethrough',\n        eraser: 'Eraser',\n        source: 'Codeview',\n        quote: 'Quote',\n        fontfamily: 'Font family',\n        fontsize: 'Font size',\n        head: 'Head',\n        orderlist: 'Ordered list',\n        unorderlist: 'Unordered list',\n        alignleft: 'Align left',\n        aligncenter: 'Align center',\n        alignright: 'Align right',\n        link: 'Insert link',\n        text: 'Text',\n        submit: 'Submit',\n        cancel: 'Cancel',\n        unlink: 'Unlink',\n        table: 'Table',\n        emotion: 'Emotions',\n        img: 'Image',\n        uploadImg: 'Upload',\n        linkImg: 'Link',\n        video: 'Video',\n        'width': 'width',\n        'height': 'height',\n        location: 'Location',\n        loading: 'Loading',\n        searchlocation: 'search',\n        dynamicMap: 'Dynamic',\n        clearLocation: 'Clear',\n        langDynamicOneLocation: 'Only one location in dynamic map',\n        insertcode: 'Insert Code',\n        undo: 'Undo',\n        redo: 'Redo',\n        fullscreen: 'Full screnn',\n        openLink: 'open link'\n    };\n});\n// 全局配置\n_e(function (E, $) {\n\n    E.config = {};\n\n    // 全屏时的 z-index\n    E.config.zindex = 10000;\n\n    // 是否打印log\n    E.config.printLog = true;\n\n    // 菜单吸顶：false - 不吸顶；number - 吸顶，值为top值\n    E.config.menuFixed = 0;\n\n    // 编辑源码时，过滤 javascript\n    E.config.jsFilter = true;\n\n    // 编辑器允许的标签\n    E.config.legalTags = 'p,h1,h2,h3,h4,h5,h6,blockquote,table,ul,ol,pre';\n\n    // 语言包\n    E.config.lang = E.langs['zh-cn'];\n\n    // 菜单配置\n    E.config.menus = [\n        'source',\n        '|',\n        'bold',\n        'underline',\n        'italic',\n        'strikethrough',\n        'eraser',\n        'forecolor',\n        'bgcolor',\n        '|',\n        'quote',\n        'fontfamily',\n        'fontsize',\n        'head',\n        'unorderlist',\n        'orderlist',\n        'alignleft',\n        'aligncenter',\n        'alignright',\n        '|',\n        'link',\n        'unlink',\n        'table',\n        'emotion',\n        '|',\n        'img',\n        'video',\n        'location',\n        'insertcode',\n        '|',\n        'undo',\n        'redo',\n        'fullscreen'\n    ];\n\n    // 颜色配置\n    E.config.colors = {\n        // 'value': 'title'\n        '#880000': '暗红色',\n        '#800080': '紫色',\n        '#ff0000': '红色',\n        '#ff00ff': '鲜粉色',\n        '#000080': '深蓝色',\n        '#0000ff': '蓝色',\n        '#00ffff': '湖蓝色',\n        '#008080': '蓝绿色',\n        '#008000': '绿色',\n        '#808000': '橄榄色',\n        '#00ff00': '浅绿色',\n        '#ffcc00': '橙黄色',\n        '#808080': '灰色',\n        '#c0c0c0': '银色',\n        '#000000': '黑色',\n        '#ffffff': '白色'\n    };\n\n    // 字体\n    E.config.familys = [\n        '宋体', '黑体', '楷体', '微软雅黑',\n        'Arial', 'Verdana', 'Georgia',\n        'Times New Roman', 'Microsoft JhengHei',\n        'Trebuchet MS', 'Courier New', 'Impact', 'Comic Sans MS', 'Consolas'\n    ];\n\n    // 字号\n    E.config.fontsizes = {\n        // 格式：'value': 'title'\n        1: '12px',\n        2: '13px',\n        3: '16px',\n        4: '18px',\n        5: '24px',\n        6: '32px',\n        7: '48px'\n    };\n\n    // 表情包\n    E.config.emotionsShow = 'icon'; // 显示项，默认为'icon'，也可以配置成'value'\n    E.config.emotions = {\n        // 'default': {\n        //     title: '默认',\n        //     data: './emotions.data'\n        // },\n        'weibo': {\n            title: '微博表情',\n            data: [\n                {\n                    icon: 'http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/7a/shenshou_thumb.gif',\n                    value: '[草泥马]'    \n                },\n                {\n                    icon: 'http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/60/horse2_thumb.gif',\n                    value: '[神马]'    \n                },\n                {\n                    icon: 'http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/bc/fuyun_thumb.gif',\n                    value: '[浮云]'    \n                },\n                {\n                    icon: 'http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/c9/geili_thumb.gif',\n                    value: '[给力]'    \n                },\n                {\n                    icon: 'http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/f2/wg_thumb.gif',\n                    value: '[围观]'    \n                },\n                {\n                    icon: 'http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/70/vw_thumb.gif',\n                    value: '[威武]'\n                },\n                {\n                    icon: 'http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/6e/panda_thumb.gif',\n                    value: '[熊猫]'\n                },\n                {\n                    icon: 'http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/81/rabbit_thumb.gif',\n                    value: '[兔子]'\n                },\n                {\n                    icon: 'http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/bc/otm_thumb.gif',\n                    value: '[奥特曼]'\n                },\n                {\n                    icon: 'http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/15/j_thumb.gif',\n                    value: '[囧]'\n                },\n                {\n                    icon: 'http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/89/hufen_thumb.gif',\n                    value: '[互粉]'\n                },\n                {\n                    icon: 'http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/c4/liwu_thumb.gif',\n                    value: '[礼物]'\n                },\n                {\n                    icon: 'http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/ac/smilea_thumb.gif',\n                    value: '[呵呵]'\n                },\n                {\n                    icon: 'http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/0b/tootha_thumb.gif',\n                    value: '[哈哈]'\n                }\n            ]\n        }\n    };\n\n    // 百度地图的key\n    E.config.mapAk = 'TVhjYjq1ICT2qqL5LdS8mwas';\n\n    // 上传图片的配置\n    // server地址\n    E.config.uploadImgUrl = '';\n    // 超时时间\n    E.config.uploadTimeout = 20 * 1000;\n    // 用于存储上传回调事件\n    E.config.uploadImgFns = {};\n    // 自定义上传图片的filename\n    // E.config.uploadImgFileName = 'customFileName';\n\n    // 自定义上传，设置为 true 之后，显示上传图标\n    E.config.customUpload = false;\n    // 自定义上传的init事件\n    // E.config.customUploadInit = function () {....};\n\n    // 自定义上传时传递的参数（如 token）\n    E.config.uploadParams = {\n        /* token: 'abcdef12345' */\n    };\n\n    // 自定义上传是的header参数\n    E.config.uploadHeaders = {\n         /* 'Accept' : 'text/x-json' */\n    };\n\n    // 跨域上传时传递 cookie，默认为 true\n    E.config.withCredentials = true;\n\n    // 隐藏网络图片，默认为 false\n    E.config.hideLinkImg = false;\n\n    // 是否过滤粘贴内容\n    E.config.pasteFilter = true;\n\n    // 是否粘贴纯文本，当 editor.config.pasteFilter === false 时候，此配置将失效\n    E.config.pasteText = false;\n\n    // 插入代码时，默认的语言\n    E.config.codeDefaultLang = 'javascript';\n\n});\n// 全局UI\n_e(function (E, $) {\n\n     E.UI = {};\n\n     // 为菜单自定义配置的UI\n     E.UI.menus = {\n        // 这个 default 不加引号，在 IE8 会报错\n        'default': {\n            normal: '<a href=\"#\" tabindex=\"-1\"><i class=\"wangeditor-menu-img-command\"></i></a>',\n            selected: '.selected'\n        },\n        bold: {\n            normal: '<a href=\"#\" tabindex=\"-1\"><i class=\"wangeditor-menu-img-bold\"></i></a>',\n            selected: '.selected'\n        },\n        underline: {\n            normal: '<a href=\"#\" tabindex=\"-1\"><i class=\"wangeditor-menu-img-underline\"></i></a>',\n            selected: '.selected'\n        },\n        italic: {\n            normal: '<a href=\"#\" tabindex=\"-1\"><i class=\"wangeditor-menu-img-italic\"></i></a>',\n            selected: '.selected'\n        },\n        forecolor: {\n            normal: '<a href=\"#\" tabindex=\"-1\"><i class=\"wangeditor-menu-img-pencil\"></i></a>',\n            selected: '.selected'\n        },\n        bgcolor: {\n            normal: '<a href=\"#\" tabindex=\"-1\"><i class=\"wangeditor-menu-img-brush\"></i></a>',\n            selected: '.selected'\n        },\n        strikethrough: {\n            normal: '<a href=\"#\" tabindex=\"-1\"><i class=\"wangeditor-menu-img-strikethrough\"></i></a>',\n            selected: '.selected'\n        },\n        eraser: {\n            normal: '<a href=\"#\" tabindex=\"-1\"><i class=\"wangeditor-menu-img-eraser\"></i></a>',\n            selected: '.selected'\n        },\n        quote: {\n            normal: '<a href=\"#\" tabindex=\"-1\"><i class=\"wangeditor-menu-img-quotes-left\"></i></a>',\n            selected: '.selected'\n        },\n        source: {\n            normal: '<a href=\"#\" tabindex=\"-1\"><i class=\"wangeditor-menu-img-code\"></i></a>',\n            selected: '.selected'\n        },\n        fontfamily: {\n            normal: '<a href=\"#\" tabindex=\"-1\"><i class=\"wangeditor-menu-img-font2\"></i></a>',\n            selected: '.selected'\n        },\n        fontsize: {\n            normal: '<a href=\"#\" tabindex=\"-1\"><i class=\"wangeditor-menu-img-text-height\"></i></a>',\n            selected: '.selected'\n        },\n        head: {\n            normal: '<a href=\"#\" tabindex=\"-1\"><i class=\"wangeditor-menu-img-header\"></i></a>',\n            selected: '.selected'\n        },\n        orderlist: {\n            normal: '<a href=\"#\" tabindex=\"-1\"><i class=\"wangeditor-menu-img-list-numbered\"></i></a>',\n            selected: '.selected'\n        },\n        unorderlist: {\n            normal: '<a href=\"#\" tabindex=\"-1\"><i class=\"wangeditor-menu-img-list-bullet\"></i></a>',\n            selected: '.selected'\n        },\n        alignleft: {\n            normal: '<a href=\"#\" tabindex=\"-1\"><i class=\"wangeditor-menu-img-align-left\"></i></a>',\n            selected: '.selected'\n        },\n        aligncenter: {\n            normal: '<a href=\"#\" tabindex=\"-1\"><i class=\"wangeditor-menu-img-align-center\"></i></a>',\n            selected: '.selected'\n        },\n        alignright: {\n            normal: '<a href=\"#\" tabindex=\"-1\"><i class=\"wangeditor-menu-img-align-right\"></i></a>',\n            selected: '.selected'\n        },\n        link: {\n            normal: '<a href=\"#\" tabindex=\"-1\"><i class=\"wangeditor-menu-img-link\"></i></a>',\n            selected: '.selected'\n        },\n        unlink: {\n            normal: '<a href=\"#\" tabindex=\"-1\"><i class=\"wangeditor-menu-img-unlink\"></i></a>',\n            selected: '.selected'\n        },\n        table: {\n            normal: '<a href=\"#\" tabindex=\"-1\"><i class=\"wangeditor-menu-img-table\"></i></a>',\n            selected: '.selected'\n        },\n        emotion: {\n            normal: '<a href=\"#\" tabindex=\"-1\"><i class=\"wangeditor-menu-img-happy\"></i></a>',\n            selected: '.selected'\n        },\n        img: {\n            normal: '<a href=\"#\" tabindex=\"-1\"><i class=\"wangeditor-menu-img-picture\"></i></a>',\n            selected: '.selected'\n        },\n        video: {\n            normal: '<a href=\"#\" tabindex=\"-1\"><i class=\"wangeditor-menu-img-play\"></i></a>',\n            selected: '.selected'\n        },\n        location: {\n            normal: '<a href=\"#\" tabindex=\"-1\"><i class=\"wangeditor-menu-img-location\"></i></a>',\n            selected: '.selected'\n        },\n        insertcode: {\n            normal: '<a href=\"#\" tabindex=\"-1\"><i class=\"wangeditor-menu-img-terminal\"></i></a>',\n            selected: '.selected'\n        },\n        undo: {\n            normal: '<a href=\"#\" tabindex=\"-1\"><i class=\"wangeditor-menu-img-ccw\"></i></a>',\n            selected: '.selected'\n        },\n        redo: {\n            normal: '<a href=\"#\" tabindex=\"-1\"><i class=\"wangeditor-menu-img-cw\"></i></a>',\n            selected: '.selected'\n        },\n        fullscreen: {\n            normal: '<a href=\"#\" tabindex=\"-1\"><i class=\"wangeditor-menu-img-enlarge2\"></i></a>',\n            selected: '<a href=\"#\" tabindex=\"-1\" class=\"selected\"><i class=\"wangeditor-menu-img-shrink2\"></i></a>'\n        }\n     };\n     \n});\n// 对象配置\n_e(function (E, $) {\n\n    E.fn.initDefaultConfig = function () {\n        var editor = this;\n        editor.config = $.extend({}, E.config);\n        editor.UI = $.extend({}, E.UI);\n    };\n\n});\n// 增加 container\n_e(function (E, $) {\n\n    E.fn.addEditorContainer = function () {\n        this.$editorContainer = $('<div class=\"wangEditor-container\"></div>');\n    };\n\n});\n// 增加编辑区域对象\n_e(function (E, $) {\n\n    E.fn.addTxt = function () {\n        var editor = this;\n        var txt = new E.Txt(editor);\n\n        editor.txt = txt;\n    };\n\n});\n// 增加menuContainer对象\n_e(function (E, $) {\n\n    E.fn.addMenuContainer = function () {\n        var editor = this;\n        editor.menuContainer = new E.MenuContainer(editor);\n    };\n\n});\n// 增加menus\n_e(function (E, $) {\n\n    // 存储创建菜单的函数\n    E.createMenuFns = [];\n    E.createMenu = function (fn) {\n        E.createMenuFns.push(fn);\n    };\n\n    // 创建所有菜单\n    E.fn.addMenus = function () {\n        var editor = this;\n        var menuIds = editor.config.menus;\n\n        // 检验 menuId 是否在配置中存在\n        function check(menuId) {\n            if (menuIds.indexOf(menuId) >= 0) {\n                return true;\n            }\n            return false;\n        }\n\n        // 遍历所有的菜单创建函数，并执行\n        $.each(E.createMenuFns, function (k, createMenuFn) {\n            createMenuFn.call(editor, check);\n        });\n    };\n\n});\n// bold菜单\n_e(function (E, $) {\n\n    E.createMenu(function (check) {\n        var menuId = 'bold';\n        if (!check(menuId)) {\n            return;\n        }\n\n        var editor = this;\n        var lang = editor.config.lang;\n\n        // 创建 menu 对象\n        var menu = new E.Menu({\n            editor: editor,\n            id: menuId,\n            title: lang.bold,\n            commandName: 'Bold'\n        });\n\n        // 定义选中状态下的click事件\n        menu.clickEventSelected = function (e) {\n            var isRangeEmpty = editor.isRangeEmpty();\n            if (!isRangeEmpty) {\n                // 如果选区有内容，则执行基础命令\n                editor.command(e, 'Bold');\n            } else {\n                // 如果选区没有内容\n                editor.commandForElem('b,strong,h1,h2,h3,h4,h5', e, 'Bold');\n            }\n        };\n\n        // 增加到editor对象中\n        editor.menus[menuId] = menu;\n    });\n\n});\n// underline菜单\n_e(function (E, $) {\n\n    E.createMenu(function (check) {\n        var menuId = 'underline';\n        if (!check(menuId)) {\n            return;\n        }\n\n        var editor = this;\n        var lang = editor.config.lang;\n\n        // 创建 menu 对象\n        var menu = new E.Menu({\n            editor: editor,\n            id: menuId,\n            title: lang.underline,\n            commandName: 'Underline'\n        });\n\n        // 定义选中状态下的click事件\n        menu.clickEventSelected = function (e) {\n            var isRangeEmpty = editor.isRangeEmpty();\n            if (!isRangeEmpty) {\n                // 如果选区有内容，则执行基础命令\n                editor.command(e, 'Underline');\n            } else {\n                // 如果选区没有内容\n                editor.commandForElem('u,a', e, 'Underline');\n            }\n        };\n\n        // 增加到editor对象中\n        editor.menus[menuId] = menu;\n    });\n\n});\n// italic 菜单\n_e(function (E, $) {\n    \n    E.createMenu(function (check) {\n        var menuId = 'italic';\n        if (!check(menuId)) {\n            return;\n        }\n        var editor = this;\n        var lang = editor.config.lang;\n\n        // 创建 menu 对象\n        var menu = new E.Menu({\n            editor: editor,\n            id: menuId,\n            title: lang.italic,\n            commandName: 'Italic'\n        });\n\n        // 定义选中状态下的click事件\n        menu.clickEventSelected = function (e) {\n            var isRangeEmpty = editor.isRangeEmpty();\n            if (!isRangeEmpty) {\n                // 如果选区有内容，则执行基础命令\n                editor.command(e, 'Italic');\n            } else {\n                // 如果选区没有内容\n                editor.commandForElem('i', e, 'Italic');\n            }\n        };\n\n        // 增加到editor对象中\n        editor.menus[menuId] = menu;\n    });\n\n});\n// forecolor 菜单\n_e(function (E, $) {\n\n    E.createMenu(function (check) {\n        var menuId = 'forecolor';\n        if (!check(menuId)) {\n            return;\n        }\n        var editor = this;\n        var lang = editor.config.lang;\n        var configColors = editor.config.colors;\n\n        // 创建 menu 对象\n        var menu = new E.Menu({\n            editor: editor,\n            id: menuId,\n            title: lang.forecolor\n        });\n\n        // 创建 dropPanel\n        var $content = $('<div></div>');\n        $.each(configColors, function (k, v) {\n            $content.append(\n                [\n                    '<a href=\"#\" class=\"color-item\"',\n                    '    title=\"' + v + '\" commandValue=\"' + k + '\" ',\n                    '    style=\"color: ' + k + '\" ',\n                    '><i class=\"wangeditor-menu-img-pencil\"></i></a>'\n                ].join('')\n            );\n        });\n        $content.on('click', 'a[commandValue]', function (e) {\n            // 执行命令\n            var $elem = $(this);\n            var commandValue = $elem.attr('commandValue');\n\n            if (menu.selected && editor.isRangeEmpty()) {\n                // 当前处于选中状态，并且选中内容为空\n                editor.commandForElem('font[color]', e, 'forecolor', commandValue);\n            } else {\n                // 当前未处于选中状态，或者有选中内容。则执行默认命令\n                editor.command(e, 'forecolor', commandValue);\n            }\n        });\n        menu.dropPanel = new E.DropPanel(editor, menu, {\n            $content: $content,\n            width: 125\n        });\n\n        // 定义 update selected 事件\n        menu.updateSelectedEvent = function () {\n            var rangeElem = editor.getRangeElem();\n            rangeElem = editor.getSelfOrParentByName(rangeElem, 'font[color]');\n            if (rangeElem) {\n                return true;\n            }\n            return false;\n        };\n\n        // 增加到editor对象中\n        editor.menus[menuId] = menu;\n    });\n\n});\n// bgcolor 菜单\n_e(function (E, $) {\n\n    E.createMenu(function (check) {\n        var menuId = 'bgcolor';\n        if (!check(menuId)) {\n            return;\n        }\n        var editor = this;\n        var lang = editor.config.lang;\n        var configColors = editor.config.colors;\n\n        // 检查元素是否有 background-color: 内联样式\n        function checkElemFn(elem) {\n            var cssText;\n            if (elem && elem.style && elem.style.cssText != null) {\n                cssText = elem.style.cssText;\n                if (cssText && cssText.indexOf('background-color:') >= 0) {\n                    return true;\n                }\n            }\n            return false;\n        }\n\n        // 创建 menu 对象\n        var menu = new E.Menu({\n            editor: editor,\n            id: menuId,\n            title: lang.bgcolor\n        });\n\n        // 创建 dropPanel\n        var $content = $('<div></div>');\n        $.each(configColors, function (k, v) {\n            $content.append(\n                [\n                    '<a href=\"#\" class=\"color-item\"',\n                    '    title=\"' + v + '\" commandValue=\"' + k + '\" ',\n                    '    style=\"color: ' + k + '\" ',\n                    '><i class=\"wangeditor-menu-img-brush\"></i></a>'\n                ].join('')\n            );\n        });\n        $content.on('click', 'a[commandValue]', function (e) {\n            // 执行命令\n\n            var $elem = $(this);\n            var commandValue = $elem.attr('commandValue');\n\n            if (menu.selected && editor.isRangeEmpty()) {\n                // 当前处于选中状态，并且选中内容为空。使用 commandForElem 执行命令\n                editor.commandForElem({\n                    selector: 'span,font',\n                    check: checkElemFn\n                }, e, 'BackColor', commandValue);\n            } else {\n                // 当前未处于选中状态，或者有选中内容。则执行默认命令\n                editor.command(e, 'BackColor', commandValue);\n            }\n        });\n        menu.dropPanel = new E.DropPanel(editor, menu, {\n            $content: $content,\n            width: 125\n        });\n\n        // 定义 update selected 事件\n        menu.updateSelectedEvent = function () {\n            var rangeElem = editor.getRangeElem();\n            rangeElem = editor.getSelfOrParentByName(rangeElem, 'span,font', checkElemFn);\n            \n            if (rangeElem) {\n                return true;\n            }\n            return false;\n        };\n\n        // 增加到editor对象中\n        editor.menus[menuId] = menu;\n    });\n\n});\n// strikethrough 菜单\n_e(function (E, $) {\n\n    E.createMenu(function (check) {\n        var menuId = 'strikethrough';\n        if (!check(menuId)) {\n            return;\n        }\n        var editor = this;\n        var lang = editor.config.lang;\n\n        // 创建 menu 对象\n        var menu = new E.Menu({\n            editor: editor,\n            id: menuId,\n            title: lang.strikethrough,\n            commandName: 'StrikeThrough'\n        });\n\n        // 定义选中状态下的click事件\n        menu.clickEventSelected = function (e) {\n            var isRangeEmpty = editor.isRangeEmpty();\n            if (!isRangeEmpty) {\n                // 如果选区有内容，则执行基础命令\n                editor.command(e, 'StrikeThrough');\n            } else {\n                // 如果选区没有内容\n                editor.commandForElem('strike', e, 'StrikeThrough');\n            }\n        };\n\n        // 增加到editor对象中\n        editor.menus[menuId] = menu;\n    });\n\n});\n// eraser 菜单\n_e(function (E, $) {\n\n    E.createMenu(function (check) {\n        var menuId = 'eraser';\n        if (!check(menuId)) {\n            return;\n        }\n        var editor = this;\n        var lang = editor.config.lang;\n\n        // 创建 menu 对象\n        var menu = new E.Menu({\n            editor: editor,\n            id: menuId,\n            title: lang.eraser,\n            commandName: 'RemoveFormat'\n        });\n\n        // 定义点击事件\n        menu.clickEvent = function (e) {\n            var isRangeEmpty = editor.isRangeEmpty();\n\n            if (!isRangeEmpty) {\n                // 选区不是空的，则执行默认命令\n                editor.command(e, 'RemoveFormat');\n                return;\n            }\n\n            var $clearElem;\n\n            // 自定义的命令函数\n            function commandFn() {\n                var editor = this;\n                var rangeElem;\n                var pElem, $pElem;\n                var quoteElem, $quoteElem;\n                var listElem, $listElem;\n\n                // 获取选区 elem\n                rangeElem = editor.getRangeElem();\n                // 第一步，获取 quote 父元素\n                quoteElem = editor.getSelfOrParentByName(rangeElem, 'blockquote');\n                if (quoteElem) {\n                    $quoteElem = $(quoteElem);\n                    $clearElem = $('<p>' + $quoteElem.text() + '</p>');\n                    $quoteElem.after($clearElem).remove();\n                }\n                // 第二步，获取 p h 父元素\n                pElem = editor.getSelfOrParentByName(rangeElem, 'p,h1,h2,h3,h4,h5');\n                if (pElem) {\n                    $pElem = $(pElem);\n                    $clearElem = $('<p>' + $pElem.text() + '</p>');\n                    $pElem.after($clearElem).remove();\n                }\n                // 第三步，获取list\n                listElem = editor.getSelfOrParentByName(rangeElem, 'ul,ol');\n                if (listElem) {\n                    $listElem = $(listElem);\n                    $clearElem = $('<p>' + $listElem.text() + '</p>');\n                    $listElem.after($clearElem).remove();\n                }\n            }\n\n            // 自定义 callback 事件\n            function callback() {\n                // callback中，设置range为clearElem\n                var editor = this;\n                if ($clearElem) {\n                    editor.restoreSelectionByElem($clearElem.get(0));\n                }\n            }\n\n            // 执行自定义命令\n            editor.customCommand(e, commandFn, callback);\n        };\n\n        // 增加到editor对象中\n        editor.menus[menuId] = menu;\n    });\n\n});\n// source 菜单\n_e(function (E, $) {\n\n    E.createMenu(function (check) {\n        var menuId = 'source';\n        if (!check(menuId)) {\n            return;\n        }\n        var editor = this;\n        var lang = editor.config.lang;\n        var txtHtml;\n\n        // 创建 menu 对象\n        var menu = new E.Menu({\n            editor: editor,\n            id: menuId,\n            title: lang.source\n        });\n\n        menu.isShowCode = false;\n\n        // 更新内容\n        function updateValue() {\n            var $code = menu.$codeTextarea;\n            var $txt = editor.txt.$txt;\n            var value = $.trim($code.val()); // 取值\n\n            if (!value) {\n                value = '<p><br></p>';\n            }\n            \n            // 过滤js代码\n            if (editor.config.jsFilter) {\n                \n                value = value.replace(/<script[\\s\\S]*?<\\/script>/ig, '');\n            }\n            // 赋值\n            try {\n                $txt.html(value);\n            } catch (ex) {\n                // 更新 html 源码出错，一般都是取消了 js 过滤之后，js报错导致的\n            }\n        }\n\n        // 定义click事件\n        menu.clickEvent = function (e) {\n            var self = this;\n            var editor = self.editor;\n            var $txt = editor.txt.$txt;\n            var txtOuterHeight = $txt.outerHeight();\n            var txtHeight = $txt.height();\n\n            if (!self.$codeTextarea) {\n                self.$codeTextarea = $('<textarea class=\"code-textarea\"></textarea>');\n            }\n            var $code = self.$codeTextarea;\n            $code.css({\n                height: txtHeight,\n                'margin-top': txtOuterHeight - txtHeight\n            });\n\n            // 赋值\n            $code.val($txt.html());\n\n            // 监控变化\n            $code.on('change', function (e) {\n                updateValue();\n            });\n\n            // 渲染\n            $txt.after($code).hide();\n            $code.show();\n\n            // 更新状态\n            menu.isShowCode = true;\n\n            // 执行 updateSelected 事件\n            this.updateSelected();\n\n            // 禁用其他菜单\n            editor.disableMenusExcept('source');\n\n            // 记录当前html值\n            txtHtml = $txt.html();\n        };\n\n        // 定义选中状态下的click事件\n        menu.clickEventSelected = function (e) {\n            var self = this;\n            var editor = self.editor;\n            var $txt = editor.txt.$txt;\n            var $code = self.$codeTextarea;\n            var value;\n\n            if (!$code) {\n                return;\n            }\n\n            // 更新内容\n            updateValue();\n\n            // 渲染\n            $code.after($txt).hide();\n            $txt.show();\n\n            // 更新状态\n            menu.isShowCode = false;\n\n            // 执行 updateSelected 事件\n            this.updateSelected();\n\n            // 启用其他菜单\n            editor.enableMenusExcept('source');\n\n            // 判断是否执行 onchange 事件\n            if ($txt.html() !== txtHtml) {\n                if (editor.onchange && typeof editor.onchange === 'function') {\n                    editor.onchange.call(editor);\n                }\n            }\n        };\n\n        // 定义切换选中状态事件\n        menu.updateSelectedEvent = function () {\n            return this.isShowCode;\n        };\n\n        // 增加到editor对象中\n        editor.menus[menuId] = menu;\n    });\n\n});\n// quote 菜单\n_e(function (E, $) {\n\n    E.createMenu(function (check) {\n        var menuId = 'quote';\n        if (!check(menuId)) {\n            return;\n        }\n        var editor = this;\n        var lang = editor.config.lang;\n\n        // 创建 menu 对象\n        var menu = new E.Menu({\n            editor: editor,\n            id: menuId,\n            title: lang.quote,\n            commandName: 'formatBlock',\n            commandValue: 'blockquote'\n        });\n\n        // 定义click事件\n        menu.clickEvent = function (e) {\n            var rangeElem = editor.getRangeElem();\n            var $rangeElem;\n            if (!rangeElem) {\n                e.preventDefault();\n                return;\n            }\n            var currentQuote = editor.getSelfOrParentByName(rangeElem, 'blockquote');\n            var $quote;\n\n            if (currentQuote) {\n                // 说明当前在quote之内，不做任何处理\n                e.preventDefault();\n                return;\n            }\n\n            rangeElem = editor.getLegalTags(rangeElem);\n            $rangeElem = $(rangeElem);\n\n            // 无文字，则不允许执行引用\n            if (!$rangeElem.text()) {\n                return;\n            }\n\n\n            if (!rangeElem) {\n                // 执行默认命令\n                // IE8 下执行此处（不过，经测试代码无效，也不报错）\n                editor.command(e, 'formatBlock', 'blockquote');\n                return;\n            }\n\n            // 自定义command事件\n            function commandFn() {\n                $quote = $('<p>' + $rangeElem.text() + '</p>');\n                $rangeElem.after($quote).remove();\n                $quote.wrap('<blockquote>');\n            }\n\n            // 自定义 callback 事件\n            function callback() {\n                // callback中，设置range为quote\n                var editor = this;\n                if ($quote) {\n                    editor.restoreSelectionByElem($quote.get(0));\n                }\n            }\n\n            // 执行自定义命令\n            editor.customCommand(e, commandFn, callback);\n        };\n\n        // 定义选中状态下的click事件\n        menu.clickEventSelected = function (e) {\n            var rangeElem;\n            var quoteElem;\n            var $lastChild;\n\n            // 获取当前选区的elem，并试图往上找 quote 元素\n            rangeElem = editor.getRangeElem();\n            quoteElem = editor.getSelfOrParentByName(rangeElem, 'blockquote');\n            if (!quoteElem) {\n                // 没找到，则返回\n                e.preventDefault();\n                return;\n            }\n\n            // 自定义的command事件\n            function commandFn() {\n                var $quoteElem;\n                var $children;\n\n                $quoteElem = $(quoteElem);\n                $children = $quoteElem.children();\n                if ($children.length) {\n                    $children.each(function (k) {\n                        var $item = $(this);\n                        if ($item.get(0).nodeName === 'P') {\n                            $quoteElem.after($item);\n                        } else {\n                            $quoteElem.after('<p>' + $item.text() + '</p>');\n                        }\n                        $lastChild = $item;  // 记录最后一个子元素，用于callback中的range定位\n                    });\n                    $quoteElem.remove();\n                    return;\n                }\n            }\n\n            // 自定义的callback函数\n            function callback() {\n                // callback中，设置range为lastChild\n                var editor = this;\n                if ($lastChild) {\n                    editor.restoreSelectionByElem($lastChild.get(0));\n                }\n            }\n\n            // 执行自定义命令\n            editor.customCommand(e, commandFn, callback);\n        };\n\n        // 定义更新选中状态的事件\n        menu.updateSelectedEvent = function () {\n            var self = this; //菜单对象\n            var editor = self.editor;\n            var rangeElem;\n\n            rangeElem = editor.getRangeElem();\n            rangeElem = editor.getSelfOrParentByName(rangeElem, 'blockquote');\n\n            if (rangeElem) {\n                return true;\n            }\n\n            return false;\n        };\n\n        // 增加到editor对象中\n        editor.menus[menuId] = menu;\n\n        // --------------- 两次点击 enter 跳出引用 ---------------\n        editor.ready(function () {\n            var editor = this;\n            var $txt = editor.txt.$txt;\n            var isPrevEnter = false;  // 是不是刚刚在quote中按了 enter 键\n            $txt.on('keydown', function (e) {\n                if (e.keyCode !== 13) {\n                    // 不是 enter 键\n                    isPrevEnter = false;\n                    return;\n                }\n\n                var rangeElem = editor.getRangeElem();\n                rangeElem = editor.getSelfOrParentByName(rangeElem, 'blockquote');\n                if (!rangeElem) {\n                    // 选区不是 quote\n                    isPrevEnter = false;\n                    return;\n                }\n\n                if (!isPrevEnter) {\n                    // 最近没有在qote中按enter键\n                    isPrevEnter = true;\n                    return;\n                }\n\n                var currentRangeElem = editor.getRangeElem();\n                var $currentRangeElem = $(currentRangeElem);\n                if ($currentRangeElem.length) {\n                    $currentRangeElem.parent().after($currentRangeElem);\n                }\n\n                // 设置选区\n                editor.restoreSelectionByElem(currentRangeElem, 'start');\n\n                isPrevEnter = false;\n                // 阻止默认行文\n                e.preventDefault();\n\n            });\n        }); // editor.ready(\n\n        // --------------- 处理quote中无内容时不能删除的问题 ---------------\n        editor.ready(function () {\n            var editor = this;\n            var $txt = editor.txt.$txt;\n            var $rangeElem;\n\n            function commandFn() {\n                $rangeElem && $rangeElem.remove();\n            }\n            function callback() {\n                if (!$rangeElem) {\n                    return;\n                }\n                var $prev = $rangeElem.prev();\n                if ($prev.length) {\n                    // 有 prev 则定位到 prev 最后\n                    editor.restoreSelectionByElem($prev.get(0));\n                } else {\n                    // 无 prev 则初始化选区\n                    editor.initSelection();\n                }\n            }\n\n            $txt.on('keydown', function (e) {\n                if (e.keyCode !== 8) {\n                    // 不是 backspace 键\n                    return;\n                }\n\n                var rangeElem = editor.getRangeElem();\n                rangeElem = editor.getSelfOrParentByName(rangeElem, 'blockquote');\n                if (!rangeElem) {\n                    // 选区不是 quote\n                    return;\n                }\n                $rangeElem = $(rangeElem);\n\n                var text = $rangeElem.text();\n                if (text) {\n                    // quote 中还有内容\n                    return;\n                }\n                editor.customCommand(e, commandFn, callback);\n\n            }); // $txt.on\n        }); // editor.ready(\n    });\n\n});\n// 字体 菜单\n_e(function (E, $) {\n\n    E.createMenu(function (check) {\n        var menuId = 'fontfamily';\n        if (!check(menuId)) {\n            return;\n        }\n        var editor = this;\n        var lang = editor.config.lang;\n        var configFamilys = editor.config.familys;\n\n        // 创建 menu 对象\n        var menu = new E.Menu({\n            editor: editor,\n            id: menuId,\n            title: lang.fontfamily,\n            commandName: 'fontName'\n        });\n\n        // 初始化数据\n        var data  = {};\n        /*\n            data 需要的结构\n            {\n                'commandValue': 'title'\n                ...\n            }\n        */\n        $.each(configFamilys, function (k, v) {\n            // configFamilys 是数组，data 是对象\n            data[v] = v;\n        });\n\n        // 创建droplist\n        var tpl = '<span style=\"font-family:{#commandValue};\">{#title}</span>';\n        menu.dropList = new E.DropList(editor, menu, {\n            data: data,\n            tpl: tpl,\n            selectorForELemCommand: 'font[face]'  // 为了执行 editor.commandForElem 而传入的elem查询方式\n        });\n\n        // 定义 update selected 事件\n        menu.updateSelectedEvent = function () {\n            var rangeElem = editor.getRangeElem();\n            rangeElem = editor.getSelfOrParentByName(rangeElem, 'font[face]');\n            if (rangeElem) {\n                return true;\n            }\n            return false;\n        };\n\n        // 增加到editor对象中\n        editor.menus[menuId] = menu;\n    });\n});\n// 字号 菜单\n_e(function (E, $) {\n    E.createMenu(function (check) {\n        var menuId = 'fontsize';\n        if (!check(menuId)) {\n            return;\n        }\n        var editor = this;\n        var lang = editor.config.lang;\n        var configSize = editor.config.fontsizes;\n\n        // 创建 menu 对象\n        var menu = new E.Menu({\n            editor: editor,\n            id: menuId,\n            title: lang.fontsize,\n            commandName: 'fontSize'\n        });\n\n        // 初始化数据\n        var data  = configSize;\n        /*\n            data 需要的结构\n            {\n                'commandValue': 'title'\n                ...\n            }\n        */\n\n        // 创建droplist\n        var tpl = '<span style=\"font-size:{#title};\">{#title}</span>';\n        menu.dropList = new E.DropList(editor, menu, {\n            data: data,\n            tpl: tpl,\n            selectorForELemCommand: 'font[size]'  // 为了执行 editor.commandForElem 而传入的elem查询方式\n        });\n\n        // 定义 update selected 事件\n        menu.updateSelectedEvent = function () {\n            var rangeElem = editor.getRangeElem();\n            rangeElem = editor.getSelfOrParentByName(rangeElem, 'font[size]');\n            if (rangeElem) {\n                return true;\n            }\n            return false;\n        };\n\n        // 增加到editor对象中\n        editor.menus[menuId] = menu;\n    });\n});\n// head 菜单\n_e(function (E, $) {\n    E.createMenu(function (check) {\n        var menuId = 'head';\n        if (!check(menuId)) {\n            return;\n        }\n        var editor = this;\n        var lang = editor.config.lang;\n\n        // 创建 menu 对象\n        var menu = new E.Menu({\n            editor: editor,\n            id: menuId,\n            title: lang.head,\n            commandName: 'formatBlock'\n        });\n\n        // 初始化数据\n        var data  = {\n            '<h1>': '标题1',\n            '<h2>': '标题2',\n            '<h3>': '标题3',\n            '<h4>': '标题4',\n            '<h5>': '标题5'\n        };\n        /*\n            data 需要的结构\n            {\n                'commandValue': 'title'\n                ...\n            }\n        */\n\n        var isOrderedList;\n        function beforeEvent(e) {\n            if (editor.queryCommandState('InsertOrderedList')) {\n                isOrderedList = true;\n\n                // 先取消有序列表\n                editor.command(e, 'InsertOrderedList');\n            } else {\n                isOrderedList = false;\n            }\n        }\n\n        function afterEvent(e) {\n            if (isOrderedList) {\n                // 再设置有序列表\n                editor.command(e, 'InsertOrderedList');\n            }\n        }\n\n        // 创建droplist\n        var tpl = '{#commandValue}{#title}';\n        menu.dropList = new E.DropList(editor, menu, {\n            data: data,\n            tpl: tpl,\n            // 对 ol 直接设置 head，会出现每个 li 的 index 都变成 1 的问题，因此要先取消 ol，然后设置 head，最后再增加上 ol\n            beforeEvent: beforeEvent,\n            afterEvent: afterEvent\n        });\n\n        // 定义 update selected 事件\n        menu.updateSelectedEvent = function () {\n            var rangeElem = editor.getRangeElem();\n            rangeElem = editor.getSelfOrParentByName(rangeElem, 'h1,h2,h3,h4,h5');\n            if (rangeElem) {\n                return true;\n            }\n            return false;\n        };\n\n        // 增加到editor对象中\n        editor.menus[menuId] = menu;\n    });\n});\n// unorderlist 菜单\n_e(function (E, $) {\n\n    E.createMenu(function (check) {\n        var menuId = 'unorderlist';\n        if (!check(menuId)) {\n            return;\n        }\n        var editor = this;\n        var lang = editor.config.lang;\n\n        // 创建 menu 对象\n        var menu = new E.Menu({\n            editor: editor,\n            id: menuId,\n            title: lang.unorderlist,\n            commandName: 'InsertUnorderedList'\n        });\n\n        // 增加到editor对象中\n        editor.menus[menuId] = menu;\n    });\n\n});\n// orderlist 菜单\n_e(function (E, $) {\n\n    E.createMenu(function (check) {\n        var menuId = 'orderlist';\n        if (!check(menuId)) {\n            return;\n        }\n        var editor = this;\n        var lang = editor.config.lang;\n\n        // 创建 menu 对象\n        var menu = new E.Menu({\n            editor: editor,\n            id: menuId,\n            title: lang.orderlist,\n            commandName: 'InsertOrderedList'\n        });\n\n        // 增加到editor对象中\n        editor.menus[menuId] = menu;\n    });\n\n});\n// alignleft 菜单\n_e(function (E, $) {\n\n    E.createMenu(function (check) {\n        var menuId = 'alignleft';\n        if (!check(menuId)) {\n            return;\n        }\n        var editor = this;\n        var lang = editor.config.lang;\n\n        // 创建 menu 对象\n        var menu = new E.Menu({\n            editor: editor,\n            id: menuId,\n            title: lang.alignleft,\n            commandName: 'JustifyLeft'\n        });\n\n        // 定义 update selected 事件\n        menu.updateSelectedEvent = function () {\n            var rangeElem = editor.getRangeElem();\n            rangeElem = editor.getSelfOrParentByName(rangeElem, 'p,h1,h2,h3,h4,h5,li', function (elem) {\n                var cssText;\n                if (elem && elem.style && elem.style.cssText != null) {\n                    cssText = elem.style.cssText;\n                    if (cssText && /text-align:\\s*left;/.test(cssText)) {\n                        return true;\n                    }\n                }\n                if ($(elem).attr('align') === 'left') {\n                    // ff 中，设置align-left之后，会是 <p align=\"left\">xxx</p>\n                    return true;\n                }\n                return false;\n            });\n            if (rangeElem) {\n                return true;\n            }\n            return false;\n        };\n\n        // 增加到editor对象中\n        editor.menus[menuId] = menu;\n    });\n\n});\n// aligncenter 菜单\n_e(function (E, $) {\n\n    E.createMenu(function (check) {\n        var menuId = 'aligncenter';\n        if (!check(menuId)) {\n            return;\n        }\n        var editor = this;\n        var lang = editor.config.lang;\n\n        // 创建 menu 对象\n        var menu = new E.Menu({\n            editor: editor,\n            id: menuId,\n            title: lang.aligncenter,\n            commandName: 'JustifyCenter'\n        });\n\n        // 定义 update selected 事件\n        menu.updateSelectedEvent = function () {\n            var rangeElem = editor.getRangeElem();\n            rangeElem = editor.getSelfOrParentByName(rangeElem, 'p,h1,h2,h3,h4,h5,li', function (elem) {\n                var cssText;\n                if (elem && elem.style && elem.style.cssText != null) {\n                    cssText = elem.style.cssText;\n                    if (cssText && /text-align:\\s*center;/.test(cssText)) {\n                        return true;\n                    }\n                }\n                if ($(elem).attr('align') === 'center') {\n                    // ff 中，设置align-center之后，会是 <p align=\"center\">xxx</p>\n                    return true;\n                }\n                return false;\n            });\n            if (rangeElem) {\n                return true;\n            }\n            return false;\n        };\n\n        // 增加到editor对象中\n        editor.menus[menuId] = menu;\n    });\n\n});\n// alignright 菜单\n_e(function (E, $) {\n\n    E.createMenu(function (check) {\n        var menuId = 'alignright';\n        if (!check(menuId)) {\n            return;\n        }\n        var editor = this;\n        var lang = editor.config.lang;\n\n        // 创建 menu 对象\n        var menu = new E.Menu({\n            editor: editor,\n            id: menuId,\n            title: lang.alignright,\n            commandName: 'JustifyRight'\n        });\n\n        // 定义 update selected 事件\n        menu.updateSelectedEvent = function () {\n            var rangeElem = editor.getRangeElem();\n            rangeElem = editor.getSelfOrParentByName(rangeElem, 'p,h1,h2,h3,h4,h5,li', function (elem) {\n                var cssText;\n                if (elem && elem.style && elem.style.cssText != null) {\n                    cssText = elem.style.cssText;\n                    if (cssText && /text-align:\\s*right;/.test(cssText)) {\n                        return true;\n                    }\n                }\n                if ($(elem).attr('align') === 'right') {\n                    // ff 中，设置align-right之后，会是 <p align=\"right\">xxx</p>\n                    return true;\n                }\n                return false;\n            });\n            if (rangeElem) {\n                return true;\n            }\n            return false;\n        };\n\n        // 增加到editor对象中\n        editor.menus[menuId] = menu;\n    });\n\n});\n// link 菜单\n_e(function (E, $) {\n\n    E.createMenu(function (check) {\n        var menuId = 'link';\n        if (!check(menuId)) {\n            return;\n        }\n        var editor = this;\n        var lang = editor.config.lang;\n\n        // 创建 menu 对象\n        var menu = new E.Menu({\n            editor: editor,\n            id: menuId,\n            title: lang.link\n        });\n\n        // 创建 dropPanel\n        var $content = $('<div></div>');\n        var $div1 = $('<div style=\"margin:20px 10px;\" class=\"clearfix\"></div>');\n        var $div2 = $div1.clone();\n        var $div3 = $div1.clone().css('margin', '0 10px');\n        var $textInput = $('<input type=\"text\" class=\"block\" placeholder=\"' + lang.text + '\"/>');\n        var $urlInput = $('<input type=\"text\" class=\"block\" placeholder=\"' + lang.link + '\"/>');\n        var $btnSubmit = $('<button class=\"right\">' + lang.submit + '</button>');\n        var $btnCancel = $('<button class=\"right gray\">' + lang.cancel + '</button>');\n\n        $div1.append($textInput);\n        $div2.append($urlInput);\n        $div3.append($btnSubmit).append($btnCancel);\n        $content.append($div1).append($div2).append($div3);\n        \n        menu.dropPanel = new E.DropPanel(editor, menu, {\n            $content: $content,\n            width: 300\n        });\n\n        // 定义click事件\n        menu.clickEvent = function (e) {\n            var menu = this;\n            var dropPanel = menu.dropPanel;\n\n            // -------------隐藏----------------\n            if (dropPanel.isShowing) {\n                dropPanel.hide();\n                return;\n            }\n\n            // -------------显示----------------\n\n            // 重置 input\n            $textInput.val('');\n            $urlInput.val('http://');\n\n            // 获取url\n            var url = '';\n            var rangeElem = editor.getRangeElem();\n            rangeElem = editor.getSelfOrParentByName(rangeElem, 'a');\n            if (rangeElem) {\n                url = rangeElem.href || '';\n            }\n\n            // 获取 text\n            var text = '';\n            var isRangeEmpty = editor.isRangeEmpty();\n            if (!isRangeEmpty) {\n                // 选区不是空\n                text = editor.getRangeText() || '';\n            } else if (rangeElem) {\n                // 如果选区空，并且在 a 标签之内\n                text = rangeElem.textContent || rangeElem.innerHTML;\n            }\n\n            // 设置 url 和 text\n            url && $urlInput.val(url);\n            text && $textInput.val(text);\n\n            // 如果有选区内容，textinput 不能修改\n            if (!isRangeEmpty) {\n                $textInput.attr('disabled', true);\n            } else {\n                $textInput.removeAttr('disabled');\n            }\n\n            // 显示（要设置好了所有input的值和属性之后再显示）\n            dropPanel.show();\n        };\n\n        // 定义 update selected 事件\n        menu.updateSelectedEvent = function () {\n            var rangeElem = editor.getRangeElem();\n            rangeElem = editor.getSelfOrParentByName(rangeElem, 'a');\n            if (rangeElem) {\n                return true;\n            }\n            return false;\n        };\n\n        // 『取消』 按钮\n        $btnCancel.click(function (e) {\n            e.preventDefault();\n            menu.dropPanel.hide();\n        });\n\n        // 『确定』按钮\n        $btnSubmit.click(function (e) {\n            e.preventDefault();\n            var rangeElem = editor.getRangeElem();\n            var targetElem = editor.getSelfOrParentByName(rangeElem, 'a');\n            var isRangeEmpty = editor.isRangeEmpty();\n\n            var $linkElem, linkHtml;\n            var commandFn, callback;\n            var $txt = editor.txt.$txt;\n            var $oldLinks, $newLinks;\n            var uniqId = 'link' + E.random();\n\n            // 获取数据\n            var url = $.trim($urlInput.val());\n            var text = $.trim($textInput.val());\n\n            if (!url) {\n                menu.dropPanel.focusFirstInput();\n                return;\n            }\n            if (!text) {\n                text = url;\n            }\n\n            if (!isRangeEmpty) {\n                // 选中区域有内容，则执行默认命令\n\n                // 获取目前 txt 内所有链接，并为当前链接做一个标记\n                $oldLinks = $txt.find('a');\n                $oldLinks.attr(uniqId, '1');\n\n                // 执行命令 \n                editor.command(e, 'createLink', url);\n\n                // 去的没有标记的链接，即刚刚插入的链接\n                $newLinks = $txt.find('a').not('[' + uniqId + ']');\n                $newLinks.attr('target', '_blank'); // 增加 _blank\n\n                // 去掉之前做的标记\n                $oldLinks.removeAttr(uniqId);\n\n            } else if (targetElem) {\n                // 无选中区域，在 a 标签之内，修改该 a 标签的内容和链接\n                $linkElem = $(targetElem);\n                commandFn = function () {\n                    $linkElem.attr('href', url);\n                    $linkElem.text(text);\n                };\n                callback = function () {\n                    var editor = this;\n                    editor.restoreSelectionByElem(targetElem);\n                };\n                // 执行命令\n                editor.customCommand(e, commandFn, callback);\n            } else {\n                // 无选中区域，不在 a 标签之内，插入新的链接\n\n                linkHtml = '<a href=\"' + url + '\" target=\"_blank\">' + text + '</a>';\n                if (E.userAgent.indexOf('Firefox') > 0) {\n                    linkHtml += '<span>&nbsp;</span>';\n                }\n                editor.command(e, 'insertHtml', linkHtml);\n            }\n\n        });\n        \n        // 增加到editor对象中\n        editor.menus[menuId] = menu;\n    });\n\n});\n// unlink 菜单\n_e(function (E, $) {\n\n    E.createMenu(function (check) {\n        var menuId = 'unlink';\n        if (!check(menuId)) {\n            return;\n        }\n        var editor = this;\n        var lang = editor.config.lang;\n\n        // 创建 menu 对象\n        var menu = new E.Menu({\n            editor: editor,\n            id: menuId,\n            title: lang.unlink,\n            commandName: 'unLink'\n        });\n\n        // click 事件\n        menu.clickEvent = function  (e) {\n            var isRangeEmpty = editor.isRangeEmpty();\n            if (!isRangeEmpty) {\n                // 有选中区域，或者IE8，执行默认命令\n                editor.command(e, 'unLink');\n                return;\n            }\n\n            // 无选中区域...\n\n            var rangeElem = editor.getRangeElem();\n            var aElem = editor.getSelfOrParentByName(rangeElem, 'a');\n            if (!aElem) {\n                // 不在 a 之内，返回\n                e.preventDefault();\n                return;\n            }\n\n            // 在 a 之内\n            var $a = $(aElem);\n            var $span = $('<span>' + $a.text() + '</span>');\n            function commandFn() {\n                $a.after($span).remove();\n            }\n            function callback() {\n                editor.restoreSelectionByElem($span.get(0));\n            }\n            editor.customCommand(e, commandFn, callback);\n        };\n\n        // 增加到editor对象中\n        editor.menus[menuId] = menu;\n    });\n\n});\n// table 菜单\n_e(function (E, $) {\n\n    E.createMenu(function (check) {\n        var menuId = 'table';\n        if (!check(menuId)) {\n            return;\n        }\n        var editor = this;\n        var lang = editor.config.lang;\n\n        // 创建 menu 对象\n        var menu = new E.Menu({\n            editor: editor,\n            id: menuId,\n            title: lang.table\n        });\n\n        // dropPanel 内容\n        var $content = $('<div style=\"font-size: 14px; color: #666; text-align:right;\"></div>');\n        var $table = $('<table class=\"choose-table\" style=\"margin-bottom:10px;margin-top:5px;\">');\n        var $row = $('<span>0</span>');\n        var $rowspan = $('<span> 行 </span>');\n        var $col = $('<span>0</span>');\n        var $colspan = $('<span> 列</span>');\n        var $tr;\n        var i, j;\n\n        // 创建一个n行n列的表格\n        for (i = 0; i < 15; i++) {\n            $tr = $('<tr index=\"' + (i + 1) + '\">');\n            for (j = 0; j < 20; j++) {\n                $tr.append($('<td index=\"' + (j + 1) + '\">'));\n            }\n            $table.append($tr);\n        }\n        $content.append($table);\n        $content.append($row).append($rowspan).append($col).append($colspan);\n\n        // 定义table事件\n        $table.on('mouseenter', 'td', function (e) {\n            var $currentTd = $(e.currentTarget);\n            var currentTdIndex = $currentTd.attr('index');\n            var $currentTr = $currentTd.parent();\n            var currentTrIndex = $currentTr.attr('index');\n\n            // 显示\n            $row.text(currentTrIndex);\n            $col.text(currentTdIndex);\n\n            // 遍历设置背景颜色\n            $table.find('tr').each(function () {\n                var $tr = $(this);\n                var trIndex = $tr.attr('index');\n                if (parseInt(trIndex, 10) <= parseInt(currentTrIndex, 10)) {\n                    // 该行需要可能需要设置背景色\n                    $tr.find('td').each(function () {\n                        var $td = $(this);\n                        var tdIndex = $td.attr('index');\n                        if (parseInt(tdIndex, 10) <= parseInt(currentTdIndex, 10)) {\n                            // 需要设置背景色\n                            $td.addClass('active');\n                        } else {\n                            // 需要移除背景色\n                            $td.removeClass('active');\n                        }\n                    });\n                } else {\n                    // 改行不需要设置背景色\n                    $tr.find('td').removeClass('active');\n                }\n            });\n        }).on('mouseleave', function (e) {\n            // mouseleave 删除背景色\n            $table.find('td').removeClass('active');\n\n            $row.text(0);\n            $col.text(0);\n        });\n\n        // 插入表格\n        $table.on('click', 'td', function (e) {\n            var $currentTd = $(e.currentTarget);\n            var currentTdIndex = $currentTd.attr('index');\n            var $currentTr = $currentTd.parent();\n            var currentTrIndex = $currentTr.attr('index');\n\n            var rownum = parseInt(currentTrIndex, 10);\n            var colnum = parseInt(currentTdIndex, 10);\n\n            // -------- 拼接tabel html --------\n\n            var i, j;\n            var tableHtml = '<table>';\n            for (i = 0; i < rownum; i++) {\n                tableHtml += '<tr>';\n\n                for (j = 0; j < colnum; j++) {\n                    tableHtml += '<td><span>&nbsp;</span></td>';\n                }\n                tableHtml += '</tr>';\n            }\n            tableHtml += '</table>';\n\n            // -------- 执行命令 --------\n            editor.command(e, 'insertHtml', tableHtml);\n        });\n\n        // 创建 panel\n        menu.dropPanel = new E.DropPanel(editor, menu, {\n            $content: $content,\n            width: 262\n        });\n\n        // 增加到editor对象中\n        editor.menus[menuId] = menu;\n    });\n\n});\n// emotion 菜单\n_e(function (E, $) {\n\n    E.createMenu(function (check) {\n        var menuId = 'emotion';\n        if (!check(menuId)) {\n            return;\n        }\n        var editor = this;\n        var config = editor.config;\n        var lang = config.lang;\n        var configEmotions = config.emotions;\n        var emotionsShow = config.emotionsShow;\n\n        // 记录每一个表情图片的地址\n        editor.emotionUrls = [];\n\n        // 创建 menu 对象\n        var menu = new E.Menu({\n            editor: editor,\n            id: menuId,\n            title: lang.emotion\n        });\n\n        // 添加表情图片的函数\n        function insertEmotionImgs(data, $tabContent) {\n            // 添加表情图片\n            $.each(data, function (k, emotion) {\n                var src = emotion.icon || emotion.url;\n                var value = emotion.value || emotion.title;\n                // 通过配置 editor.config.emotionsShow 的值来修改插入到编辑器的内容（图片/value）\n                var commandValue = emotionsShow === 'icon' ? src : value;\n                var $command = $('<a href=\"#\" commandValue=\"' + commandValue + '\"></a>');\n                var $img = $('<img>');\n                $img.attr('_src', src);  // 先将 src 复制到 '_src' 属性，先不加载\n\n                $command.append($img);\n                $tabContent.append($command);\n\n                // 记录下每一个表情图片的地址\n                editor.emotionUrls.push(src);\n            });\n        }\n\n        // 拼接 dropPanel 内容\n        var $panelContent = $('<div class=\"panel-tab\"></div>');\n        var $tabContainer = $('<div class=\"tab-container\"></div>');\n        var $contentContainer = $('<div class=\"content-container emotion-content-container\"></div>');\n        $.each(configEmotions, function (k, emotion) {\n            var title = emotion.title;\n            var data = emotion.data;\n\n            E.log('正在处理 ' + title + ' 表情的数据...');\n\n            // 增加该组表情的tab和content\n            var $tab = $('<a href=\"#\">' + title +' </a>');\n            $tabContainer.append($tab);\n            var $tabContent = $('<div class=\"content\"></div>');\n            $contentContainer.append($tabContent);\n\n            // tab 切换事件\n            $tab.click(function (e) {\n                $tabContainer.children().removeClass('selected');\n                $contentContainer.children().removeClass('selected');\n                $tabContent.addClass('selected');\n                $tab.addClass('selected');\n                e.preventDefault();\n            });\n\n            // 处理data\n            if (typeof data === 'string') {\n                // url 形式，需要通过ajax从该url获取数据\n                E.log('将通过 ' + data + ' 地址ajax下载表情包');\n                $.get(data, function (result) {\n                    result = $.parseJSON(result);\n                    E.log('下载完毕，得到 ' + result.length + ' 个表情');\n                    insertEmotionImgs(result, $tabContent);\n                });\n                \n            } else if ( Object.prototype.toString.call(data).toLowerCase().indexOf('array') > 0 ) {\n                // 数组，即 data 直接就是表情包数据\n                insertEmotionImgs(data, $tabContent);\n            } else {\n                // 其他情况，data格式不对\n                E.error('data 数据格式错误，请修改为正确格式，参考文档：' + E.docsite);\n                return;\n            }\n        });\n        $panelContent.append($tabContainer).append($contentContainer);\n\n        // 默认显示第一个tab\n        $tabContainer.children().first().addClass('selected');\n        $contentContainer.children().first().addClass('selected');\n\n        // 插入表情command事件\n        $contentContainer.on('click', 'a[commandValue]', function (e) {\n            var $a = $(e.currentTarget);\n            var commandValue = $a.attr('commandValue');\n            var img;\n\n            // commandValue 有可能是图片url，也有可能是表情的 value，需要区别对待\n\n            if (emotionsShow === 'icon') {\n                // 插入图片\n                editor.command(e, 'InsertImage', commandValue);\n            } else {\n                // 插入value\n                editor.command(e, 'insertHtml', '<span>' + commandValue + '</span>');\n            }\n\n            e.preventDefault();\n        });\n\n        // 添加panel\n        menu.dropPanel = new E.DropPanel(editor, menu, {\n            $content: $panelContent,\n            width: 350\n        });\n\n        // 定义click事件（异步加载表情图片）\n        menu.clickEvent = function (e) {\n            var menu = this;\n            var dropPanel = menu.dropPanel;\n\n            // -------------隐藏-------------\n            if (dropPanel.isShowing) {\n                dropPanel.hide();\n                return;\n            }\n\n            // -------------显示-------------\n            dropPanel.show();\n\n            // 异步加载图片\n            if (menu.imgLoaded) {\n                return;\n            }\n            $contentContainer.find('img').each(function () {\n                var $img = $(this);\n                var _src = $img.attr('_src');\n                $img.on('error', function () {\n                    E.error('加载不出表情图片 ' + _src);\n                });\n                $img.attr('src', _src);\n                $img.removeAttr('_src');\n            });\n            menu.imgLoaded = true;\n        };\n\n        // 增加到editor对象中\n        editor.menus[menuId] = menu;\n    });\n\n});\n// img 菜单\n_e(function (E, $) {\n\n    E.createMenu(function (check) {\n        var menuId = 'img';\n        if (!check(menuId)) {\n            return;\n        }\n        var editor = this;\n        var lang = editor.config.lang;\n\n        // 创建 menu 对象\n        var menu = new E.Menu({\n            editor: editor,\n            id: menuId,\n            title: lang.img\n        });\n\n        // 创建 panel content\n        var $panelContent = $('<div class=\"panel-tab\"></div>');\n        var $tabContainer = $('<div class=\"tab-container\"></div>');\n        var $contentContainer = $('<div class=\"content-container\"></div>');\n        $panelContent.append($tabContainer).append($contentContainer);\n\n        // tab\n        var $uploadTab = $('<a href=\"#\">' + lang.uploadImg + '</a>');\n        var $linkTab = $('<a href=\"#\">' + lang.linkImg + '</a>');\n        $tabContainer.append($uploadTab).append($linkTab);\n\n        // 上传图片 content\n        var $uploadContent = $('<div class=\"content\"></div>');\n        $contentContainer.append($uploadContent);\n\n        // 网络图片 content\n        var $linkContent = $('<div class=\"content\"></div>');\n        $contentContainer.append($linkContent);\n        linkContentHandler(editor, menu, $linkContent);\n\n        // 添加panel\n        menu.dropPanel = new E.DropPanel(editor, menu, {\n            $content: $panelContent,\n            width: 400,\n            onRender: function () {\n                // 渲染后的回调事件，用于执行自定义上传的init\n                // 因为渲染之后，上传面板的dom才会被渲染到页面，才能让第三方空间获取到\n                var init = editor.config.customUploadInit;\n                init && init.call(editor);\n            }\n        });\n\n        // 增加到editor对象中\n        editor.menus[menuId] = menu;\n\n        // tab 切换事件\n        function tabToggle() {\n            $uploadTab.click(function (e) {\n                $tabContainer.children().removeClass('selected');\n                $contentContainer.children().removeClass('selected');\n                $uploadContent.addClass('selected');\n                $uploadTab.addClass('selected');\n                e.preventDefault();\n            });\n            $linkTab.click(function (e) {\n                $tabContainer.children().removeClass('selected');\n                $contentContainer.children().removeClass('selected');\n                $linkContent.addClass('selected');\n                $linkTab.addClass('selected');\n                e.preventDefault();\n\n                // focus input\n                if (E.placeholder) {\n                    $linkContent.find('input[type=text]').focus();\n                }\n            });\n\n            // 默认情况\n            // $uploadTab.addClass('selected');\n            // $uploadContent.addClass('selected');\n            $uploadTab.click();\n        }\n\n        // 隐藏上传图片\n        function hideUploadImg() {\n            $tabContainer.remove();\n            $uploadContent.remove();\n            $linkContent.addClass('selected');\n        }\n\n        // 隐藏网络图片\n        function hideLinkImg() {\n            $tabContainer.remove();\n            $linkContent.remove();\n            $uploadContent.addClass('selected');\n        }\n\n        // 判断用户是否配置了上传图片\n        editor.ready(function () {\n            var editor = this;\n            var config = editor.config;\n            var uploadImgUrl = config.uploadImgUrl;\n            var customUpload = config.customUpload;\n            var linkImg = config.hideLinkImg;\n            var $uploadImgPanel;\n\n            if (uploadImgUrl || customUpload) {\n                // 第一，暴露出 $uploadContent 以便用户自定义 ！！！重要\n                editor.$uploadContent = $uploadContent;\n\n                // 第二，绑定tab切换事件\n                tabToggle();\n\n                if (linkImg) {\n                    // 隐藏网络图片\n                    hideLinkImg();\n                }\n            } else {\n                // 未配置上传图片功能\n                hideUploadImg();\n            }\n\n            // 点击 $uploadContent 立即隐藏 dropPanel\n            // 为了兼容IE8、9的上传，因为IE8、9使用 modal 上传\n            // 这里使用异步，为了不妨碍高级浏览器通过点击 $uploadContent 选择文件\n            function hidePanel() {\n                menu.dropPanel.hide();\n            }\n            $uploadContent.click(function () {\n                setTimeout(hidePanel);\n            });\n        });\n    });\n\n    // --------------- 处理网络图片content ---------------\n    function linkContentHandler (editor, menu, $linkContent) {\n        var lang = editor.config.lang;\n        var $urlContainer = $('<div style=\"margin:20px 10px 10px 10px;\"></div>');\n        var $urlInput = $('<input type=\"text\" class=\"block\" placeholder=\"http://\"/>');\n        $urlContainer.append($urlInput);\n        var $btnSubmit = $('<button class=\"right\">' + lang.submit + '</button>');\n        var $btnCancel = $('<button class=\"right gray\">' + lang.cancel + '</button>');\n\n        $linkContent.append($urlContainer).append($btnSubmit).append($btnCancel);\n\n        // 取消\n        $btnCancel.click(function (e) {\n            e.preventDefault();\n            menu.dropPanel.hide();\n        });\n\n        // callback \n        function callback() {\n            $urlInput.val('');\n        }\n\n        // 确定\n        $btnSubmit.click(function (e) {\n            e.preventDefault();\n            var url = $.trim($urlInput.val());\n            if (!url) {\n                // 无内容\n                $urlInput.focus();\n                return;\n            }\n\n            var imgHtml = '<img style=\"max-width:100%;\" src=\"' + url + '\"/>';\n            editor.command(e, 'insertHtml', imgHtml, callback);\n        });\n    }\n\n});\n// video 菜单\n_e(function (E, $) {\n\n    E.createMenu(function (check) {\n        var menuId = 'video';\n        if (!check(menuId)) {\n            return;\n        }\n        var editor = this;\n        var lang = editor.config.lang;\n        var reg = /^<(iframe)|(embed)/i;  // <iframe... 或者 <embed... 格式\n\n        // 创建 menu 对象\n        var menu = new E.Menu({\n            editor: editor,\n            id: menuId,\n            title: lang.video\n        });\n\n        // 创建 panel 内容\n        var $content = $('<div></div>');\n        var $linkInputContainer = $('<div style=\"margin:20px 10px;\"></div>');\n        var $linkInput = $('<input type=\"text\" class=\"block\" placeholder=\\'格式如：<iframe src=\"...\" frameborder=0 allowfullscreen></iframe>\\'/>');\n        $linkInputContainer.append($linkInput);\n        var $sizeContainer = $('<div style=\"margin:20px 10px;\"></div>');\n        var $widthInput = $('<input type=\"text\" value=\"640\" style=\"width:50px;text-align:center;\"/>');\n        var $heightInput = $('<input type=\"text\" value=\"498\" style=\"width:50px;text-align:center;\"/>');\n        $sizeContainer.append('<span> ' + lang.width + ' </span>')\n                      .append($widthInput)\n                      .append('<span> px &nbsp;&nbsp;&nbsp;</span>')\n                      .append('<span> ' + lang.height + ' </span>')\n                      .append($heightInput)\n                      .append('<span> px </span>');\n        var $btnContainer = $('<div></div>');\n        var $howToCopy = $('<a href=\"http://www.kancloud.cn/wangfupeng/wangeditor2/134973\" target=\"_blank\" style=\"display:inline-block;margin-top:10px;margin-left:10px;color:#999;\">如何复制视频链接？</a>');\n        var $btnSubmit = $('<button class=\"right\">' + lang.submit + '</button>');\n        var $btnCancel = $('<button class=\"right gray\">' + lang.cancel + '</button>');\n        $btnContainer.append($howToCopy).append($btnSubmit).append($btnCancel);\n        $content.append($linkInputContainer).append($sizeContainer).append($btnContainer);\n\n        // 取消按钮\n        $btnCancel.click(function (e) {\n            e.preventDefault();\n            $linkInput.val('');\n            menu.dropPanel.hide();\n        });\n\n        // 确定按钮\n        $btnSubmit.click(function (e) {\n            e.preventDefault();\n            var link = $.trim($linkInput.val());\n            var $link;\n            var width = parseInt($widthInput.val());\n            var height = parseInt($heightInput.val());\n            var $div = $('<div>');\n            var html = '<p>{content}</p>';\n\n            // 验证数据\n            if (!link) {\n                menu.dropPanel.focusFirstInput();\n                return;\n            }\n\n            if (!reg.test(link)) {\n                alert('视频链接格式错误！');\n                menu.dropPanel.focusFirstInput();\n                return;\n            }\n\n            if (isNaN(width) || isNaN(height)) {\n                alert('宽度或高度不是数字！');\n                return;\n            }\n\n            $link = $(link);\n\n            // 设置高度和宽度\n            $link.attr('width', width)\n                 .attr('height', height);\n\n            // 拼接字符串\n            html = html.replace('{content}', $div.append($link).html());\n\n            // 执行命令\n            editor.command(e, 'insertHtml', html);\n            $linkInput.val('');\n        });\n\n        // 创建panel\n        menu.dropPanel = new E.DropPanel(editor, menu, {\n            $content: $content,\n            width: 400\n        });\n\n        // 增加到editor对象中\n        editor.menus[menuId] = menu;\n    });\n\n});\n// location 菜单\n_e(function (E, $) {\n\n    // 判断浏览器的 input 是否支持 keyup\n    var inputKeyup = (function (input) {\n        return 'onkeyup' in input;\n    })(document.createElement('input'));\n\n    // 百度地图的key\n    E.baiduMapAk = 'TVhjYjq1ICT2qqL5LdS8mwas';\n\n    // 一个页面中，如果有多个编辑器，地图会出现问题。这个参数记录一下，如果超过 1 就提示\n    E.numberOfLocation = 0;\n\n    E.createMenu(function (check) {\n        var menuId = 'location';\n        if (!check(menuId)) {\n            return;\n        }\n\n        if (++E.numberOfLocation > 1) {\n            E.error('目前不支持在一个页面多个编辑器上同时使用地图，可通过自定义菜单配置去掉地图菜单');\n            return;\n        }\n\n        var editor = this;\n        var config = editor.config;\n        var lang = config.lang;\n        var ak = config.mapAk;\n\n        // 地图的变量存储到这个地方\n        editor.mapData = {};\n        var mapData = editor.mapData;\n\n        // ---------- 地图事件 ----------\n        mapData.markers = [];\n        mapData.mapContainerId = 'map' + E.random();\n\n        mapData.clearLocations = function () {\n            var map = mapData.map;\n            if (!map) {\n                return;\n            }\n            map.clearOverlays();\n\n            //同时，清空marker数组\n            mapData.markers = [];\n        };\n\n        mapData.searchMap = function () {\n            var map = mapData.map;\n            if (!map) {\n                return;\n            }\n\n            var BMap = window.BMap;\n            var cityName = $cityInput.val();\n            var locationName = $searchInput.val();\n            var myGeo, marker;\n\n            if(cityName !== ''){\n                if(!locationName || locationName === ''){\n                    map.centerAndZoom(cityName, 11);\n                }\n\n                //地址解析\n                if(locationName && locationName !== ''){\n                    myGeo = new BMap.Geocoder();\n                    // 将地址解析结果显示在地图上,并调整地图视野\n                    myGeo.getPoint(locationName, function(point){\n                        if (point) {\n                            map.centerAndZoom(point, 13);\n                            marker = new BMap.Marker(point);\n                            map.addOverlay(marker);\n                            marker.enableDragging();  //允许拖拽\n                            mapData.markers.push(marker);  //将marker加入到数组中\n                        }else{\n                            // alert('未找到');\n                            map.centerAndZoom(cityName, 11);  //找不到则重新定位到城市\n                        }\n                    }, cityName);\n                }\n            } // if(cityName !== '')\n        };\n\n        // load script 之后的 callback\n        var hasCallback = false;\n        window.baiduMapCallBack = function(){\n            // 避免重复加载\n            if (hasCallback) {\n                return;\n            } else {\n                hasCallback = true;\n            }\n\n            var BMap = window.BMap;\n            if (!mapData.map) {\n                // 创建Map实例\n                mapData.map = new BMap.Map(mapData.mapContainerId);\n            }\n            var map = mapData.map;\n\n            map.centerAndZoom(new BMap.Point(116.404, 39.915), 11);  // 初始化地图,设置中心点坐标和地图级别\n            map.addControl(new BMap.MapTypeControl());   //添加地图类型控件\n            map.setCurrentCity(\"北京\");          // 设置地图显示的城市 此项是必须设置的\n            map.enableScrollWheelZoom(true);     //开启鼠标滚轮缩放\n\n            //根据IP定位\n            function locationFun(result){\n                var cityName = result.name;\n                map.setCenter(cityName);\n\n                // 设置城市名称\n                $cityInput.val(cityName);\n                if (E.placeholder) {\n                    $searchInput.focus();\n                }\n                var timeoutId, searchFn;\n                if (inputKeyup) {\n                   // 并绑定搜索事件 - input 支持 keyup\n                   searchFn = function (e) {\n                       if (e.type === 'keyup' && e.keyCode === 13) {\n                           e.preventDefault();\n                       }\n                       if (timeoutId) {\n                           clearTimeout(timeoutId);\n                       }\n                       timeoutId = setTimeout(mapData.searchMap, 500);\n                   };\n                   $cityInput.on('keyup change paste', searchFn);\n                   $searchInput.on('keyup change paste', searchFn); \n                } else {\n                    // 并绑定搜索事件 - input 不支持 keyup\n                    searchFn = function () {\n                        if (!$content.is(':visible')) {\n                            // panel 不显示了，就不用再监控了\n                            clearTimeout(timeoutId);\n                            return;\n                        }\n\n                        var currentCity = '';\n                        var currentSearch = '';\n                        var city = $cityInput.val();\n                        var search = $searchInput.val();\n\n                        if (city !== currentCity || search !== currentSearch) {\n                            // 刚获取的数据和之前的数据不一致，执行查询\n                            mapData.searchMap();\n                            // 更新数据\n                            currentCity = city;\n                            currentSearch = search;\n                        }\n\n                        // 继续监控\n                        if (timeoutId) {\n                            clearTimeout(timeoutId);\n                        }\n                        timeoutId = setTimeout(searchFn, 1000);\n                    };\n                    // 开始监控\n                    timeoutId = setTimeout(searchFn, 1000);\n                }\n            }\n            var myCity = new BMap.LocalCity();\n            myCity.get(locationFun);\n\n            //鼠标点击，创建位置\n            map.addEventListener(\"click\", function(e){\n                var marker = new BMap.Marker(new BMap.Point(e.point.lng, e.point.lat)); \n                map.addOverlay(marker);  \n                marker.enableDragging();\n                mapData.markers.push(marker);  //加入到数组中\n            }, false);\n        };\n\n        mapData.loadMapScript = function () {\n            var script = document.createElement(\"script\");\n            script.type = \"text/javascript\";\n            script.src = \"https://api.map.baidu.com/api?v=2.0&ak=\" + ak + \"&s=1&callback=baiduMapCallBack\";  // baiduMapCallBack是一个本地函数\n            try {\n                // IE10- 报错\n                document.body.appendChild(script);\n            } catch (ex) {\n                E.error('加载地图过程中发生错误');\n            }\n        };\n\n        // 初始化地图\n        mapData.initMap = function () {\n            if (window.BMap) {\n                // 不是第一次，直接处理地图即可\n                window.baiduMapCallBack();\n            } else {\n                // 第一次，先加载地图 script，再处理地图（script加载完自动执行处理）\n                mapData.loadMapScript();\n            }\n        };\n\n        // ---------- 创建 menu 对象 ----------\n\n        var menu = new E.Menu({\n            editor: editor,\n            id: menuId,\n            title: lang.location\n        });\n\n        editor.menus[menuId] = menu;\n\n        // ---------- 构建UI ----------\n\n        // panel content \n        var $content = $('<div></div>');\n\n        // 搜索框\n        var $inputContainer = $('<div style=\"margin:10px 0;\"></div>');\n        var $cityInput = $('<input type=\"text\"/>');\n        $cityInput.css({\n            width: '80px',\n            'text-align': 'center'\n        });\n        var $searchInput = $('<input type=\"text\"/>');\n        $searchInput.css({\n            width: '300px',\n            'margin-left': '10px'\n        }).attr('placeholder', lang.searchlocation);\n        var $clearBtn = $('<button class=\"right link\">' + lang.clearLocation + '</button>');\n        $inputContainer.append($clearBtn)\n                       .append($cityInput)\n                       .append($searchInput);\n        $content.append($inputContainer);\n\n        // 清除位置按钮\n        $clearBtn.click(function (e) {\n            $searchInput.val('');\n            $searchInput.focus();\n            mapData.clearLocations();\n            e.preventDefault();\n        });\n\n        // 地图\n        var $map = $('<div id=\"' + mapData.mapContainerId + '\"></div>');\n        $map.css({\n            height: '260px',\n            width: '100%',\n            position: 'relative',\n            'margin-top': '10px',\n            border: '1px solid #f1f1f1'\n        });\n        var $mapLoading = $('<span>' + lang.loading + '</span>');\n        $mapLoading.css({\n            position: 'absolute',\n            width: '100px',\n            'text-align': 'center',\n            top: '45%',\n            left: '50%',\n            'margin-left': '-50px'\n        });\n        $map.append($mapLoading);\n        $content.append($map);\n\n        // 按钮\n        var $btnContainer = $('<div style=\"margin:10px 0;\"></div>');\n        var $btnSubmit = $('<button class=\"right\">' + lang.submit + '</button>');\n        var $btnCancel = $('<button class=\"right gray\">' + lang.cancel + '</button>');\n        var $checkLabel = $('<label style=\"display:inline-block;margin-top:10px;color:#666;\"></label>');\n        var $check = $('<input type=\"checkbox\">');\n        $checkLabel.append($check).append('<span style=\"display:inline-block;margin-left:5px;\">  ' + lang.dynamicMap + '</span>');\n        $btnContainer.append($checkLabel)\n                     .append($btnSubmit)\n                     .append($btnCancel);\n        $content.append($btnContainer);\n\n        function callback() {\n            $searchInput.val('');\n        }\n\n        // 『取消』按钮事件\n        $btnCancel.click(function (e) {\n            e.preventDefault();\n            callback();\n            menu.dropPanel.hide();\n        });\n\n        // 『确定』按钮事件\n        $btnSubmit.click(function (e) {\n            e.preventDefault();\n            var map = mapData.map,\n                isDynamic = $check.is(':checked'),\n                markers =  mapData.markers,\n\n                center = map.getCenter(),\n                centerLng = center.lng,\n                centerLat = center.lat,\n\n                zoom = map.getZoom(),\n\n                size = map.getSize(),\n                sizeWidth = size.width,\n                sizeHeight = size.height,\n\n                position,\n                src,\n                iframe;\n\n            if(isDynamic){\n                //动态地址\n                src = 'http://ueditor.baidu.com/ueditor/dialogs/map/show.html#';\n            }else{\n                //静态地址\n                src = 'http://api.map.baidu.com/staticimage?';\n            }\n\n            //src参数\n            src = src +'center=' + centerLng + ',' + centerLat +\n                '&zoom=' + zoom +\n                '&width=' + sizeWidth +\n                '&height=' + sizeHeight;\n            if(markers.length > 0){\n                src = src + '&markers=';\n\n                //添加所有的marker\n                $.each(markers, function(key, value){\n                    position = value.getPosition();\n                    if(key > 0){\n                        src = src + '|';\n                    }\n                    src = src + position.lng + ',' + position.lat;\n                });\n            }\n\n            if(isDynamic){\n                if(markers.length > 1){\n                    alert( lang.langDynamicOneLocation );\n                    return;\n                }\n\n                src += '&markerStyles=l,A';\n\n                //插入iframe\n                iframe = '<iframe class=\"ueditor_baidumap\" src=\"{src}\" frameborder=\"0\" width=\"' + sizeWidth + '\" height=\"' + sizeHeight + '\"></iframe>';\n                iframe = iframe.replace('{src}', src);\n                editor.command(e, 'insertHtml', iframe, callback);\n            }else{\n                //插入图片\n                editor.command(e, 'insertHtml', '<img style=\"max-width:100%;\" src=\"' + src + '\"/>', callback);\n            }\n        });\n\n        // 根据 UI 创建菜单 panel\n        menu.dropPanel = new E.DropPanel(editor, menu, {\n            $content: $content,\n            width: 500\n        });\n\n        // ---------- 事件 ----------\n\n        // render 时执行事件\n        menu.onRender = function () {\n            if (ak === E.baiduMapAk) {\n                E.warn('建议在配置中自定义百度地图的mapAk，否则可能影响地图功能，文档：' + E.docsite);\n            }\n        };\n\n        // click 事件\n        menu.clickEvent = function (e) {\n            var menu = this;\n            var dropPanel = menu.dropPanel;\n            var firstTime = false;\n\n            // -------------隐藏-------------\n            if (dropPanel.isShowing) {\n                dropPanel.hide();\n                return;\n            }\n\n            // -------------显示-------------\n            if (!mapData.map) {\n                // 第一次，先加载地图\n                firstTime = true;\n            }\n            \n            dropPanel.show();\n            mapData.initMap();\n\n            if (!firstTime) {\n                $searchInput.focus();\n            }\n        };\n\n    });\n\n});\n// insertcode 菜单\n_e(function (E, $) {\n\n    // 加载 highlightjs 代码\n    function loadHljs() {\n        if (E.userAgent.indexOf('MSIE 8') > 0) {\n            // 不支持 IE8\n            return;\n        }\n        if (window.hljs) {\n            // 不要重复加载\n            return;\n        }\n        var script = document.createElement(\"script\");\n        script.type = \"text/javascript\";\n        script.src = \"//cdn.bootcss.com/highlight.js/9.2.0/highlight.min.js\";\n        document.body.appendChild(script);\n    }\n    \n\n    E.createMenu(function (check) {\n        var menuId = 'insertcode';\n        if (!check(menuId)) {\n            return;\n        }\n\n        // 加载 highlightjs 代码\n        setTimeout(loadHljs, 0);\n\n        var editor = this;\n        var config = editor.config;\n        var lang = config.lang;\n        var $txt = editor.txt.$txt;\n\n        // 创建 menu 对象\n        var menu = new E.Menu({\n            editor: editor,\n            id: menuId,\n            title: lang.insertcode\n        });\n\n        // click 事件\n        menu.clickEvent = function (e) {\n            var menu = this;\n            var dropPanel = menu.dropPanel;\n\n            // 隐藏\n            if (dropPanel.isShowing) {\n                dropPanel.hide();\n                return;\n            }\n\n            // 显示\n            $textarea.val('');\n            dropPanel.show();\n\n            // highlightjs 语言列表\n            var hljs = window.hljs;\n            if (hljs && hljs.listLanguages) {\n                if ($langSelect.children().length !== 0) {\n                    return;\n                }\n                $langSelect.css({\n                    'margin-top': '9px',\n                    'margin-left': '5px'\n                });\n                $.each(hljs.listLanguages(), function (key, lang) {\n                    if (lang === 'xml') {\n                        lang = 'html';\n                    }\n                    if (lang === config.codeDefaultLang) {\n                        $langSelect.append('<option value=\"' + lang + '\" selected=\"selected\">' + lang + '</option>');\n                    } else {\n                        $langSelect.append('<option value=\"' + lang + '\">' + lang + '</option>');\n                    }\n                });\n            } else {\n                $langSelect.hide();\n            }\n        };\n\n        // 选中状态下的 click 事件\n        menu.clickEventSelected = function (e) {\n            var menu = this;\n            var dropPanel = menu.dropPanel;\n\n            // 隐藏\n            if (dropPanel.isShowing) {\n                dropPanel.hide();\n                return;\n            }\n\n            // 显示\n            dropPanel.show();\n\n            var rangeElem = editor.getRangeElem();\n            var targetElem = editor.getSelfOrParentByName(rangeElem, 'pre');\n            var $targetElem;\n            var className;\n            if (targetElem) {\n                // 确定找到 pre 之后，再找 code\n                targetElem = editor.getSelfOrParentByName(rangeElem, 'code');\n            }\n            if (!targetElem) {\n                return;\n            }\n            $targetElem = $(targetElem);\n\n            // 赋值内容\n            $textarea.val($targetElem.text());\n            if ($langSelect) {\n                // 赋值语言\n                className = $targetElem.attr('class');\n                if (className) {\n                    $langSelect.val(className.split(' ')[0]);\n                }\n            }\n        };\n\n        // 定义更新选中状态的事件\n        menu.updateSelectedEvent = function () {\n            var self = this; //菜单对象\n            var editor = self.editor;\n            var rangeElem;\n\n            rangeElem = editor.getRangeElem();\n            rangeElem = editor.getSelfOrParentByName(rangeElem, 'pre');\n\n            if (rangeElem) {\n                return true;\n            }\n\n            return false;\n        };\n\n        // 创建 panel\n        var $content = $('<div></div>');\n        var $textarea = $('<textarea></textarea>');\n        var $langSelect = $('<select></select>');\n        contentHandle($content);\n        menu.dropPanel = new E.DropPanel(editor, menu, {\n            $content: $content,\n            width: 500\n        });\n\n        // 增加到editor对象中\n        editor.menus[menuId] = menu;\n\n        // ------ 增加 content 内容 ------\n        function contentHandle($content) {\n            // textarea 区域\n            var $textareaContainer = $('<div></div>');\n            $textareaContainer.css({\n                margin: '15px 5px 5px 5px',\n                height: '160px',\n                'text-align': 'center'\n            });\n            $textarea.css({\n                width: '100%',\n                height: '100%',\n                padding: '10px'\n            });\n            $textarea.on('keydown', function (e) {\n                // 取消 tab 键默认行为\n                if (e.keyCode === 9) {\n                    e.preventDefault();\n                }\n            });\n            $textareaContainer.append($textarea);\n            $content.append($textareaContainer);\n\n            // 按钮区域\n            var $btnContainer = $('<div></div>');\n            var $btnSubmit = $('<button class=\"right\">' + lang.submit + '</button>');\n            var $btnCancel = $('<button class=\"right gray\">' + lang.cancel + '</button>');\n\n            $btnContainer.append($btnSubmit).append($btnCancel).append($langSelect);\n            $content.append($btnContainer);\n\n            // 取消按钮\n            $btnCancel.click(function (e) {\n                e.preventDefault();\n                menu.dropPanel.hide();\n            });\n\n            // 确定按钮\n            var codeTpl = '<pre style=\"max-width:100%;overflow-x:auto;\"><code{#langClass}>{#content}</code></pre>';\n            $btnSubmit.click(function (e) {\n                e.preventDefault();\n                var val = $textarea.val();\n                if (!val) {\n                    // 无内容\n                    $textarea.focus();\n                    return;\n                }\n\n                var rangeElem = editor.getRangeElem();\n                if ($.trim($(rangeElem).text()) && codeTpl.indexOf('<p><br></p>') !== 0) {\n                    codeTpl = '<p><br></p>' + codeTpl;\n                }\n\n                var lang = $langSelect ? $langSelect.val() : ''; // 获取高亮语言\n                var langClass = '';\n                var doHightlight = function () {\n                    $txt.find('pre code').each(function (i, block) {\n                        var $block = $(block);\n                        if ($block.attr('codemark')) {\n                            // 有 codemark 标记的代码块，就不再重新格式化了\n                            return;\n                        } else if (window.hljs) {\n                            // 新代码块，格式化之后，立即标记 codemark\n                            window.hljs.highlightBlock(block);\n                            $block.attr('codemark', '1');\n                        }\n                    });\n                };\n\n                // 语言高亮样式\n                if (lang) {\n                    langClass = ' class=\"' + lang + ' hljs\"';\n                }\n\n                // 替换标签\n                val = val.replace(/&/gm, '&amp;')\n                         .replace(/</gm, '&lt;')\n                         .replace(/>/gm, '&gt;');\n\n                // ---- menu 未选中状态 ----\n                if (!menu.selected) {\n                    // 拼接html\n                    var html = codeTpl.replace('{#langClass}', langClass).replace('{#content}', val);\n                    editor.command(e, 'insertHtml', html, doHightlight);\n                    return;\n                }\n\n                // ---- menu 选中状态 ----\n                var targetElem = editor.getSelfOrParentByName(rangeElem, 'pre');\n                var $targetElem;\n                if (targetElem) {\n                    // 确定找到 pre 之后，再找 code\n                    targetElem = editor.getSelfOrParentByName(rangeElem, 'code');\n                }\n                if (!targetElem) {\n                    return;\n                }\n                $targetElem = $(targetElem);\n\n                function commandFn() {\n                    var className;\n                    if (lang) {\n                        className = $targetElem.attr('class');\n                        if (className !== lang + ' hljs') {\n                            $targetElem.attr('class', lang + ' hljs');\n                        }\n                    }\n                    $targetElem.html(val);\n                }\n                function callback() {\n                    editor.restoreSelectionByElem(targetElem);\n                    doHightlight();\n                }\n                editor.customCommand(e, commandFn, callback);\n            });\n        }\n\n        // ------ enter 时，不另起标签，只换行 ------\n        $txt.on('keydown', function (e) {\n            if (e.keyCode !== 13) {\n                return;\n            }\n            var rangeElem = editor.getRangeElem();\n            var targetElem = editor.getSelfOrParentByName(rangeElem, 'code');\n            if (!targetElem) {\n                return;\n            }\n\n            editor.command(e, 'insertHtml', '\\n');\n        });\n\n        // ------ 点击时，禁用其他标签 ------\n        function updateMenu() {\n            var rangeElem = editor.getRangeElem();\n            var targetElem = editor.getSelfOrParentByName(rangeElem, 'code');\n            if (targetElem) {\n                // 在 code 之内，禁用其他菜单\n                editor.disableMenusExcept('insertcode');\n            } else {\n                // 不是在 code 之内，启用其他菜单\n                editor.enableMenusExcept('insertcode');\n            }\n        }\n        $txt.on('keydown click', function (e) {\n            // 此处必须使用 setTimeout 异步处理，否则不对\n            setTimeout(updateMenu);\n        });\n    });\n\n});\n// undo 菜单\n_e(function (E, $) {\n\n    E.createMenu(function (check) {\n        var menuId = 'undo';\n        if (!check(menuId)) {\n            return;\n        }\n        var editor = this;\n        var lang = editor.config.lang;\n\n        // 创建 menu 对象\n        var menu = new E.Menu({\n            editor: editor,\n            id: menuId,\n            title: lang.undo\n        });\n\n        // click 事件\n        menu.clickEvent = function (e) {\n            editor.undo();\n        };\n\n        // 增加到editor对象中\n        editor.menus[menuId] = menu;\n\n\n        // ------------ 初始化时、enter 时、打字中断时，做记录 ------------\n        // ------------ ctrl + z 是调用记录撤销，而不是使用浏览器默认的撤销 ------------\n        editor.ready(function () {\n            var editor = this;\n            var $txt = editor.txt.$txt;\n            var timeoutId;\n\n            // 执行undo记录\n            function undo() {\n                editor.undoRecord();\n            }\n\n            $txt.on('keydown', function (e) {\n                var keyCode = e.keyCode;\n\n                // 撤销 ctrl + z\n                if (e.ctrlKey && keyCode === 90) {\n                    editor.undo();\n                    return;\n                }\n\n                if (keyCode === 13) {\n                    // enter 做记录\n                    undo();\n                } else {\n                    // keyup 之后 1s 之内不操作，则做一次记录\n                    if (timeoutId) {\n                        clearTimeout(timeoutId);\n                    }\n                    timeoutId = setTimeout(undo, 1000);\n                }\n            });\n\n            // 初始化做记录\n            editor.undoRecord();\n        });\n    });\n\n});\n// redo 菜单\n_e(function (E, $) {\n\n    E.createMenu(function (check) {\n        var menuId = 'redo';\n        if (!check(menuId)) {\n            return;\n        }\n        var editor = this;\n        var lang = editor.config.lang;\n\n        // 创建 menu 对象\n        var menu = new E.Menu({\n            editor: editor,\n            id: menuId,\n            title: lang.redo\n        });\n\n        // click 事件\n        menu.clickEvent = function (e) {\n            editor.redo();\n        };\n\n        // 增加到editor对象中\n        editor.menus[menuId] = menu;\n    });\n\n});\n// 全屏 菜单\n_e(function (E, $) {\n\n    // 记录全屏时的scrollTop\n    var scrollTopWhenFullScreen;\n\n    E.createMenu(function (check) {\n        var menuId = 'fullscreen';\n        if (!check(menuId)) {\n            return;\n        }\n        var editor = this;\n        var $txt = editor.txt.$txt;\n        var config = editor.config;\n        var zIndexConfig = config.zindex || 10000;\n        var lang = config.lang;\n\n        var isSelected = false;\n        var zIndex;\n\n        var maxHeight;\n\n        // 创建 menu 对象\n        var menu = new E.Menu({\n            editor: editor,\n            id: menuId,\n            title: lang.fullscreen\n        });\n\n        // 定义click事件\n        menu.clickEvent = function (e) {\n            // 增加样式\n            var $editorContainer = editor.$editorContainer;\n            $editorContainer.addClass('wangEditor-fullscreen');\n\n            // （先保存当前的）再设置z-index\n            zIndex = $editorContainer.css('z-index');\n            $editorContainer.css('z-index', zIndexConfig);\n\n            var $wrapper;\n            var txtHeight = $txt.height();\n            var txtOuterHeight = $txt.outerHeight();\n\n            if (editor.useMaxHeight) {\n                // 记录 max-height，并暂时去掉maxheight\n                maxHeight = $txt.css('max-height');\n                $txt.css('max-height', 'none');\n\n                // 如果使用了maxHeight， 将$txt从它的父元素中移出来\n                $wrapper = $txt.parent();\n                $wrapper.after($txt);\n                $wrapper.remove();\n                $txt.css('overflow-y', 'auto');\n            }\n\n            // 设置高度到全屏\n            var menuContainer = editor.menuContainer;\n            $txt.height(\n                E.$window.height() - \n                menuContainer.height() - \n                (txtOuterHeight - txtHeight)  // 去掉内边距和外边距\n            );\n\n            // 取消menuContainer的内联样式（menu吸顶时，会为 menuContainer 设置一些内联样式）\n            editor.menuContainer.$menuContainer.attr('style', '');\n\n            // 保存状态\n            isSelected = true;\n\n            // 记录编辑器是否全屏\n            editor.isFullScreen = true;\n\n            // 记录设置全屏时的高度\n            scrollTopWhenFullScreen = E.$window.scrollTop();\n        };\n\n        // 定义选中状态的 click 事件\n        menu.clickEventSelected = function (e) {\n            // 取消样式\n            var $editorContainer = editor.$editorContainer;\n            $editorContainer.removeClass('wangEditor-fullscreen');\n            $editorContainer.css('z-index', zIndex);\n\n            // 还原height\n            if (editor.useMaxHeight) {\n                $txt.css('max-height', maxHeight);\n            } else {\n                // editor.valueContainerHeight 在 editor.txt.initHeight() 中事先保存了\n                editor.$valueContainer.css('height', editor.valueContainerHeight);\n            }\n\n            // 重新计算高度\n            editor.txt.initHeight();\n\n            // 保存状态\n            isSelected = false;\n\n            // 记录编辑器是否全屏\n            editor.isFullScreen = false;\n\n            // 还原scrollTop\n            if (scrollTopWhenFullScreen != null) {\n                E.$window.scrollTop(scrollTopWhenFullScreen);\n            }\n        };\n\n        // 定义选中事件\n        menu.updateSelectedEvent = function (e) {\n            return isSelected;\n        };\n\n        // 增加到editor对象中\n        editor.menus[menuId] = menu;\n    });\n\n});\n// 渲染menus\n_e(function (E, $) {\n\n    E.fn.renderMenus = function () {\n\n        var editor = this;\n        var menus = editor.menus;\n        var menuIds = editor.config.menus;\n        var menuContainer = editor.menuContainer;\n\n        var menu;\n        var groupIdx = 0;\n        $.each(menuIds, function (k, v) {\n            if (v === '|') {\n                groupIdx++;\n                return;\n            }\n\n            menu = menus[v];\n            if (menu) {\n                menu.render(groupIdx);\n            }\n        });\n    };\n\n});\n// 渲染menus\n_e(function (E, $) {\n\n    E.fn.renderMenuContainer = function () {\n\n        var editor = this;\n        var menuContainer = editor.menuContainer;\n        var $editorContainer = editor.$editorContainer;\n\n        menuContainer.render();\n\n    };\n\n});\n// 渲染 txt\n_e(function (E, $) {\n\n    E.fn.renderTxt = function () {\n\n        var editor = this;\n        var txt = editor.txt;\n\n        txt.render();\n\n        // ready 时候，计算txt的高度\n        editor.ready(function () {\n            txt.initHeight();\n        });\n    };\n\n});\n// 渲染 container\n_e(function (E, $) {\n\n    E.fn.renderEditorContainer = function () {\n\n        var editor = this;\n        var $valueContainer = editor.$valueContainer;\n        var $editorContainer = editor.$editorContainer;\n        var $txt = editor.txt.$txt;\n        var $prev, $parent;\n\n        // 将编辑器渲染到页面中\n        if ($valueContainer === $txt) {\n            $prev = editor.$prev;\n            $parent = editor.$parent;\n\n            if ($prev && $prev.length) {\n                // 有前置节点，就插入到前置节点的后面\n                $prev.after($editorContainer);\n            } else {\n                // 没有前置节点，就直接插入到父元素\n                $parent.prepend($editorContainer);\n            }\n\n        } else {\n            $valueContainer.after($editorContainer);\n            $valueContainer.hide();\n        }\n\n        // 设置宽度（这样设置宽度有问题）\n        // $editorContainer.css('width', $valueContainer.css('width'));\n    };\n\n});\n// 菜单事件\n_e(function (E, $) {\n\n    // 绑定每个菜单的click事件\n    E.fn.eventMenus = function () {\n\n        var menus = this.menus;\n\n        // 绑定菜单的点击事件\n        $.each(menus, function (k, v) {\n            v.bindEvent();\n        });\n\n    };\n\n});\n// 菜单container事件\n_e(function (E, $) {\n\n    E.fn.eventMenuContainer = function () {\n\n    };\n\n});\n// 编辑区域事件\n_e(function (E, $) {\n\n    E.fn.eventTxt = function () {\n\n        var txt = this.txt;\n\n        // txt内容变化时，保存选区\n        txt.saveSelectionEvent();\n\n        // txt内容变化时，随时更新 value\n        txt.updateValueEvent();\n\n        // txt内容变化时，随时更新 menu style\n        txt.updateMenuStyleEvent();\n\n        // // 鼠标hover时，显示 p head 高度（暂时关闭这个功能）\n        // if (!/ie/i.test(E.userAgent)) {\n        //     // 暂时不支持IE\n        //     txt.showHeightOnHover();\n        // }\n    };\n\n});\n// 上传图片事件\n_e(function (E, $) {\n\n    E.plugin(function () {\n        var editor = this;\n        var fns = editor.config.uploadImgFns; // editor.config.uploadImgFns = {} 在config文件中定义了\n\n        // -------- 定义load函数 --------\n        fns.onload || (fns.onload = function (resultText, xhr) {\n            E.log('上传结束，返回结果为 ' + resultText);\n\n            var editor = this;\n            var originalName = editor.uploadImgOriginalName || '';  // 上传图片时，已经将图片的名字存在 editor.uploadImgOriginalName\n            var img;\n            if (resultText.indexOf('error|') === 0) {\n                // 提示错误\n                E.warn('上传失败：' + resultText.split('|')[1]);\n                alert(resultText.split('|')[1]);\n            } else {\n                E.log('上传成功，即将插入编辑区域，结果为：' + resultText);\n\n                // 将结果插入编辑器\n                img = document.createElement('img');\n                img.onload = function () {\n                    var html = '<img src=\"' + resultText + '\" alt=\"' + originalName + '\" style=\"max-width:100%;\"/>';\n                    editor.command(null, 'insertHtml', html);\n\n                    E.log('已插入图片，地址 ' + resultText);\n                    img = null;\n                };\n                img.onerror = function () {\n                    E.error('使用返回的结果获取图片，发生错误。请确认以下结果是否正确：' + resultText);\n                    img = null;\n                };\n                img.src = resultText;\n            }\n\n        });\n\n        // -------- 定义tiemout函数 --------\n        fns.ontimeout || (fns.ontimeout = function (xhr) {\n            E.error('上传图片超时');\n            alert('上传图片超时');\n        });\n\n        // -------- 定义error函数 --------\n        fns.onerror || (fns.onerror = function (xhr) {\n            E.error('上传上图片发生错误');\n            alert('上传上图片发生错误');\n        });\n\n    });\n});\n// xhr 上传图片\n_e(function (E, $) {\n\n    if (!window.FileReader || !window.FormData) {\n        // 如果不支持html5的文档操作，直接返回\n        return;\n    }\n\n    E.plugin(function () {\n\n        var editor = this;\n        var config = editor.config;\n        var uploadImgUrl = config.uploadImgUrl;\n        var uploadTimeout = config.uploadTimeout;\n\n        // 获取配置中的上传事件\n        var uploadImgFns = config.uploadImgFns;\n        var onload = uploadImgFns.onload;\n        var ontimeout = uploadImgFns.ontimeout;\n        var onerror = uploadImgFns.onerror;\n\n        if (!uploadImgUrl) {\n            return;\n        }\n\n        // -------- 将以base64的图片url数据转换为Blob --------\n        function convertBase64UrlToBlob(urlData, filetype){\n            //去掉url的头，并转换为byte\n            var bytes = window.atob(urlData.split(',')[1]);\n            \n            //处理异常,将ascii码小于0的转换为大于0\n            var ab = new ArrayBuffer(bytes.length);\n            var ia = new Uint8Array(ab);\n            var i;\n            for (i = 0; i < bytes.length; i++) {\n                ia[i] = bytes.charCodeAt(i);\n            }\n\n            return new Blob([ab], {type : filetype});\n        }\n\n        // -------- 插入图片的方法 --------\n        function insertImg(src, event) {\n            var img = document.createElement('img');\n            img.onload = function () {\n                var html = '<img src=\"' + src + '\" style=\"max-width:100%;\"/>';\n                editor.command(event, 'insertHtml', html);\n\n                E.log('已插入图片，地址 ' + src);\n                img = null;\n            };\n            img.onerror = function () {\n                E.error('使用返回的结果获取图片，发生错误。请确认以下结果是否正确：' + src);\n                img = null;\n            };\n            img.src = src;\n        }\n\n        // -------- onprogress 事件 --------\n        function updateProgress(e) {\n            if (e.lengthComputable) {\n                var percentComplete = e.loaded / e.total;\n                editor.showUploadProgress(percentComplete * 100);\n            }\n        }\n\n        // -------- xhr 上传图片 --------\n        editor.xhrUploadImg = function (opt) {\n            // opt 数据\n            var event = opt.event;\n            var fileName = opt.filename || '';\n            var base64 = opt.base64;\n            var fileType = opt.fileType || 'image/png'; // 无扩展名则默认使用 png\n            var name = opt.name || 'wangEditor_upload_file';\n            var loadfn = opt.loadfn || onload;\n            var errorfn = opt.errorfn || onerror;\n            var timeoutfn = opt.timeoutfn || ontimeout;\n\n            // 上传参数（如 token）\n            var params = editor.config.uploadParams || {};\n\n            // headers\n            var headers = editor.config.uploadHeaders || {};\n\n            // 获取文件扩展名\n            var fileExt = 'png';  // 默认为 png\n            if (fileName.indexOf('.') > 0) {\n                // 原来的文件名有扩展名\n                fileExt = fileName.slice(fileName.lastIndexOf('.') - fileName.length + 1);\n            } else if (fileType.indexOf('/') > 0 && fileType.split('/')[1]) {\n                // 文件名没有扩展名，通过类型获取，如从 'image/png' 取 'png'\n                fileExt = fileType.split('/')[1];\n            }\n\n            // ------------ begin 预览模拟上传 ------------\n            if (E.isOnWebsite) {\n                E.log('预览模拟上传');\n                insertImg(base64, event);\n                return;\n            }\n            // ------------ end 预览模拟上传 ------------\n\n            // 变量声明\n            var xhr = new XMLHttpRequest();\n            var timeoutId;\n            var src;\n            var formData = new FormData();\n\n            // 超时处理\n            function timeoutCallback() {\n                if (timeoutId) {\n                    clearTimeout(timeoutId);\n                }\n                if (xhr && xhr.abort) {\n                    xhr.abort();\n                }\n\n                // 超时了就阻止默认行为\n                event.preventDefault();\n\n                // 执行回调函数，提示什么内容，都应该在回调函数中定义\n                timeoutfn && timeoutfn.call(editor, xhr);\n\n                // 隐藏进度条\n                editor.hideUploadProgress();\n            }\n\n            xhr.onload = function () {\n                if (timeoutId) {\n                    clearTimeout(timeoutId);\n                }\n\n                // 记录文件名到 editor.uploadImgOriginalName ，插入图片时，可做 alt 属性用\n                editor.uploadImgOriginalName = fileName;\n                if (fileName.indexOf('.') > 0) {\n                    editor.uploadImgOriginalName = fileName.split('.')[0];\n                }\n\n                // 执行load函数，任何操作，都应该在load函数中定义\n                loadfn && loadfn.call(editor, xhr.responseText, xhr);\n\n                // 隐藏进度条\n                editor.hideUploadProgress();\n            };\n            xhr.onerror = function () {\n                if (timeoutId) {\n                    clearTimeout(timeoutId);\n                }\n\n                // 超时了就阻止默认行为\n                event.preventDefault();\n\n                // 执行error函数，错误提示，应该在error函数中定义\n                errorfn && errorfn.call(editor, xhr);\n\n                // 隐藏进度条\n                editor.hideUploadProgress();\n            };\n            // xhr.onprogress = updateProgress;\n            xhr.upload.onprogress = updateProgress;\n\n            // 填充数据\n            formData.append(name, convertBase64UrlToBlob(base64, fileType), E.random() + '.' + fileExt);\n\n            // 添加参数\n            $.each(params, function (key, value) {\n                formData.append(key, value);\n            });\n\n            // 开始上传\n            xhr.open('POST', uploadImgUrl, true);\n            // xhr.setRequestHeader(\"Content-type\",\"application/x-www-form-urlencoded\");  // 将参数解析成传统form的方式上传\n\n            // 修改自定义配置的headers\n            $.each(headers, function (key, value) {\n                xhr.setRequestHeader(key, value);\n            });\n\n            // 跨域上传时，传cookie\n            xhr.withCredentials = editor.config.withCredentials || true;\n\n            // 发送数据\n            xhr.send(formData);\n            timeoutId = setTimeout(timeoutCallback, uploadTimeout);\n\n            E.log('开始上传...并开始超时计算');\n        };\n    });\n});\n// 进度条\n_e(function (E, $) {\n\n    E.plugin(function () {\n\n        var editor = this;\n        var menuContainer = editor.menuContainer;\n        var menuHeight = menuContainer.height();\n        var $editorContainer = editor.$editorContainer;\n        var width = $editorContainer.width();\n        var $progress = $('<div class=\"wangEditor-upload-progress\"></div>');\n\n        // 渲染事件\n        var isRender = false;\n        function render() {\n            if (isRender) {\n                return;\n            }\n            isRender = true;\n\n            $progress.css({\n                top: menuHeight + 'px'\n            });\n            $editorContainer.append($progress);\n        }\n\n        // ------ 显示进度 ------\n        editor.showUploadProgress = function (progress) {\n            if (timeoutId) {\n                clearTimeout(timeoutId);\n            }\n\n            // 显示之前，先判断是否渲染\n            render();\n\n            $progress.show();\n            $progress.width(progress * width / 100);\n        };\n\n        // ------ 隐藏进度条 ------\n        var timeoutId;\n        function hideProgress() {\n            $progress.hide();\n            timeoutId = null;\n        }\n        editor.hideUploadProgress = function (time) {\n            if (timeoutId) {\n                clearTimeout(timeoutId);\n            }\n            time = time || 750;\n            timeoutId = setTimeout(hideProgress, time);\n        };\n    });\n});\n// upload img 插件\n_e(function (E, $) {\n\n    E.plugin(function () {\n        var editor = this;\n        var config = editor.config;\n        var uploadImgUrl = config.uploadImgUrl;\n        var uploadTimeout = config.uploadTimeout;\n        var event;\n\n        if (!uploadImgUrl) {\n            return;\n        }\n\n        // 获取editor的上传dom\n        var $uploadContent = editor.$uploadContent;\n        if (!$uploadContent) {\n            return;\n        }\n\n        // 自定义UI，并添加到上传dom节点上\n        var $uploadIcon = $('<div class=\"upload-icon-container\"><i class=\"wangeditor-menu-img-upload\"></i></div>');\n        $uploadContent.append($uploadIcon);\n\n        // ---------- 构建上传对象 ----------\n        var upfile = new E.UploadFile({\n            editor: editor,\n            uploadUrl: uploadImgUrl,\n            timeout: uploadTimeout,\n            fileAccept: 'image/jpg,image/jpeg,image/png,image/gif,image/bmp'    // 只允许选择图片 \n        });\n\n        // 选择本地文件，上传\n        $uploadIcon.click(function (e) {\n            event = e;\n            upfile.selectFiles();\n        });\n    });\n});\n// h5 方式上传图片\n_e(function (E, $) {\n\n    if (!window.FileReader || !window.FormData) {\n        // 如果不支持html5的文档操作，直接返回\n        return;\n    }\n\n    // 构造函数\n    var UploadFile = function (opt) {\n        this.editor = opt.editor;\n        this.uploadUrl = opt.uploadUrl;\n        this.timeout = opt.timeout;\n        this.fileAccept = opt.fileAccept;\n        this.multiple = true;\n    };\n\n    UploadFile.fn = UploadFile.prototype;\n\n    // clear\n    UploadFile.fn.clear = function () {\n        this.$input.val('');\n        E.log('input value 已清空');\n    };\n\n    // 渲染\n    UploadFile.fn.render = function () {\n        var self = this;\n        if (self._hasRender) {\n            // 不要重复渲染\n            return;\n        }\n\n        E.log('渲染dom');\n\n        var fileAccept = self.fileAccept;\n        var acceptTpl = fileAccept ? 'accept=\"' + fileAccept + '\"' : '';\n        var multiple = self.multiple;\n        var multipleTpl = multiple ? 'multiple=\"multiple\"' : '';\n        var $input = $('<input type=\"file\" ' + acceptTpl + ' ' + multipleTpl + '/>');\n        var $container = $('<div style=\"display:none;\"></div>');\n\n        $container.append($input);\n        E.$body.append($container);\n\n        // onchange 事件\n        $input.on('change', function (e) {\n            self.selected(e, $input.get(0));\n        });\n\n        // 记录对象数据\n        self.$input = $input;\n\n        // 记录\n        self._hasRender = true;\n    };\n\n    // 选择\n    UploadFile.fn.selectFiles = function () {\n        var self = this;\n\n        E.log('使用 html5 方式上传');\n\n        // 先渲染\n        self.render();\n\n        // 选择\n        E.log('选择文件');\n        self.$input.click();\n    };\n\n    // 选中文件之后\n    UploadFile.fn.selected = function (e, input) {\n        var self = this;\n        var files = input.files || [];\n        if (files.length === 0) {\n            return;\n        }\n\n        E.log('选中 ' + files.length + ' 个文件');\n\n        // 遍历选中的文件，预览、上传\n        $.each(files, function (key, value) {\n            self.upload(value);\n        });\n    };\n\n    // 上传单个文件\n    UploadFile.fn.upload = function (file) {\n        var self = this;\n        var editor = self.editor;\n        var filename = file.name || '';\n        var fileType = file.type || '';\n        var uploadImgFns = editor.config.uploadImgFns;\n        var uploadFileName = editor.config.uploadImgFileName || 'wangEditorH5File';\n        var onload = uploadImgFns.onload;\n        var ontimeout = uploadImgFns.ontimeout;\n        var onerror = uploadImgFns.onerror;\n        var reader = new FileReader();\n\n        if (!onload || !ontimeout || !onerror) {\n            E.error('请为编辑器配置上传图片的 onload ontimeout onerror 回调事件');\n            return;\n        }\n\n\n        E.log('开始执行 ' + filename + ' 文件的上传');\n\n        // 清空 input 数据\n        function clearInput() {\n            self.clear();\n        }\n\n        // onload事件\n        reader.onload = function (e) {\n            E.log('已读取' + filename + '文件');\n\n            var base64 = e.target.result || this.result;\n            editor.xhrUploadImg({\n                event: e,\n                filename: filename,\n                base64: base64,\n                fileType: fileType,\n                name: uploadFileName,\n                loadfn: function (resultText, xhr) {\n                    clearInput();\n                    // 执行配置中的方法\n                    var editor = this;\n                    onload.call(editor, resultText, xhr);\n                },\n                errorfn: function (xhr) {\n                    clearInput();\n                    if (E.isOnWebsite) {\n                        alert('wangEditor官网暂时没有服务端，因此报错。实际项目中不会发生');\n                    }\n                    // 执行配置中的方法\n                    var editor = this;\n                    onerror.call(editor, xhr);\n                },\n                timeoutfn: function (xhr) {\n                    clearInput();\n                    if (E.isOnWebsite) {\n                        alert('wangEditor官网暂时没有服务端，因此超时。实际项目中不会发生');\n                    }\n                    // 执行配置中的方法\n                    var editor = this;\n                    ontimeout(editor, xhr);\n                }\n            });\n        };\n\n        // 开始取文件\n        reader.readAsDataURL(file);\n    };\n\n    // 暴露给 E\n    E.UploadFile = UploadFile;\n\n});\n// form方式上传图片\n_e(function (E, $) {\n\n    if (window.FileReader && window.FormData) {\n        // 如果支持 html5 上传，则返回\n        return;\n    }\n    \n    // 构造函数\n    var UploadFile = function (opt) {\n        this.editor = opt.editor;\n        this.uploadUrl = opt.uploadUrl;\n        this.timeout = opt.timeout;\n        this.fileAccept = opt.fileAccept;\n        this.multiple = false;\n    };\n\n    UploadFile.fn = UploadFile.prototype;\n\n    // clear\n    UploadFile.fn.clear = function () {\n        this.$input.val('');\n        E.log('input value 已清空');\n    };\n\n    // 隐藏modal\n    UploadFile.fn.hideModal = function () {\n        this.modal.hide();\n    };\n\n    // 渲染\n    UploadFile.fn.render = function () {\n        var self = this;\n        var editor = self.editor;\n        var uploadFileName = editor.config.uploadImgFileName || 'wangEditorFormFile';\n        if (self._hasRender) {\n            // 不要重复渲染\n            return;\n        }\n\n        // 服务器端路径\n        var uploadUrl = self.uploadUrl;\n\n        E.log('渲染dom');\n\n        // 创建 form 和 iframe\n        var iframeId = 'iframe' + E.random();\n        var $iframe = $('<iframe name=\"' + iframeId + '\" id=\"' + iframeId + '\" frameborder=\"0\" width=\"0\" height=\"0\"></iframe>');\n        var multiple = self.multiple;\n        var multipleTpl = multiple ? 'multiple=\"multiple\"' : '';\n        var $p = $('<p>选择图片并上传</p>');\n        var $input = $('<input type=\"file\" ' + multipleTpl + ' name=\"' + uploadFileName + '\"/>');\n        var $btn = $('<input type=\"submit\" value=\"上传\"/>');\n        var $form = $('<form enctype=\"multipart/form-data\" method=\"post\" action=\"' + uploadUrl + '\" target=\"' + iframeId + '\"></form>');\n        var $container = $('<div style=\"margin:10px 20px;\"></div>');\n\n        $form.append($p).append($input).append($btn);\n\n        // 增加用户配置的参数，如 token\n        $.each(editor.config.uploadParams, function (key, value) {\n            $form.append( $('<input type=\"hidden\" name=\"' + key + '\" value=\"' + value + '\"/>') );\n        });\n\n        $container.append($form);\n        $container.append($iframe);\n\n        self.$input = $input;\n        self.$iframe = $iframe;\n\n        // 生成 modal\n        var modal = new E.Modal(editor, undefined, {\n            $content: $container\n        });\n        self.modal = modal;\n\n        // 记录\n        self._hasRender = true;\n    };\n\n    // 绑定 iframe load 事件\n    UploadFile.fn.bindLoadEvent = function () {\n        var self = this;\n        if (self._hasBindLoad) {\n            // 不要重复绑定\n            return;\n        }\n\n        var editor = self.editor;\n        var $iframe = self.$iframe;\n        var iframe = $iframe.get(0);\n        var iframeWindow = iframe.contentWindow;\n        var onload = editor.config.uploadImgFns.onload;\n\n        // 定义load事件\n        function onloadFn() {\n            var resultText = $.trim(iframeWindow.document.body.innerHTML);\n            if (!resultText) {\n                return;\n            }\n\n            // 获取文件名\n            var fileFullName = self.$input.val();  // 结果如 C:\\folder\\abc.png 格式\n            var fileOriginalName = fileFullName;\n            if (fileFullName.lastIndexOf('\\\\') >= 0) {\n                // 获取 abc.png 格式\n                fileOriginalName = fileFullName.slice(fileFullName.lastIndexOf('\\\\') + 1);\n                if (fileOriginalName.indexOf('.') > 0) {\n                    // 获取 abc （即不带扩展名的文件名）\n                    fileOriginalName = fileOriginalName.split('.')[0];\n                }\n            }\n\n            // 将文件名暂存到 editor.uploadImgOriginalName ，插入图片时，可作为 alt 属性来用\n            editor.uploadImgOriginalName = fileOriginalName;\n\n            // 执行load函数，插入图片的操作，应该在load函数中执行\n            onload.call(editor, resultText);\n\n            // 清空 input 数据\n            self.clear();\n\n            // 隐藏modal\n            self.hideModal();\n        }\n\n        // 绑定 load 事件\n        if (iframe.attachEvent) {\n            iframe.attachEvent('onload', onloadFn);\n        } else {\n            iframe.onload = onloadFn;\n        }\n\n        // 记录\n        self._hasBindLoad = true;\n    };\n\n    UploadFile.fn.show = function () {\n        var self = this;\n        var modal = self.modal;\n\n        function show() {\n            modal.show();\n            self.bindLoadEvent();\n        }\n        setTimeout(show);\n    };\n\n    // 选择\n    UploadFile.fn.selectFiles = function () {\n        var self = this;\n\n        E.log('使用 form 方式上传');\n\n        // 先渲染\n        self.render();\n\n        // 先清空\n        self.clear();\n\n        // 显示\n        self.show();\n    };\n\n    // 暴露给 E\n    E.UploadFile = UploadFile;\n\n});\n// upload img 插件 粘贴图片\n_e(function (E, $) {\n    \n    E.plugin(function () {\n        var editor = this;\n        var txt = editor.txt;\n        var $txt = txt.$txt;\n        var config = editor.config;\n        var uploadImgUrl = config.uploadImgUrl;\n        var uploadFileName = config.uploadImgFileName || 'wangEditorPasteFile';\n        var pasteEvent;\n        var $imgsBeforePaste;\n\n        // 未配置上传图片url，则忽略\n        if (!uploadImgUrl) {\n            return;\n        }\n\n        // -------- 非 chrome 下，通过查找粘贴的图片的方式上传 --------\n        function findPasteImgAndUpload() {\n            var reg = /^data:(image\\/\\w+);base64/;\n            var $imgs = $txt.find('img');\n\n            E.log('粘贴后，检查到编辑器有' + $imgs.length + '个图片。开始遍历图片，试图找到刚刚粘贴过来的图片');\n\n            $.each($imgs, function () {\n                var img = this;\n                var $img = $(img);\n                var flag;\n                var base64 = $img.attr('src');\n                var type;\n\n                // 判断当前图片是否是粘贴之前的\n                $imgsBeforePaste.each(function () {\n                    if (img === this) {\n                        // 当前图片是粘贴之前的\n                        flag = true;\n                        return false;\n                    }\n                });\n\n                // 当前图片是粘贴之前的，则忽略\n                if (flag) {\n                    return;\n                }\n\n                E.log('找到一个粘贴过来的图片');\n\n                if (reg.test(base64)) {\n                    // 得到的粘贴的图片是 base64 格式，符合要求\n                    E.log('src 是 base64 格式，可以上传');\n                    type = base64.match(reg)[1];\n                    editor.xhrUploadImg({\n                        event: pasteEvent,\n                        base64: base64,\n                        fileType: type,\n                        name: uploadFileName\n                    });\n                } else {\n                    E.log('src 为 ' + base64 + ' ，不是 base64 格式，暂时不支持上传');\n                }\n\n                // 最终移除原图片\n                $img.remove();\n            });\n\n            E.log('遍历结束');\n        }\n\n        // 开始监控粘贴事件\n        $txt.on('paste', function (e) {\n            pasteEvent = e;\n            var data = pasteEvent.clipboardData || pasteEvent.originalEvent.clipboardData;\n            var text;\n            var items;\n\n            // -------- 试图获取剪切板中的文字，有文字的情况下，就不处理图片粘贴 --------\n            if (data == null) {\n                text = window.clipboardData && window.clipboardData.getData('text');\n            } else {\n                text = data.getData('text/plain') || data.getData('text/html');\n            }\n            if (text) {\n                return;\n            }\n\n            items = data && data.items;\n            if (items) {\n                // -------- chrome 可以用 data.items 取出图片 -----\n                E.log('通过 data.items 得到了数据');\n\n                $.each(items, function (key, value) {\n                    var fileType = value.type || '';\n                    if(fileType.indexOf('image') < 0) {\n                        // 不是图片\n                        return;\n                    }\n\n                    var file = value.getAsFile();\n                    var reader = new FileReader();\n\n                    E.log('得到一个粘贴图片');\n\n                    reader.onload = function (e) {\n                        E.log('读取到粘贴的图片');\n\n                        // 执行上传\n                        var base64 = e.target.result || this.result;\n                        editor.xhrUploadImg({\n                            event: pasteEvent,\n                            base64: base64,\n                            fileType: fileType,\n                            name: uploadFileName\n                        });\n                    };\n\n                    //读取粘贴的文件\n                    reader.readAsDataURL(file);\n                });\n            } else {\n                // -------- 非 chrome 不能用 data.items 取图片 -----\n\n                E.log('未从 data.items 得到数据，使用检测粘贴图片的方式');\n\n                // 获取\n                $imgsBeforePaste = $txt.find('img');\n                E.log('粘贴前，检查到编辑器有' + $imgsBeforePaste.length + '个图片');\n\n                // 异步上传找到的图片\n                setTimeout(findPasteImgAndUpload, 0);\n            }\n        });\n\n    });\n});\n// 拖拽上传图片 插件 \n_e(function (E, $) {\n\n    E.plugin(function () {\n\n        var editor = this;\n        var txt = editor.txt;\n        var $txt = txt.$txt;\n        var config = editor.config;\n        var uploadImgUrl = config.uploadImgUrl;\n        var uploadFileName = config.uploadImgFileName || 'wangEditorDragFile';\n\n        // 未配置上传图片url，则忽略\n        if (!uploadImgUrl) {\n            return;\n        }\n\n        // 阻止浏览器默认行为\n        E.$document.on('dragleave drop dragenter dragover', function (e) {\n            e.preventDefault();\n        });\n\n        // 监控 $txt drop 事件\n        $txt.on('drop', function (dragEvent) {\n            dragEvent.preventDefault();\n\n            var originalEvent = dragEvent.originalEvent;\n            var files = originalEvent.dataTransfer && originalEvent.dataTransfer.files;\n\n            if (!files || !files.length) {\n                return;\n            }\n\n            $.each(files, function (k, file) {\n                var type = file.type;\n                var name = file.name;\n\n                if (type.indexOf('image/') < 0) {\n                    // 只接收图片\n                    return;\n                }\n\n                E.log('得到图片 ' + name);\n\n                var reader = new FileReader();\n                reader.onload = function (e) {\n                    E.log('读取到图片 ' + name);\n\n                    // 执行上传\n                    var base64 = e.target.result || this.result;\n                    editor.xhrUploadImg({\n                        event: dragEvent,\n                        base64: base64,\n                        fileType: type,\n                        name: uploadFileName\n                    });\n                };\n\n                //读取粘贴的文件\n                reader.readAsDataURL(file);\n\n            });\n        });\n    });\n\n});\n// 编辑器区域 table toolbar\n_e(function (E, $) {\n\n    E.plugin(function () {\n        var editor = this;\n        var txt = editor.txt;\n        var $txt = txt.$txt;\n        var html = '';\n        // 说明：设置了 max-height 之后，$txt.parent() 负责滚动处理\n        var $currentTxt = editor.useMaxHeight ? $txt.parent() : $txt;\n        var $currentTable;\n\n        // 用到的dom节点\n        var isRendered = false;\n        var $toolbar = $('<div class=\"txt-toolbar\"></div>');\n        var $triangle = $('<div class=\"tip-triangle\"></div>');\n        var $delete = $('<a href=\"#\"><i class=\"wangeditor-menu-img-trash-o\"></i></a>');\n        var $zoomSmall = $('<a href=\"#\"><i class=\"wangeditor-menu-img-search-minus\"></i></a>');\n        var $zoomBig = $('<a href=\"#\"><i class=\"wangeditor-menu-img-search-plus\"></i></a>');\n\n        // 渲染到页面\n        function render() {\n            if (isRendered) {\n                return;\n            }\n            \n            // 绑定事件\n            bindEvent();\n\n            // 拼接 渲染到页面上\n            $toolbar.append($triangle)\n                    .append($delete)\n                    .append($zoomSmall)\n                    .append($zoomBig);\n            editor.$editorContainer.append($toolbar);\n            isRendered = true;\n        }\n\n        // 绑定事件\n        function bindEvent() {\n            // 统一执行命令的方法\n            var commandFn;\n            function command(e, callback) {\n                // 执行命令之前，先存储html内容\n                html = $txt.html();\n                // 监控内容变化\n                var cb = function  () {\n                    if (callback) {\n                        callback();\n                    }\n                    if (html !== $txt.html()) {\n                        $txt.change();\n                    }\n                };\n                // 执行命令\n                if (commandFn) {\n                    editor.customCommand(e, commandFn, cb);\n                }\n            }\n\n            // 删除\n            $delete.click(function (e) {\n                commandFn = function () {\n                    $currentTable.remove();\n                };\n                command(e, function () {\n                    setTimeout(hide, 100);\n                });\n            });\n\n            // 放大\n            $zoomBig.click(function (e) {\n                commandFn = function () {\n                    $currentTable.css({\n                        width: '100%'\n                    });\n                };\n                command(e, function () {\n                    setTimeout(show);\n                });\n            });\n\n            // 缩小\n            $zoomSmall.click(function (e) {\n                commandFn = function () {\n                    $currentTable.css({\n                        width: 'auto'\n                    });\n                };\n                command(e, function () {\n                    setTimeout(show);\n                });\n            });\n        }\n\n        // 显示 toolbar\n        function show() {\n            if (editor._disabled) {\n                // 编辑器已经被禁用，则不让显示\n                return;\n            }\n            if ($currentTable == null) {\n                return;\n            }\n            $currentTable.addClass('clicked');\n            var tablePosition = $currentTable.position();\n            var tableTop = tablePosition.top;\n            var tableLeft = tablePosition.left;\n            var tableHeight = $currentTable.outerHeight();\n            var tableWidth = $currentTable.outerWidth();\n\n            // --- 定位 toolbar ---\n\n            // 计算初步结果\n            var top = tableTop + tableHeight;\n            var left = tableLeft;\n            var marginLeft = 0;\n\n            var txtTop = $currentTxt.position().top;\n            var txtHeight = $currentTxt.outerHeight();\n            if (top > (txtTop + txtHeight)) {\n                // top 不得超出编辑范围\n                top = txtTop + txtHeight;\n            }\n\n            // 显示（方便计算 margin）\n            $toolbar.show();\n\n            // 计算 margin\n            var width = $toolbar.outerWidth();\n            marginLeft = tableWidth / 2 - width / 2;\n\n            // 定位\n            $toolbar.css({\n                top: top + 5,\n                left: left,\n                'margin-left': marginLeft\n            });\n            // 如果定位太靠左了\n            if (marginLeft < 0) {\n                // 得到三角形的margin-left\n                $toolbar.css('margin-left', '0');\n                $triangle.hide();\n            } else {\n                $triangle.show();\n            }\n        }\n        \n        // 隐藏 toolbar\n        function hide() {\n            if ($currentTable == null) {\n                return;\n            }\n            $currentTable.removeClass('clicked');\n            $currentTable = null;\n            $toolbar.hide();\n        }\n\n        // click table 事件\n        $currentTxt.on('click', 'table', function (e) {\n            var $table = $(e.currentTarget);\n\n            // 渲染\n            render();\n\n            if ($currentTable && ($currentTable.get(0) === $table.get(0))) {\n                setTimeout(hide, 100);\n                return;\n            }\n\n            // 显示 toolbar\n            $currentTable = $table;\n            show();\n\n            // 阻止冒泡\n            e.preventDefault();\n            e.stopPropagation();\n            \n        }).on('click keydown scroll', function (e) {\n            setTimeout(hide, 100);\n        });\n        E.$body.on('click keydown scroll', function (e) {\n            setTimeout(hide, 100);\n        });\n    });\n\n});\n// 编辑器区域 img toolbar\n_e(function (E, $) {\n\n    if (E.userAgent.indexOf('MSIE 8') > 0) {\n        return;\n    }\n    \n    E.plugin(function () {\n        var editor = this;\n        var lang = editor.config.lang;\n        var txt = editor.txt;\n        var $txt = txt.$txt;\n        var html = '';\n        // 说明：设置了 max-height 之后，$txt.parent() 负责滚动处理\n        var $currentTxt = editor.useMaxHeight ? $txt.parent() : $txt;\n        var $editorContainer = editor.$editorContainer;\n        var $currentImg;\n        var currentLink = '';\n\n        // 用到的dom节点\n        var isRendered = false;\n        var $dragPoint = $('<div class=\"img-drag-point\"></div>');\n\n        var $toolbar = $('<div class=\"txt-toolbar\"></div>');\n        var $triangle = $('<div class=\"tip-triangle\"></div>');\n\n        var $menuContainer = $('<div></div>');\n        var $delete = $('<a href=\"#\"><i class=\"wangeditor-menu-img-trash-o\"></i></a>');\n        var $zoomSmall = $('<a href=\"#\"><i class=\"wangeditor-menu-img-search-minus\"></i></a>');\n        var $zoomBig = $('<a href=\"#\"><i class=\"wangeditor-menu-img-search-plus\"></i></a>');\n        // var $floatLeft = $('<a href=\"#\"><i class=\"wangeditor-menu-img-align-left\"></i></a>');\n        // var $noFloat = $('<a href=\"#\"><i class=\"wangeditor-menu-img-align-justify\"></i></a>');\n        // var $floatRight = $('<a href=\"#\"><i class=\"wangeditor-menu-img-align-right\"></i></a>');\n        var $alignLeft = $('<a href=\"#\"><i class=\"wangeditor-menu-img-align-left\"></i></a>');\n        var $alignCenter = $('<a href=\"#\"><i class=\"wangeditor-menu-img-align-center\"></i></a>');\n        var $alignRight = $('<a href=\"#\"><i class=\"wangeditor-menu-img-align-right\"></i></a>');\n        var $link = $('<a href=\"#\"><i class=\"wangeditor-menu-img-link\"></i></a>');\n        var $unLink = $('<a href=\"#\"><i class=\"wangeditor-menu-img-unlink\"></i></a>');\n\n        var $linkInputContainer = $('<div style=\"display:none;\"></div>');\n        var $linkInput = $('<input type=\"text\" style=\"height:26px; margin-left:10px; width:200px;\"/>');\n        var $linkBtnSubmit = $('<button class=\"right\">' + lang.submit + '</button>');\n        var $linkBtnCancel = $('<button class=\"right gray\">' + lang.cancel + '</button>');\n\n        // 记录是否正在拖拽\n        var isOnDrag = false;\n\n        // 获取 / 设置 链接\n        function imgLink(e, url) {\n            if (!$currentImg) {\n                return;\n            }\n            var commandFn;\n            var callback = function () {\n                // 及时保存currentLink\n                if (url != null) {\n                    currentLink = url;\n                }\n                if (html !== $txt.html()) {\n                    $txt.change();\n                }\n            };\n            var $link;\n            var inLink = false;\n            var $parent = $currentImg.parent();\n            if ($parent.get(0).nodeName.toLowerCase() === 'a') {\n                // 父元素就是图片链接\n                $link = $parent;\n                inLink = true;\n            } else {\n                // 父元素不是图片链接，则重新创建一个链接\n                $link = $('<a target=\"_blank\"></a>');\n            }\n\n            if (url == null) {\n                // url 无值，是获取链接\n                return $link.attr('href') || '';\n            } else if (url === '') {\n                // url 是空字符串，是取消链接\n                if (inLink) {\n                    commandFn = function () {\n                        $currentImg.unwrap();\n                    };\n                }\n            } else {\n                // url 有值，是设置链接\n                if (url === currentLink) {\n                    return;\n                }\n                commandFn = function () {\n                    $link.attr('href', url);\n\n                    if (!inLink) {\n                        // 当前图片未包含在链接中，则包含进来\n                        $currentImg.wrap($link);\n                    }\n                };\n            }\n\n            // 执行命令\n            if (commandFn) {\n                // 记录下执行命令之前的html内容\n                html = $txt.html();\n                // 执行命令\n                editor.customCommand(e, commandFn, callback);\n            }\n        }\n\n        // 渲染到页面\n        function render() {\n            if (isRendered) {\n                return;\n            }\n            \n            // 绑定事件\n            bindToolbarEvent();\n            bindDragEvent();\n\n            // 菜单放入 container\n            $menuContainer.append($delete)\n                            .append($zoomSmall)\n                            .append($zoomBig)\n                            // .append($floatLeft)\n                            // .append($noFloat)\n                            // .append($floatRight);\n                            .append($alignLeft)\n                            .append($alignCenter)\n                            .append($alignRight)\n                            .append($link)\n                            .append($unLink);\n\n            // 链接input放入container\n            $linkInputContainer.append($linkInput)\n                               .append($linkBtnCancel)\n                               .append($linkBtnSubmit);\n\n            // 拼接 渲染到页面上\n            $toolbar.append($triangle)\n                    .append($menuContainer)\n                    .append($linkInputContainer);\n                    \n            editor.$editorContainer.append($toolbar).append($dragPoint);\n            isRendered = true;\n        }\n\n        // 绑定toolbar事件\n        function bindToolbarEvent() {\n            // 统一执行命令的方法\n            var commandFn;\n            function customCommand(e, callback) {\n                var cb;\n                // 记录下执行命令之前的html内容\n                html = $txt.html();\n                cb = function () {\n                    if (callback) {\n                        callback();\n                    }\n                    if (html !== $txt.html()) {\n                        $txt.change();\n                    }\n                };\n                // 执行命令\n                if (commandFn) {\n                    editor.customCommand(e, commandFn, cb);\n                }\n            }\n\n            // 删除\n            $delete.click(function (e) {\n                // 删除之前先unlink\n                imgLink(e, '');\n\n                // 删除图片\n                commandFn = function () {\n                    $currentImg.remove();\n                };\n                customCommand(e, function () {\n                    setTimeout(hide, 100);\n                });\n            });\n\n            // 放大\n            $zoomBig.click(function (e) {\n                commandFn = function () {\n                    var img = $currentImg.get(0);\n                    var width = img.width;\n                    var height = img.height;\n                    width = width * 1.1;\n                    height = height * 1.1;\n\n                    $currentImg.css({\n                        width: width + 'px',\n                        height: height + 'px'\n                    });\n                };\n                customCommand(e, function () {\n                    setTimeout(show);\n                });\n            });\n\n            // 缩小\n            $zoomSmall.click(function (e) {\n                commandFn = function () {\n                    var img = $currentImg.get(0);\n                    var width = img.width;\n                    var height = img.height;\n                    width = width * 0.9;\n                    height = height * 0.9;\n\n                    $currentImg.css({\n                        width: width + 'px',\n                        height: height + 'px'\n                    });\n                };\n                customCommand(e, function () {\n                    setTimeout(show);\n                });\n            });\n\n            // // 左浮动\n            // $floatLeft.click(function (e) {\n            //     commandFn = function () {\n            //         $currentImg.css({\n            //             float: 'left'\n            //         });\n            //     };\n            //     customCommand(e, function () {\n            //         setTimeout(hide, 100);\n            //     });\n            // });\n\n            // alignLeft\n            $alignLeft.click(function (e) {\n                commandFn = function () {\n                    // 如果 img 增加了链接，那么 img.parent() 就是 a 标签，设置 align 没用的，因此必须找到 P 父节点来设置 align\n                    $currentImg.parents('p').css({\n                        'text-align': 'left'\n                    }).attr('align', 'left');\n                };\n                customCommand(e, function () {\n                    setTimeout(hide, 100);\n                });\n            });\n\n            // // 右浮动\n            // $floatRight.click(function (e) {\n            //     commandFn = function () {\n            //         $currentImg.css({\n            //             float: 'right'\n            //         });\n            //     };\n            //     customCommand(e, function () {\n            //         setTimeout(hide, 100);\n            //     });\n            // });\n\n            // alignRight\n            $alignRight.click(function (e) {\n                commandFn = function () {\n                    // 如果 img 增加了链接，那么 img.parent() 就是 a 标签，设置 align 没用的，因此必须找到 P 父节点来设置 align\n                    $currentImg.parents('p').css({\n                        'text-align': 'right'\n                    }).attr('align', 'right');\n                };\n                customCommand(e, function () {\n                    setTimeout(hide, 100);\n                });\n            });\n\n            // // 无浮动\n            // $noFloat.click(function (e) {\n            //     commandFn = function () {\n            //         $currentImg.css({\n            //             float: 'none'\n            //         });\n            //     };\n            //     customCommand(e, function () {\n            //         setTimeout(hide, 100);\n            //     });\n            // });\n\n            // alignCenter\n            $alignCenter.click(function (e) {\n                commandFn = function () {\n                    // 如果 img 增加了链接，那么 img.parent() 就是 a 标签，设置 align 没用的，因此必须找到 P 父节点来设置 align\n                    $currentImg.parents('p').css({\n                        'text-align': 'center'\n                    }).attr('align', 'center');\n                };\n                customCommand(e, function () {\n                    setTimeout(hide, 100);\n                });\n            });\n\n            // link\n            // 显示链接input\n            $link.click(function (e) {\n                e.preventDefault();\n\n                // 获取当前链接，并显示\n                currentLink = imgLink(e);\n                $linkInput.val(currentLink);\n\n                $menuContainer.hide();\n                $linkInputContainer.show();\n            });\n            // 设置链接\n            $linkBtnSubmit.click(function (e) {\n                e.preventDefault();\n\n                var url = $.trim($linkInput.val());\n                if (url) {\n                    // 设置链接，同时会自动更新 currentLink 的值\n                    imgLink(e, url);\n                }\n\n                // 隐藏 toolbar\n                setTimeout(hide);\n            });\n            // 取消设置链接\n            $linkBtnCancel.click(function (e) {\n                e.preventDefault();\n\n                // 重置链接 input\n                $linkInput.val(currentLink);\n\n                $menuContainer.show();\n                $linkInputContainer.hide();\n            });\n\n            // unlink\n            $unLink.click(function (e) {\n                e.preventDefault();\n\n                // 执行 unlink\n                imgLink(e, '');\n\n                // 隐藏 toolbar\n                setTimeout(hide);\n            });\n        }\n\n        // 绑定drag事件\n        function bindDragEvent() {\n            var _x, _y;\n            var dragMarginLeft, dragMarginTop;\n            var imgWidth, imgHeight;\n\n            function mousemove (e) {\n                var diffX, diffY;\n\n                // 计算差额\n                diffX = e.pageX - _x;\n                diffY = e.pageY - _y;\n\n                // --------- 计算拖拽点的位置 ---------\n                var currentDragMarginLeft = dragMarginLeft + diffX;\n                var currentDragMarginTop = dragMarginTop + diffY;\n                $dragPoint.css({\n                    'margin-left': currentDragMarginLeft,\n                    'margin-top': currentDragMarginTop\n                });\n\n                // --------- 计算图片的大小 ---------\n                var currentImgWidth = imgWidth + diffX;\n                var currentImggHeight = imgHeight + diffY;\n                $currentImg && $currentImg.css({\n                    width: currentImgWidth,\n                    height: currentImggHeight\n                });\n            }\n\n            $dragPoint.on('mousedown', function(e){\n                if (!$currentImg) {\n                    return;\n                }\n                // 当前鼠标位置\n                _x = e.pageX;\n                _y = e.pageY;\n\n                // 当前拖拽点的位置\n                dragMarginLeft = parseFloat($dragPoint.css('margin-left'), 10);\n                dragMarginTop = parseFloat($dragPoint.css('margin-top'), 10);\n\n                // 当前图片的大小\n                imgWidth = $currentImg.width();\n                imgHeight = $currentImg.height();\n\n                // 隐藏 $toolbar\n                $toolbar.hide();\n\n                // 绑定计算事件\n                E.$document.on('mousemove._dragResizeImg', mousemove);\n                E.$document.on('mouseup._dragResizeImg', function (e) {\n                    // 取消绑定\n                    E.$document.off('mousemove._dragResizeImg');\n                    E.$document.off('mouseup._dragResizeImg');\n\n                    // 隐藏，并还原拖拽点的位置\n                    hide();\n                    $dragPoint.css({\n                        'margin-left': dragMarginLeft,\n                        'margin-top': dragMarginTop\n                    });\n\n                    // 记录\n                    isOnDrag = false;\n                });\n\n                // 记录\n                isOnDrag = true;\n            });\n        }\n\n        // 显示 toolbar\n        function show() {\n            if (editor._disabled) {\n                // 编辑器已经被禁用，则不让显示\n                return;\n            }\n            if ($currentImg == null) {\n                return;\n            }\n            $currentImg.addClass('clicked');\n            var imgPosition = $currentImg.position();\n            var imgTop = imgPosition.top;\n            var imgLeft = imgPosition.left;\n            var imgHeight = $currentImg.outerHeight();\n            var imgWidth = $currentImg.outerWidth();\n\n\n            // --- 定位 dragpoint ---\n            $dragPoint.css({\n                top: imgTop + imgHeight,\n                left: imgLeft + imgWidth\n            });\n\n            // --- 定位 toolbar ---\n\n            // 计算初步结果\n            var top = imgTop + imgHeight;\n            var left = imgLeft;\n            var marginLeft = 0;\n\n            var txtTop = $currentTxt.position().top;\n            var txtHeight = $currentTxt.outerHeight();\n            if (top > (txtTop + txtHeight)) {\n                // top 不得超出编辑范围\n                top = txtTop + txtHeight;\n            } else {\n                // top 超出编辑范围，dragPoint就不显示了\n                $dragPoint.show();\n            }\n\n            // 显示（方便计算 margin）\n            $toolbar.show();\n\n            // 计算 margin\n            var width = $toolbar.outerWidth();\n            marginLeft = imgWidth / 2 - width / 2;\n\n            // 定位\n            $toolbar.css({\n                top: top + 5,\n                left: left,\n                'margin-left': marginLeft\n            });\n            // 如果定位太靠左了\n            if (marginLeft < 0) {\n                // 得到三角形的margin-left\n                $toolbar.css('margin-left', '0');\n                $triangle.hide();\n            } else {\n                $triangle.show();\n            }\n\n            // disable 菜单\n            editor.disableMenusExcept();\n        }\n        \n        // 隐藏 toolbar\n        function hide() {\n            if ($currentImg == null) {\n                return;\n            }\n            $currentImg.removeClass('clicked');\n            $currentImg = null;\n\n            $toolbar.hide();\n            $dragPoint.hide();\n\n            // enable 菜单\n            editor.enableMenusExcept();\n        }\n\n        // 判断img是否是一个表情\n        function isEmotion(imgSrc) {\n            var result = false;\n            if (!editor.emotionUrls) {\n                return result;\n            }\n            $.each(editor.emotionUrls, function (index, url) {\n                var flag = false;\n                if (imgSrc === url) {\n                    result = true;\n                    flag = true;\n                }\n                if (flag) {\n                    return false;  // break 循环\n                }\n            });\n            return result;\n        }\n\n        // click img 事件\n        $currentTxt.on('mousedown', 'img', function (e) {\n            e.preventDefault();\n        }).on('click', 'img', function (e) {\n            var $img = $(e.currentTarget);\n            var src = $img.attr('src');\n\n            if (!src || isEmotion(src)) {\n                // 是一个表情图标\n                return;\n            }\n\n            // ---------- 不是表情图标 ---------- \n\n            // 渲染\n            render();\n\n            if ($currentImg && ($currentImg.get(0) === $img.get(0))) {\n                setTimeout(hide, 100);\n                return;\n            }\n\n            // 显示 toolbar\n            $currentImg = $img;\n            show();\n\n            // 默认显示menuContainer，其他默认隐藏\n            $menuContainer.show();\n            $linkInputContainer.hide();\n\n            // 阻止冒泡\n            e.preventDefault();\n            e.stopPropagation();\n            \n        }).on('click keydown scroll', function (e) {\n            if (!isOnDrag) {\n                setTimeout(hide, 100);\n            }\n        });\n\n    });\n\n});\n// 编辑区域 link toolbar\n_e(function (E, $) {\n    E.plugin(function () {\n        var editor = this;\n        var lang = editor.config.lang;\n        var $txt = editor.txt.$txt;\n\n        // 当前命中的链接\n        var $currentLink;\n\n        var $toolbar = $('<div class=\"txt-toolbar\"></div>');\n        var $triangle = $('<div class=\"tip-triangle\"></div>');\n        var $triggerLink = $('<a href=\"#\" target=\"_blank\"><i class=\"wangeditor-menu-img-link\"></i> ' + lang.openLink + '</a>');\n        var isRendered;\n\n        // 记录当前的显示/隐藏状态\n        var isShow = false;\n\n        var showTimeoutId, hideTimeoutId;\n        var showTimeoutIdByToolbar, hideTimeoutIdByToolbar;\n\n        // 渲染 dom\n        function render() {\n            if (isRendered) {\n                return;\n            }\n\n            $toolbar.append($triangle)\n                    .append($triggerLink);\n\n            editor.$editorContainer.append($toolbar);\n\n            isRendered = true;\n        }\n\n        // 定位\n        function setPosition() {\n            if (!$currentLink) {\n                return;\n            }\n\n            var position = $currentLink.position();\n            var left = position.left;\n            var top = position.top;\n            var height = $currentLink.height();\n\n            // 初步计算top值\n            var topResult = top + height + 5;\n\n            // 判断 toolbar 是否超过了编辑器区域的下边界\n            var menuHeight = editor.menuContainer.height();\n            var txtHeight = editor.txt.$txt.outerHeight();\n            if (topResult > menuHeight + txtHeight) {\n                topResult = menuHeight + txtHeight + 5;\n            }\n\n            // 最终设置\n            $toolbar.css({\n                top: topResult,\n                left: left\n            });\n        }\n\n        // 显示 toolbar\n        function show() {\n            if (isShow) {\n                return;\n            }\n\n            if (!$currentLink) {\n                return;\n            }\n\n            render();\n\n            $toolbar.show();\n\n            // 设置链接\n            var href = $currentLink.attr('href');\n            $triggerLink.attr('href', href);\n\n            // 定位\n            setPosition();\n\n            isShow = true;\n        }\n\n        // 隐藏 toolbar\n        function hide() {\n            if (!isShow) {\n                return;\n            }\n\n            if (!$currentLink) {\n                return;\n            }\n\n            $toolbar.hide();\n            isShow = false;\n        }\n\n        // $txt 绑定事件\n        $txt.on('mouseenter', 'a', function (e) {\n            // 延时 500ms 显示toolbar\n            if (showTimeoutId) {\n                clearTimeout(showTimeoutId);\n            }\n            showTimeoutId = setTimeout(function () {\n                var a = e.currentTarget;\n                var $a = $(a);\n                $currentLink = $a;\n\n                var $img = $a.children('img');\n                if ($img.length) {\n                    // 该链接下包含一个图片\n\n                    // 图片点击时，隐藏toolbar\n                    $img.click(function (e) {\n                        hide();\n                    });\n\n                    if ($img.hasClass('clicked')) {\n                        // 图片还处于clicked状态，则不显示toolbar\n                        return;\n                    }\n                }\n\n                // 显示toolbar\n                show();\n            }, 500);\n        }).on('mouseleave', 'a', function (e) {\n            // 延时 500ms 隐藏toolbar\n            if (hideTimeoutId) {\n                clearTimeout(hideTimeoutId);\n            }\n            hideTimeoutId = setTimeout(hide, 500);\n        }).on('click keydown scroll', function (e) {\n            setTimeout(hide, 100);\n        });\n        // $toolbar 绑定事件\n        $toolbar.on('mouseenter', function (e) {\n            // 先中断掉 $txt.mouseleave 导致的隐藏\n            if (hideTimeoutId) {\n                clearTimeout(hideTimeoutId);\n            }\n        }).on('mouseleave', function (e) {\n            // 延时 500ms 显示toolbar\n            if (showTimeoutIdByToolbar) {\n                clearTimeout(showTimeoutIdByToolbar);\n            }\n            showTimeoutIdByToolbar = setTimeout(hide, 500);\n        });\n    });\n});\n// menu吸顶\n_e(function (E, $) {\n\n    E.plugin(function () {\n        var editor = this;\n        var menuFixed = editor.config.menuFixed;\n        if (menuFixed === false || typeof menuFixed !== 'number') {\n            // 没有配置菜单吸顶\n            return;\n        }\n        var bodyMarginTop = parseFloat(E.$body.css('margin-top'), 10);\n        if (isNaN(bodyMarginTop)) {\n            bodyMarginTop = 0;\n        }\n\n        var $editorContainer = editor.$editorContainer;\n        var editorTop = $editorContainer.offset().top;\n        var editorHeight = $editorContainer.outerHeight();\n        \n        var $menuContainer = editor.menuContainer.$menuContainer;\n        var menuCssPosition = $menuContainer.css('position');\n        var menuCssTop = $menuContainer.css('top');\n        var menuTop = $menuContainer.offset().top;\n        var menuHeight = $menuContainer.outerHeight();\n        \n        var $txt = editor.txt.$txt;\n\n        E.$window.scroll(function () {\n            //全屏模式不支持\n            if (editor.isFullScreen) {\n                return;\n            }\n\n            var sTop = E.$window.scrollTop();\n\n            // 需要重新计算宽度，因为浏览器可能此时出现滚动条\n            var menuWidth = $menuContainer.width();\n\n            // 如果 menuTop === 0 说明此前编辑器一直隐藏，后来显示出来了，要重新计算相关数据\n            if (menuTop === 0) {\n                menuTop = $menuContainer.offset().top;\n                editorTop = $editorContainer.offset().top;\n                editorHeight = $editorContainer.outerHeight();\n                menuHeight = $menuContainer.outerHeight();\n            }\n\n            if (sTop >= menuTop && sTop + menuFixed + menuHeight + 30 < editorTop + editorHeight) {\n                // 吸顶\n                $menuContainer.css({\n                    position: 'fixed',\n                    top: menuFixed\n                });\n\n                // 固定宽度\n                $menuContainer.width(menuWidth);\n\n                // 增加body margin-top\n                E.$body.css({\n                    'margin-top': bodyMarginTop + menuHeight\n                });\n\n                // 记录\n                if (!editor._isMenufixed) {\n                    editor._isMenufixed = true;\n                }\n            } else {\n                // 取消吸顶\n                $menuContainer.css({\n                    position: menuCssPosition,\n                    top: menuCssTop\n                });\n\n                // 取消宽度固定\n                $menuContainer.css('width', '100%');\n\n                // 还原 body margin-top\n                E.$body.css({\n                    'margin-top': bodyMarginTop\n                });\n\n                // 撤销记录\n                if (editor._isMenufixed) {\n                    editor._isMenufixed = false;\n                }\n            }\n        });\n    });\n\n});\n// 缩进 菜单插件\n_e(function (E, $) {\n\n    // 用 createMenu 方法创建菜单\n    E.createMenu(function (check) {\n\n        // 定义菜单id，不要和其他菜单id重复。编辑器自带的所有菜单id，可通过『参数配置-自定义菜单』一节查看\n        var menuId = 'indent';\n\n        // check将检查菜单配置（『参数配置-自定义菜单』一节描述）中是否该菜单id，如果没有，则忽略下面的代码。\n        if (!check(menuId)) {\n            return;\n        }\n\n        // this 指向 editor 对象自身\n        var editor = this;\n\n        // 创建 menu 对象\n        var menu = new E.Menu({\n            editor: editor,  // 编辑器对象\n            id: menuId,  // 菜单id\n            title: '缩进', // 菜单标题\n\n            // 正常状态和选中装下的dom对象，样式需要自定义\n            $domNormal: $('<a href=\"#\" tabindex=\"-1\"><i class=\"wangeditor-menu-img-indent-left\"></i></a>'),\n            $domSelected: $('<a href=\"#\" tabindex=\"-1\" class=\"selected\"><i class=\"wangeditor-menu-img-indent-left\"></i></a>')\n        });\n\n        // 菜单正常状态下，点击将触发该事件\n        menu.clickEvent = function (e) {\n            var elem = editor.getRangeElem();\n            var p = editor.getSelfOrParentByName(elem, 'p');\n            var $p;\n\n            if (!p) {\n                // 未找到 p 元素，则忽略\n                return e.preventDefault();\n            }\n            $p = $(p);\n\n            // 使用自定义命令\n            function commandFn() {\n                $p.css('text-indent', '2em');\n            }\n            editor.customCommand(e, commandFn);\n        };\n\n        // 菜单选中状态下，点击将触发该事件\n        menu.clickEventSelected = function (e) {\n            var elem = editor.getRangeElem();\n            var p = editor.getSelfOrParentByName(elem, 'p');\n            var $p;\n\n            if (!p) {\n                // 未找到 p 元素，则忽略\n                return e.preventDefault();\n            }\n            $p = $(p);\n\n            // 使用自定义命令\n            function commandFn() {\n                $p.css('text-indent', '0');\n            }\n            editor.customCommand(e, commandFn);\n        };\n\n        // 根据当前选区，自定义更新菜单的选中状态或者正常状态\n        menu.updateSelectedEvent = function () {\n            // 获取当前选区所在的父元素\n            var elem = editor.getRangeElem();\n            var p = editor.getSelfOrParentByName(elem, 'p');\n            var $p;\n            var indent;\n\n            if (!p) {\n                // 未找到 p 元素，则标记为未处于选中状态\n                return false;\n            }\n            $p = $(p);\n            indent = $p.css('text-indent');\n\n            if (!indent || indent === '0px') {\n                // 得到的p，text-indent 属性是 0，则标记为未处于选中状态\n                return false;\n            }\n\n            // 找到 p 元素，并且 text-indent 不是 0，则标记为选中状态\n            return true;\n        };\n\n        // 增加到editor对象中\n        editor.menus[menuId] = menu;\n    });\n\n});\n// 行高 菜单插件\n_e(function (E, $) {\n\n    // 用 createMenu 方法创建菜单\n    E.createMenu(function (check) {\n\n        // 定义菜单id，不要和其他菜单id重复。编辑器自带的所有菜单id，可通过『参数配置-自定义菜单』一节查看\n        var menuId = 'lineheight';\n\n        // check将检查菜单配置（『参数配置-自定义菜单』一节描述）中是否该菜单id，如果没有，则忽略下面的代码。\n        if (!check(menuId)) {\n            return;\n        }\n\n        // this 指向 editor 对象自身\n        var editor = this;\n\n        // 由于浏览器自身不支持 lineHeight 命令，因此要做一个hook\n        editor.commandHooks.lineHeight = function (value) {\n            var rangeElem = editor.getRangeElem();\n            var targetElem = editor.getSelfOrParentByName(rangeElem, 'p,h1,h2,h3,h4,h5,pre');\n            if (!targetElem) {\n                return;\n            }\n            $(targetElem).css('line-height', value + '');\n        };\n\n        // 创建 menu 对象\n        var menu = new E.Menu({\n            editor: editor,  // 编辑器对象\n            id: menuId,  // 菜单id\n            title: '行高', // 菜单标题\n            commandName: 'lineHeight', // 命令名称\n\n            // 正常状态和选中装下的dom对象，样式需要自定义\n            $domNormal: $('<a href=\"#\" tabindex=\"-1\"><i class=\"wangeditor-menu-img-arrows-v\"></i></a>'),\n            $domSelected: $('<a href=\"#\" tabindex=\"-1\" class=\"selected\"><i class=\"wangeditor-menu-img-arrows-v\"></i></a>')\n        });\n\n        // 数据源\n        var data  = {\n            // 格式： 'value' : 'title'\n            '1.0': '1.0倍',\n            '1.5': '1.5倍',\n            '1.8': '1.8倍',\n            '2.0': '2.0倍',\n            '2.5': '2.5倍',\n            '3.0': '3.0倍'\n        };\n\n        // 为menu创建droplist对象\n        var tpl = '<span style=\"line-height:{#commandValue}\">{#title}</span>';\n        menu.dropList = new E.DropList(editor, menu, {\n            data: data,  // 传入数据源\n            tpl: tpl  // 传入模板\n        });\n\n        // 增加到editor对象中\n        editor.menus[menuId] = menu;\n\n    });\n\n});\n// 自定义上传\n_e(function (E, $) {\n\n    E.plugin(function () {\n\n        var editor = this;\n        var customUpload = editor.config.customUpload;\n        if (!customUpload) {\n            return;\n        } else if (editor.config.uploadImgUrl) {\n            alert('自定义上传无效，详看浏览器日志console.log');\n            E.error('已经配置了 uploadImgUrl ，就不能再配置 customUpload ，两者冲突。将导致自定义上传无效。');\n            return;\n        }\n\n        var $uploadContent = editor.$uploadContent;\n        if (!$uploadContent) {\n            E.error('自定义上传，无法获取 editor.$uploadContent');\n        }\n\n        // UI\n        var $uploadIcon = $('<div class=\"upload-icon-container\"><i class=\"wangeditor-menu-img-upload\"></i></div>');\n        $uploadContent.append($uploadIcon);\n\n        // 设置id，并暴露\n        var btnId = 'upload' + E.random();\n        var containerId = 'upload' + E.random();\n        $uploadIcon.attr('id', btnId);\n        $uploadContent.attr('id', containerId);\n\n        editor.customUploadBtnId = btnId;\n        editor.customUploadContainerId = containerId;\n    });\n\n});\n// 版权提示\n_e(function (E, $) {\n    E.info('本页面富文本编辑器由 wangEditor 提供 http://wangeditor.github.io/ ');\n});\n    \n    // 最终返回wangEditor构造函数\n    return window.wangEditor;\n});"]}